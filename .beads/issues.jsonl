{"id":"wx-0g23","title":"Implement ralph diff command for template comparison","description":"Create lib/ralph/cmd/diff.sh that shows local template changes (.ralph/template/) vs packaged templates (RALPH_TEMPLATE_DIR). Support 'ralph diff' for all templates and 'ralph diff \u003cname\u003e' for specific template. Output should be pipeable to 'ralph tune' for integration mode.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T01:20:57Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-0nk","title":"Fix deploy_keys SSH configuration","description":"Git push fails: Identity file /home/shaun/.ssh/deploy_keys/ not accessible. Check git config for SSH command overrides and verify deploy key setup in sandbox environment.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T19:23:53Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T19:33:21Z","closed_at":"2026-01-10T19:33:21Z","work_type":"mutex"}
{"id":"wx-0s2","title":"[Good] SSH key permissions set correctly","description":"POSITIVE FINDING: SSH key permissions are correctly set throughout.\n\n**Files:**\n- scripts/setup-deploy-key:55-57 - chmod 700 dir, chmod 600 private, chmod 644 public\n- lib/sandbox/builder/entrypoint.sh:45-46 - chmod 600 host key, chmod 644 pub\n- lib/sandbox/builder/entrypoint.sh:66-67,74-75 - chmod 700 .ssh, chmod 600 authorized_keys\n- lib/sandbox/darwin/entrypoint.sh:103,133-134 - chmod 600 config, chmod 700 .ssh\n- lib/builder/default.nix:354-355 - chmod 600 and chown root:nixbld\n\nSSH will reject keys with wrong permissions, so these are correctly enforced.","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:58Z","created_by":"unknown","updated_at":"2026-01-26T21:21:29Z","closed_at":"2026-01-26T21:21:29Z","labels":["good-practice","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-0u2","title":"Network security verification","description":"Verify network filtering on both platforms: blocked domains return 403, TLD blocking works, raw IP blocked, WebSocket blocked, DNS exfil blocked, ICMP blocked.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:59Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:24:22Z","work_type":"mutex"}
{"id":"wx-0ym","title":"Consolidate mkMountSpecs with platform flag","description":"mkMountSpecs function is nearly identical between Linux (lib/sandbox/linux/default.nix:34-43) and Darwin (lib/sandbox/darwin/default.nix:25-34) but Linux includes mode field (VirtioFS doesn't support modes). Create single function with includeMode parameter.","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-12T18:24:09Z","created_by":"unknown","updated_at":"2026-01-12T19:12:54Z","closed_at":"2026-01-12T18:56:23Z","work_type":"mutex"}
{"id":"wx-13f8","title":"Fix missing molecule in ralph todo update mode","description":"When ralph plan -u runs on a spec that was never decomposed with ralph todo (new mode), the update path has no mechanism to create a molecule. todo-update.md assumes MOLECULE_ID already exists, but todo.sh never creates one in update mode. Fix: create the epic in todo.sh when molecule is missing.","status":"closed","priority":2,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-02-08T10:50:49Z","created_by":"wrapix","updated_at":"2026-02-08T10:51:07Z","closed_at":"2026-02-08T10:51:07Z","work_type":"mutex"}
{"id":"wx-14772e","title":"Document Claude configuration flow in containers","description":"# Claude Configuration in Containers\n\n## Overview\n\nContainer Claude configuration involves two files:\n- `.claude.json` - User settings (onboarding, updates, etc.)\n- `settings.json` - Environment-persisted settings\n\n## Configuration Flow\n\n### 1. Environment Variables (profiles.nix)\n\nAll containers get these environment variables via `baseEnv`:\n\n```nix\nbaseEnv = {\n  CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC = \"1\";\n  DISABLE_AUTOUPDATER = \"1\";\n  DISABLE_ERROR_REPORTING = \"1\";\n  DISABLE_TELEMETRY = \"1\";\n};\n```\n\nThese are baked into the container image (image.nix:112) as `Env` entries.\n\n### 2. .claude.json Initialization (init-claude-config.sh)\n\nOn first container start, entrypoint scripts source `init-claude-config.sh` which creates:\n\n```json\n{\n  \"hasCompletedOnboarding\": true,\n  \"autoUpdates\": false,\n  \"numStartups\": 1,\n  \"bypassPermissionsModeAccepted\": true,\n  \"officialMarketplaceAutoInstallAttempted\": true\n}\n```\n\nThis suppresses onboarding prompts and notifications.\n\n### 3. settings.json Persistence\n\n**Why only DISABLE_AUTOUPDATER appears in settings.json:**\n\nClaude CLI reads environment variables on startup and selectively persists certain settings to `~/.claude/settings.json`. The behavior is:\n\n- **DISABLE_AUTOUPDATER** → Persisted to settings.json (user preference)\n- **DISABLE_TELEMETRY** → Runtime-only (not persisted)\n- **DISABLE_ERROR_REPORTING** → Runtime-only (not persisted)\n- **CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC** → Runtime-only (not persisted)\n\nThis is Claude CLI's intentional design: user preferences (like auto-updates) are saved to disk, while privacy/telemetry flags are runtime-only and must be set via environment variables each time.\n\n## Architecture\n\n### Container Isolation\n\nThe workspace `.claude` directory is mounted as the container's `~/.claude`:\n\n**Linux** (lib/sandbox/linux/default.nix:60-61):\n```bash\nmkdir -p \"$PROJECT_DIR/.claude\"\nVOLUME_ARGS=\"$VOLUME_ARGS -v $PROJECT_DIR/.claude:/home/$USER/.claude:rw\"\n```\n\n**Darwin** (similar mounting in darwin/default.nix)\n\nThis means:\n- Each project has isolated Claude configuration\n- Sessions persist across container restarts\n- Host `~/.claude` is NOT shared with containers\n\n### Unified Initialization\n\nThe shared `init-claude-config.sh` script is:\n1. Copied into the image at `/etc/wrapix/init-claude-config.sh` (image.nix)\n2. Sourced by both platform entrypoints (linux/entrypoint.sh, darwin/entrypoint.sh)\n3. Creates `.claude.json` if missing\n\nThis eliminates duplication between Linux and Darwin entrypoint scripts.\n\n## Why This Design?\n\n1. **Isolation**: Container config doesn't interfere with host Claude\n2. **Persistence**: Sessions work with `/rename` and `/resume`\n3. **Onboarding**: Suppresses prompts in fresh containers\n4. **Updates**: Prevents containers from auto-updating (version is baked into image)\n5. **Telemetry**: Privacy flags honored without disk persistence","status":"closed","priority":3,"issue_type":"chore","owner":"gpg@taheris.net","created_at":"2026-01-22T17:04:13Z","created_by":"unknown","updated_at":"2026-01-25T15:50:58Z","closed_at":"2026-01-25T15:50:58Z","work_type":"mutex"}
{"id":"wx-1ls","title":"Update ARCHITECTURE.md","description":"Update to reflect simplified single-container architecture","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T20:29:03Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:32:19Z","work_type":"mutex"}
{"id":"wx-1v3","title":"Implement Implementation Notes stripping","description":"Add logic to strip '## Implementation Notes' section when finalizing spec to specs/\u003cfeature\u003e.md. This section provides transient context during ralph ready but shouldn't persist in permanent docs. Available during ready phase for context when creating beads.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:53Z","created_by":"unknown","updated_at":"2026-01-26T13:46:38Z","closed_at":"2026-01-26T13:39:30Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-1vft","title":"Fix validate_template called with empty source path","description":"When RALPH_TEMPLATE_DIR is not set, TEMPLATE is empty. Line 324 in plan.sh calls validate_template with '$TEMPLATE/$TEMPLATE_NAME' which becomes '/plan-new.md' (absolute root path). Fix: guard the validate_template call to only pass source path when TEMPLATE is non-empty.","status":"closed","priority":1,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-02-02T13:08:05Z","created_by":"unknown","updated_at":"2026-02-02T13:12:51Z","closed_at":"2026-02-02T13:12:51Z","work_type":"mutex"}
{"id":"wx-2163b5","title":"Add spec.hidden config option to template","description":"Add spec.hidden boolean option to lib/ralph/template/config.nix. Default value should be false. Structure: spec = { hidden = false; };","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:10Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:02:16Z","closed_at":"2026-01-26T12:01:41Z","labels":["rl-spec-hidden"],"work_type":"mutex"}
{"id":"wx-227e55","title":"Update ready.sh to support hidden mode","description":"Update lib/ralph/ready.sh to: 1) Read spec.hidden from config, 2) Compute SPEC_PATH based on hidden flag, 3) Pass SPEC_PATH and README_INSTRUCTIONS to template. Remove state/spec references, derive label from state/label.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:11Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:33:21Z","closed_at":"2026-01-26T12:28:14Z","labels":["rl-spec-hidden"],"dependencies":[{"issue_id":"wx-227e55","depends_on_id":"wx-2163b5","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-2fo","title":"Test sync","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T22:18:22Z","created_by":"unknown","updated_at":"2026-01-26T22:18:50Z","closed_at":"2026-01-26T22:18:50Z","work_type":"mutex"}
{"id":"wx-2mq","title":"Add smoke tests for image builds and configs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T19:43:18Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:45:26Z","work_type":"mutex"}
{"id":"wx-2nt","title":"Performance tuning","description":"Optimize layer ordering in OCI images, tune VM resources for macOS, verify startup times.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:59Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:24:22Z","work_type":"mutex"}
{"id":"wx-2ou","title":"Update ARCHITECTURE.md with gvproxy networking design","description":"Update ARCHITECTURE.md to document gvproxy vsock networking design.\n\n## Content to add:\n1. Diagram showing gvproxy \u003c-\u003e vsock \u003c-\u003e guest networking\n2. Explain why VZNATNetworkDeviceAttachment doesn't work (ICMP-only bug)\n3. Document gvproxy as userspace network stack alternative\n4. Compare with Linux sandbox (pasta) approach\n\n## Files:\n- ARCHITECTURE.md\n\n## Depends on:\n- wx-de3 (implementation)\n- wx-3nl (guest config)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T23:02:23Z","updated_at":"2026-01-09T00:55:00Z","closed_at":"2026-01-09T00:55:00Z","work_type":"mutex"}
{"id":"wx-2ze","title":"Git author passthrough and SSH signing for containers","description":"Enable git commits from containers to use host user's identity and be signed with deploy keys.\n\nGoals:\n1. Git commit author matches host user's git config (overrideable via env vars)\n2. SSH signing using existing deploy key (no agent required)\n3. Commits show as 'Verified' on GitHub\n\nSee plan: ~/.claude/plans/witty-wishing-clover.md","status":"closed","priority":2,"issue_type":"epic","owner":"sandbox@wrapix.dev","created_at":"2026-01-18T17:59:31Z","created_by":"unknown","updated_at":"2026-01-18T18:47:26Z","closed_at":"2026-01-18T18:03:50Z","dependencies":[{"issue_id":"wx-2ze","depends_on_id":"wx-80o","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-2ze","depends_on_id":"wx-buk","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-2ze","depends_on_id":"wx-dc7","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-2ze","depends_on_id":"wx-e8h","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-2ze","depends_on_id":"wx-r4v","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-2ze","depends_on_id":"wx-scc","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-316020","title":"Hidden Spec Mode","description":"Add spec.hidden config option to suppress spec file creation for smaller tasks. When enabled, plan content is stored in state/{label}.md instead of specs/, keeping specs/ clean for significant features.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-26T00:29:52Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:50:25Z","closed_at":"2026-01-26T12:47:40Z","labels":["rl-spec-hidden"],"work_type":"mutex"}
{"id":"wx-316x","title":"Implement ralph sync command","description":"Create lib/ralph/cmd/sync.sh that:\n- Creates .claude/ralph/templates/ with fresh packaged templates\n- Backs up existing customized templates to .claude/ralph/backup/\n- Prints actions taken (verbose by default)\n- Supports --dry-run flag to preview changes\n- Copies all templates including partial/ directory\n\nUpdate lib/ralph/cmd/ralph.sh dispatcher to recognize 'sync' subcommand.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:08Z","created_by":"unknown","updated_at":"2026-01-30T02:54:50Z","closed_at":"2026-01-30T02:54:50Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-327","title":"Squid configuration (squid.nix)","description":"Create lib/sandbox/squid.nix to generate Squid transparent proxy config with blocklist ACLs, JSON logging, WebSocket blocking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-3e686d","title":"Remove state/spec file from start.sh","description":"Update lib/ralph/start.sh to remove state/spec file creation. Keep only state/label file. Remove lines that create/reference state/spec.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:11Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:21:46Z","closed_at":"2026-01-26T12:20:02Z","labels":["rl-spec-hidden"],"dependencies":[{"issue_id":"wx-3e686d","depends_on_id":"wx-2163b5","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-3maq","title":"Update happy-path.sh test for molecule workflow","description":"Update tests/ralph/scenarios/happy-path.sh to:\n1. Use epic as molecule root\n2. Store molecule ID in current.json\n3. Verify molecule creation with bd mol show\n4. Verify progress with bd mol progress\n\nTest should verify:\n- ralph ready creates molecule (epic + child tasks)\n- Molecule ID is stored in state/current.json\n- bd mol progress shows correct completion\n- bd mol current shows correct position","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:36Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:17:58Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-3nl","title":"Configure guest-side vsock networking in entrypoint.sh","description":"Configure guest-side networking to use vsock connection to gvproxy.\n\n## Changes required:\n1. Add vm_gvproxy or equivalent setup in entrypoint.sh\n2. Configure network interface via vsock instead of virtio-net\n3. Set up DNS resolution through gvproxy\n\n## Files:\n- lib/sandbox/darwin/entrypoint.sh\n\n## Depends on:\n- wx-de3 (host-side gvproxy integration)\n\n## Reference:\n- Lima VM guest agent networking setup\n- gvisor-tap-vsock guest configuration","notes":"Not needed: Using VZFileHandleNetworkDeviceAttachment with gvproxy --listen-vfkit bridges directly to virtio-net. Guest sees standard network interface, configured automatically by vminitd.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T23:02:23Z","updated_at":"2026-01-08T23:16:12Z","closed_at":"2026-01-08T23:16:12Z","dependencies":[{"issue_id":"wx-3nl","depends_on_id":"wx-de3","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-3xn","title":"Add shellcheck and statix to CI lint checks","description":"Shell scripts lack automated linting, and statix is only available in dev shell, not in CI checks.\n\n**Missing checks:**\n1. shellcheck for 5+ shell scripts in repo\n2. statix for Nix code quality (available in devshell but not in checks)\n\n**Shell scripts needing linting:**\n- lib/sandbox/linux/entrypoint.sh\n- lib/sandbox/darwin/entrypoint.sh\n- lib/tests/darwin-mount-test.sh\n- lib/tests/darwin-network-test.sh\n- scripts/setup-tailscale-routing.sh\n- scripts/setup-deploy-key\n\n**Fix:** Add shellcheck and statix checks to lib/tests/lint.nix.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-10T19:51:03Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-40b140","title":"Update step.md template with SPEC_PATH placeholder","description":"Update lib/ralph/template/step.md to use {{SPEC_PATH}} instead of hardcoded specs path in the 'Current Spec' section.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:12Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:02:16Z","closed_at":"2026-01-26T12:01:50Z","labels":["rl-spec-hidden"],"dependencies":[{"issue_id":"wx-40b140","depends_on_id":"wx-8cb07e","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-40g","title":"Add aarch64-darwin to flake","description":"Update flake.nix to add aarch64-darwin support alongside Linux systems.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:19:42Z","work_type":"mutex"}
{"id":"wx-46087f","title":"Isolate container Claude config with session persistence","description":"Stop bind-mounting host ~/.claude and ~/.claude.json into containers. Instead:\n1. Mount $PROJECT_DIR/.claude as ~/.claude inside the container\n2. Initialize default config to suppress onboarding\n\nThis isolates containers from host Claude config while persisting sessions in the project directory.\n\n## Changes\n\n### 1. Remove Host Claude Config Mounts\n**File:** lib/sandbox/profiles.nix (lines 40-59)\nRemove baseMounts for ~/.claude, ~/.claude.json, ~/.claude.json.backup\n\n### 2. Add Project .claude Mount in Launcher Scripts\n**File:** lib/sandbox/linux/default.nix\n- mkdir -p \"$PROJECT_DIR/.claude\"\n- Add to VOLUME_ARGS: -v $PROJECT_DIR/.claude:/home/$USER/.claude:rw\n\n**File:** lib/sandbox/darwin/default.nix\n- mkdir -p \"$PROJECT_DIR/.claude\"  \n- Add to MOUNT_ARGS (may need DIR_MOUNTS mechanism for VirtioFS)\n\n### 3. Initialize Default Config in Entrypoints\n**File:** lib/sandbox/linux/entrypoint.sh\n**File:** lib/sandbox/darwin/entrypoint.sh\nCreate ~/.claude.json with {\"hasCompletedOnboarding\": true, \"autoUpdates\": false, \"numStartups\": 1}\n\n## Verification\n1. Start container, no onboarding prompts\n2. ~/.claude.json has correct defaults\n3. ~/.claude mounted from /workspace/.claude\n4. /rename and /resume work across container restarts","status":"closed","priority":1,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-01-22T16:49:13Z","created_by":"unknown","updated_at":"2026-01-22T16:51:17Z","closed_at":"2026-01-22T16:51:17Z","work_type":"mutex"}
{"id":"wx-49te","title":"Update specs/tmux-mcp.md for opt-in MCP mechanism","description":"Update the tmux-mcp spec to document the new opt-in mechanism instead of profiles.\n\nChanges needed:\n1. In 'Debug Profile' section: Replace profile-based examples with mkSandbox mcp parameter examples\n2. In 'Client Configuration' section: Update to show new pattern\n3. In 'Integration' section 'Module Location': Update file structure to reflect deleted profile.nix and new lib/mcp/default.nix\n4. In 'Success Criteria': Update profile composition criterion to reflect opt-in mechanism\n\nNew examples to include:\n```nix\n# Basic usage\nmkSandbox {\n  profile = profiles.rust;\n  mcp = { tmux-debug = { }; };\n}\n\n# With audit logging\nmkSandbox {\n  profile = profiles.rust;\n  mcp = {\n    tmux-debug = { audit = \"/workspace/.debug-audit.log\"; };\n  };\n}\n```\n\nAlso add a new section documenting the MCP opt-in mechanism with the full configuration schema.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:31Z","created_by":"unknown","updated_at":"2026-02-01T20:42:10Z","closed_at":"2026-02-01T20:42:10Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-4ab3","title":"Update ready.md template for molecule creation","description":"Update lib/ralph/template/ready.md to:\n1. Replace bd create pattern with molecule creation\n2. Add molecule ID capture and storage in current.json\n3. Handle update mode: find existing molecule, bond new tasks\n4. Update example commands to show molecule workflow\n\nKey template changes:\n- After creating epic, capture ID for molecule root\n- In update mode, use bd mol bond instead of bd create\n- Include instructions for storing molecule ID\n- Add {{MOLECULE_ID}} placeholder for update mode bonding","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:33Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:21:04Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-4f3g","title":"tmux-mcp: MCP server for AI-assisted debugging","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-30T20:43:48Z","created_by":"unknown","updated_at":"2026-02-01T21:58:41Z","closed_at":"2026-02-01T21:58:39Z","labels":["profile:rust","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-4f3g.1","title":"Scaffold tmux-debug-mcp Rust crate","description":"Create the Rust project structure for the MCP server:\n- Create lib/mcp/tmux/tmux-debug-mcp/ directory\n- Initialize Cargo.toml with dependencies (serde, serde_json, tokio)\n- Create src/main.rs entry point\n- Create empty module files: mcp.rs, tmux.rs, panes.rs, audit.rs\n- Add to workspace if applicable","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:21Z","created_by":"unknown","updated_at":"2026-02-08T10:44:08Z","closed_at":"2026-02-08T10:44:08Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.1","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.10","title":"Write E2E sandbox tests for tmux-mcp","description":"Create end-to-end tests in tests/tmux-mcp/e2e/:\n- test_sandbox_debug_profile.sh: Build image with debug profile, verify tmux+MCP present\n- test_mcp_in_sandbox.sh: Run MCP inside sandbox, create pane, send keys, capture\n- test_profile_composition.sh: Build rust-debug, verify rust toolchain and debug tools\n- test_filesystem_isolation.sh: Verify pane commands only access /workspace\n- Create run-e2e.sh test runner\n- Tests use nix build and podman run","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:39Z","created_by":"unknown","updated_at":"2026-02-01T19:06:26Z","closed_at":"2026-02-01T19:06:24Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.10","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.11","title":"Add tmux-mcp to nix flake check","description":"Integrate tmux-mcp tests into nix flake check:\n- Add unit tests to checks\n- Add integration tests to checks\n- Add E2E tests to checks (optional, may need podman)\n- Verify all tests pass with nix flake check","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:39Z","created_by":"unknown","updated_at":"2026-02-01T19:13:10Z","closed_at":"2026-02-01T19:13:08Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.11","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.2","title":"Implement MCP protocol layer (mcp.rs)","description":"Implement the MCP JSON-RPC protocol handler in mcp.rs:\n- Parse JSON-RPC requests from stdin\n- Route tool calls to appropriate handlers\n- Serialize responses to stdout\n- Handle initialize/initialized handshake\n- Implement tools/list response with 5 tools:\n  - tmux_create_pane\n  - tmux_send_keys\n  - tmux_capture_pane\n  - tmux_kill_pane\n  - tmux_list_panes\n- Format error responses with isError: true\n- Add unit tests for parsing/serialization","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:21Z","created_by":"unknown","updated_at":"2026-02-01T19:17:40Z","closed_at":"2026-02-01T19:17:37Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.2","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.3","title":"Implement tmux command execution (tmux.rs)","description":"Implement tmux session and command management in tmux.rs:\n- Create session on first pane (debug-{pid} naming)\n- Configure remain-on-exit on for pane lifecycle\n- tmux new-window for creating panes\n- tmux send-keys for input\n- tmux capture-pane for output capture\n- tmux kill-window for pane termination\n- tmux kill-session for cleanup on shutdown\n- Handle tmux command errors gracefully\n- Add unit tests (mock command execution)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:21Z","created_by":"unknown","updated_at":"2026-02-01T19:21:27Z","closed_at":"2026-02-01T19:21:25Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.3","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.4","title":"Implement pane state management (panes.rs)","description":"Implement pane state tracking in panes.rs:\n- PaneState struct with id, name, status, command\n- PaneManager for tracking all active panes\n- Unique pane ID generation (debug-N format)\n- Status tracking: running vs exited\n- Pane lookup by ID\n- Remove pane from state on kill\n- Add unit tests for state transitions","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:21Z","created_by":"unknown","updated_at":"2026-02-01T19:24:29Z","closed_at":"2026-02-01T19:24:27Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.4","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.5","title":"Implement audit logging (audit.rs)","description":"Implement optional audit logging in audit.rs:\n- Check TMUX_DEBUG_AUDIT env var for log path\n- JSON Lines format with timestamp, tool, params\n- Log output_bytes count (not full content)\n- Support TMUX_DEBUG_AUDIT_FULL for full captures\n- Append-only logging\n- Add unit tests for log formatting","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:21Z","created_by":"unknown","updated_at":"2026-02-01T19:27:20Z","closed_at":"2026-02-01T19:27:18Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.5","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.6","title":"Wire up MCP tools to tmux/pane handlers","description":"Connect all components in main.rs:\n- Initialize PaneManager\n- Initialize AuditLogger (if configured)\n- Create MCP server with tool handlers\n- Wire tmux_create_pane to TmuxManager.create_pane + PaneManager\n- Wire tmux_send_keys to TmuxManager.send_keys\n- Wire tmux_capture_pane to TmuxManager.capture_pane\n- Wire tmux_kill_pane to TmuxManager + PaneManager\n- Wire tmux_list_panes to PaneManager\n- Handle graceful shutdown (cleanup tmux session)\n- Log all operations if audit enabled","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:21Z","created_by":"unknown","updated_at":"2026-02-01T19:31:15Z","closed_at":"2026-02-01T19:31:12Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.6","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.7","title":"Create Nix package for tmux-debug-mcp","description":"Create the Nix derivation in lib/mcp/tmux/mcp-server.nix:\n- Build Rust binary using buildRustPackage\n- Include runtime dependency on tmux\n- Set up Cargo.lock for reproducibility\n- Add to flake outputs\n- Verify nix build .#tmux-debug-mcp works","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:38Z","created_by":"unknown","updated_at":"2026-02-01T19:36:53Z","closed_at":"2026-02-01T19:36:51Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.7","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.8","title":"Create debug profile for wrapix","description":"Create the debug profile in lib/mcp/tmux/profile.nix:\n- Define profiles.debug with tmux and tmux-debug-mcp packages\n- Configure mcp.servers.tmux-debug with command\n- Support TMUX_DEBUG_AUDIT env var configuration\n- Create example rust-debug profile composition\n- Add to lib/mcp/tmux/default.nix module entry point","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:38Z","created_by":"unknown","updated_at":"2026-02-01T19:41:51Z","closed_at":"2026-02-01T19:41:49Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.8","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4f3g.9","title":"Write integration tests for tmux-mcp","description":"Create integration tests in tests/tmux-mcp/:\n- test_create_pane.sh: Create pane, verify tmux window, verify pane ID\n- test_send_keys.sh: Create shell pane, send echo, capture and verify\n- test_capture_pane.sh: Create pane with seq, capture with line counts\n- test_kill_pane.sh: Create and kill pane, verify removal\n- test_list_panes.sh: Create multiple panes, verify list output\n- test_exited_pane.sh: Create exiting pane, verify status=exited\n- test_error_handling.sh: Test nonexistent pane errors\n- test_audit_log.sh: Enable audit, verify JSON Lines format\n- test_cleanup_on_exit.sh: Kill MCP server, verify session cleanup\n- Create run-integration.sh test runner","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T20:44:38Z","created_by":"unknown","updated_at":"2026-02-01T19:48:24Z","closed_at":"2026-02-01T19:48:22Z","labels":["profile:rust","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-4f3g.9","depends_on_id":"wx-4f3g","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-4o30","title":"Create update-mode.sh test scenario","description":"Create new test scenario tests/ralph/scenarios/update-mode.sh to verify:\n1. ralph plan --update for existing spec works\n2. ralph ready in update mode bonds new tasks to existing molecule\n3. Existing tasks are NOT recreated\n4. New tasks are properly bonded with bd mol bond\n\nTest flow:\n1. Setup with existing spec + molecule\n2. Run ralph plan --update\n3. Run ralph ready (update mode)\n4. Verify new tasks bonded to existing molecule\n5. Verify original tasks unchanged","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:37Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:26:35Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-4ra","title":"Update sandbox prompt","description":"Remove network filtering messaging, reflect container-only isolation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T20:29:03Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:31:10Z","work_type":"mutex"}
{"id":"wx-4re1","title":"Implement Nix-native template definitions with static validation","description":"Create lib/ralph/template/default.nix with mkTemplate function that takes body, partials, and variables. Templates should be validated at Nix evaluation time (assert all required variables provided). Replace current plain markdown approach with Nix expressions. Include templates: plan-new, plan-update, ready-new, ready-update, step.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T01:31:20Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-4uo","title":"Document magic numbers with named constants","description":"Several magic numbers appear throughout the code without explanation.\n\n**Locations:**\n- lib/tests/integration.nix:25-26 - memorySize = 2048; diskSize = 4096;\n- lib/sandbox/image.nix:65 - maxLayers = 100;\n- lib/sandbox/darwin/default.nix:219 - -m 4G (memory limit)\n- lib/sandbox/darwin/default.nix:73 - sleep 2 (arbitrary wait time)\n\n**Impact:** Hard to understand why these specific values were chosen and maintain them consistently.\n\n**Fix:** Add comments explaining the rationale, or extract to named constants where appropriate.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T19:51:37Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-4xz","title":"Test OCI hooks integration","description":"Verify: hook installs correctly, iptables rules applied, blocked domains fail, allowed domains work, file ownership correct in /workspace.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T19:59:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:28:38Z","work_type":"mutex"}
{"id":"wx-4z2j","title":"Update step.md template with molecule bonding","description":"Update lib/ralph/template/step.md to:\n1. Add {{MOLECULE_ID}} placeholder for bonding discovered work\n2. Replace bd create --deps pattern with bd mol bond --type sequential/parallel\n3. Document when to use sequential vs parallel bonding:\n   - Sequential: discovered work blocks current task completion\n   - Parallel: independent work that can be done anytime\n\nReplace current discovered work section:\nFrom: bd create --title=\"...\" --type=task --labels=\"rl-{{LABEL}}\" --deps=\"discovered-from:{{ISSUE_ID}}\"\nTo: bd mol bond {{MOLECULE_ID}} \u003cnew-issue\u003e --type sequential|parallel\n\nAlso update step.sh to pass MOLECULE_ID to template substitution.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:31Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:28:52Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-53r","title":"Fix deploy key lookup - host key verification still failing","description":"The commit d1b85b3 updated deploy key lookup to use repo-hostname format, but SSH still fails with 'Host key verification failed' in the sandbox.\n\n## Symptoms\n- git push fails with 'Host key verification failed'\n- bd sync fails for same reason\n- Deploy key setup appears to have worked but SSH cannot connect\n\n## Likely causes\n1. SSH known_hosts not configured for github.com\n2. Deploy key path still not found correctly\n3. SSH config not pointing to the deploy key\n\n## Files to check\n- lib/sandbox/darwin/default.nix\n- lib/sandbox/linux/default.nix\n- scripts/setup-deploy-key.sh\n- SSH config in container\n\n## To reproduce\n1. Run wrapix sandbox\n2. Try git push or bd sync\n3. Observe 'Host key verification failed'","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-09T01:19:28Z","created_by":"shaun","updated_at":"2026-01-09T19:25:47Z","closed_at":"2026-01-09T19:25:47Z","work_type":"mutex"}
{"id":"wx-560","title":"[Good] Safe path expansion prevents injection","description":"POSITIVE FINDING: Path expansion is safe and limited.\n\n**File:** lib/util/shell.nix:10-18\n\nThe expand_path function only expands:\n- `~` to $HOME\n- $HOME literal\n- $USER literal\n\nIt does NOT:\n- Eval arbitrary shell commands\n- Expand $() or backticks\n- Expand other environment variables\n\nThis prevents command injection via malicious mount paths.","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:57Z","created_by":"unknown","updated_at":"2026-01-26T21:36:32Z","closed_at":"2026-01-26T21:24:27Z","labels":["good-practice","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-582","title":"Linux Claude entrypoint (linux/entrypoint.nix)","description":"Create lib/sandbox/linux/entrypoint.nix - entrypoint script for Claude container with proper environment setup.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:35Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-583","title":"Run NixOS VM integration tests on machine with Nix","description":"Run `nix flake check` to execute the new NixOS VM integration tests (container-start, filesystem-isolation, user-namespace) on a machine with Nix and KVM support. Verify all tests pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T21:12:33Z","created_by":"Shaun","updated_at":"2026-01-10T15:10:28Z","closed_at":"2026-01-10T15:10:28Z","dependencies":[{"issue_id":"wx-583","depends_on_id":"wx-c0h","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-584","title":"Investigate bd daemon sharing between sandbox and host","description":"Running bd with --sandbox flag in the container causes issues with the host's bd daemon. Host bd commands start timing out and falling back to direct mode. Need to investigate:\n- Whether sandbox and host should share the same .beads directory\n- If daemon socket conflicts are causing the issue\n- Best practices for bd in containerized environments\n- Whether the sandbox should have its own isolated .beads or mount the host's","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T21:12:34Z","created_by":"Shaun","updated_at":"2026-01-06T21:21:39Z","closed_at":"2026-01-06T21:21:39Z","work_type":"mutex"}
{"id":"wx-5b2","title":"Test Darwin build with Determinate Nix native-linux-builder","description":"**Original plan**: Use Determinate Nix native-linux-builder.\n\n**Updated plan**: Not using Determinate Nix. Instead, use darwin.linux-builder (nixpkgs) or NixOS podman machine (see wx-c0h).\n\nSteps:\n1. Build wrapix: nix build .#wrapix\n2. Test on macOS 26+\n3. Verify Swift CLI runtime build\n\nDepends on having a working linux builder (wx-c0h or alternative).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:11:42Z","created_by":"shaun","updated_at":"2026-01-10T11:31:42Z","closed_at":"2026-01-07T19:29:59Z","dependencies":[{"issue_id":"wx-5b2","depends_on_id":"wx-c0h","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-5cd","title":"Task A - First task","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T15:29:37Z","created_by":"unknown","updated_at":"2026-01-26T16:38:29Z","closed_at":"2026-01-26T16:38:29Z","labels":["rl-test"],"work_type":"mutex"}
{"id":"wx-5nh4","title":"Implement hook execution in ralph loop.sh","description":"Implement the four hook points in lib/ralph/cmd/loop.sh:\n\nHook points:\n- pre-loop: Before any work starts\n- pre-step: Before each ralph-step\n- post-step: After each ralph-step\n- post-loop: After all work complete\n\nTemplate variable substitution (FR4):\n- {{LABEL}} - Feature label (all hooks)\n- {{ISSUE_ID}} - Current bead ID (pre-step, post-step)\n- {{STEP_COUNT}} - Current iteration number (pre-step, post-step)\n- {{STEP_EXIT_CODE}} - Exit code from ralph-step (post-step only)\n\nFailure handling (FR5):\n- block: Stop loop, exit with error code (default)\n- warn: Log warning to stderr, continue\n- skip: Silently continue\n\nReference implementation in spec:\n```bash\nCONFIG=$(nix eval --json --file \"$CONFIG_FILE\")\nPRE_LOOP=$(echo \"$CONFIG\" | jq -r '.hooks.\"pre-loop\" // empty')\nON_FAILURE=$(echo \"$CONFIG\" | jq -r '.hooks.\"hooks-on-failure\" // \"block\"')\n\nrun_hook() {\n  local hook_name=\"$1\"\n  local hook_cmd=\"$2\"\n  [ -z \"$hook_cmd\" ] \u0026\u0026 return 0\n  hook_cmd=\"${hook_cmd//\\{\\{LABEL\\}\\}/$LABEL}\"\n  # ... other substitutions\n  if \\! eval \"$hook_cmd\"; then\n    case \"$ON_FAILURE\" in\n      block) exit 1 ;;\n      warn) echo \"Warning\" \u003e\u00262 ;;\n      skip) ;;\n    esac\n  fi\n}\n```\n\nAffected file: lib/ralph/cmd/loop.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T18:30:42Z","created_by":"unknown","updated_at":"2026-01-30T19:43:35Z","closed_at":"2026-01-30T19:23:31Z","labels":["spec-pre-commit"],"dependencies":[{"issue_id":"wx-5nh4","depends_on_id":"wx-t6rh","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-5qc5","title":"Consolidate status wrapper tests","description":"Merge 4 status wrapper tests into 1 parameterized test:\n- test_status_wrapper_with_molecule\n- test_status_wrapper_without_molecule\n- test_status_wrapper_no_label\n- test_status_wrapper_stale_warnings\n\nCreate a single test function that loops over test cases with config/expected pairs.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T02:59:23Z","closed_at":"2026-01-30T02:59:23Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-5qzy","title":"Test Epic","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-26T23:32:49Z","created_by":"unknown","updated_at":"2026-01-26T23:35:57Z","closed_at":"2026-01-26T23:35:57Z","labels":["test-mol"],"work_type":"mutex"}
{"id":"wx-5vfv","title":"Test awaiting:input display","notes":"Question: Should we use format A or B?","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T16:11:35Z","created_by":"wrapix","updated_at":"2026-02-08T16:14:28Z","closed_at":"2026-02-08T16:14:28Z","labels":["awaiting:input","spec-live-specs"],"work_type":"mutex"}
{"id":"wx-655b24","title":"Test ID length","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-22T16:16:37Z","created_by":"unknown","updated_at":"2026-01-22T16:16:44Z","closed_at":"2026-01-22T16:16:44Z","work_type":"mutex"}
{"id":"wx-6cg","title":"Claude Code npm package (claude-package.nix)","description":"Create lib/sandbox/claude-package.nix to fetch and install Claude Code from npm registry. Pin version, create wrapper script.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-6h4","title":"[Info] No secret rotation mechanism","description":"The codebase has no built-in mechanism for rotating deploy keys or builder SSH keys.\n\n**Current behavior:**\n- Deploy keys: Manual rotation via setup-deploy-key script with -f flag\n- Builder keys: Generated once in Nix store; rotation requires rebuilding\n\n**Risk:** Long-lived keys increase window of opportunity for compromise.\n\n**Remediation options:**\n1. Document recommended rotation schedule\n2. Add key age checking with warnings\n3. Implement key versioning for gradual rollover","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:16Z","created_by":"unknown","updated_at":"2026-01-26T21:36:32Z","closed_at":"2026-01-26T21:26:40Z","labels":["info","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-6oy","title":"Replace eval with safer path expansion in mount processing","description":"Multiple uses of eval for path expansion in mount processing could be vulnerable to command injection.\n\n**Locations:**\n- lib/sandbox/linux/default.nix:91-92\n- lib/sandbox/darwin/default.nix:129-130  \n- lib/sandbox/darwin/entrypoint.sh:23,38\n\n**Current code:**\n```bash\nsrc=$(eval echo \"$src\")\ndest=$(eval echo \"$dest\")\n```\n\n**Safer alternative:** Use parameter expansion or dedicated path expansion functions instead of eval. Consider using `envsubst` or shell parameter expansion like ${var/#\\~/$HOME}.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T19:50:29Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T21:25:26Z","closed_at":"2026-01-10T21:02:02Z","work_type":"mutex"}
{"id":"wx-6q6","title":"[Good] Debug output truncates values to prevent leakage","description":"POSITIVE FINDING: Debug logging truncates variable values.\n\n**File:** lib/ralph/cmd/util.sh:111,150\n\nExamples:\n- debug \"$desc.$field = ${value:0:50}...\"\n- debug \"$name is set: ${value:0:50}...\"\n\nThis prevents accidental logging of full secret values in debug mode.","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:50:14Z","created_by":"unknown","updated_at":"2026-01-26T21:19:37Z","closed_at":"2026-01-26T21:19:37Z","labels":["good-practice","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-6usw","title":"Test Task A","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:32:53Z","created_by":"unknown","updated_at":"2026-01-26T23:35:57Z","closed_at":"2026-01-26T23:35:57Z","labels":["test-mol"],"dependencies":[{"issue_id":"wx-6usw","depends_on_id":"wx-5qzy","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-6yez","title":"Rewrite status.sh to use bd mol commands","description":"Rewrite lib/ralph/cmd/status.sh to:\n1. Read molecule ID from current.json\n2. Call bd mol progress \u003cmolecule\u003e for completion %, rate, ETA\n3. Call bd mol current \u003cmolecule\u003e to show position in DAG\n4. Call bd mol stale --quiet for hygiene warnings\n\nExpected output format:\n```\nRalph Status: my-feature\n===============================\nMolecule: bd-xyz123\nSpec: specs/my-feature.md\n\nProgress:\n  ▓▓▓▓▓▓▓▓░░ 80% (8/10)\n  Rate: 2.5 steps/hour\n  ETA: ~48 min\n\nCurrent Position:\n  [done]    Setup project structure\n  [current] Write tests         ← you are here\n  [blocked] Final review (waiting on tests)\n```\n\nFall back gracefully if molecule not set (pre-existing behavior).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:31Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:32:14Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-6zy8","title":"Create MCP registry in lib/mcp/default.nix","description":"Create a new lib/mcp/default.nix file that serves as an MCP server registry.\n\nThe registry should:\n- Map server names to their definitions (e.g., tmux-debug)\n- Each server exports: { name, package, mkServerConfig }\n- mkServerConfig takes options and returns MCP server configuration with appropriate env vars\n\nExample structure:\n```nix\n{ pkgs }:\n{\n  servers = {\n    tmux-debug = import ./tmux { inherit pkgs; };\n  };\n}\n```\n\nThis registry will be consumed by mkSandbox to enable MCP servers at sandbox creation time.\n\nSee the new requirements in specs/tmux-mcp.md 'Add MCP Opt-in Mechanism' section.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:01Z","created_by":"unknown","updated_at":"2026-02-01T20:42:24Z","closed_at":"2026-02-01T20:42:24Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-7a2222","title":"Update ready.md template with SPEC_PATH placeholder","description":"Update lib/ralph/template/ready.md to: 1) Use {{SPEC_PATH}} instead of hardcoded path, 2) Add {{README_INSTRUCTIONS}} placeholder for conditional README update instructions.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:11Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:33:21Z","closed_at":"2026-01-26T12:28:18Z","labels":["rl-spec-hidden"],"dependencies":[{"issue_id":"wx-7a2222","depends_on_id":"wx-227e55","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7a4","title":"macOS Nix wrapper (darwin/default.nix)","description":"Create lib/sandbox/darwin/default.nix - Nix wrapper that invokes the Swift runner with correct paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:19:42Z","work_type":"mutex"}
{"id":"wx-7cb","title":"Verify macOS profiles","description":"Verify all profiles work on macOS: VM boots \u003c1s, virtio-fs mounts work, UID mapping works.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:51Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:24:28Z","work_type":"mutex"}
{"id":"wx-7hs","title":"Consider SSH key generation outside Nix store","description":"Medium-severity finding from security review: Private SSH keys generated in Nix store are world-readable. For multi-user systems, consider generating keys in ~/.local/share/wrapix/keys/ with 600 permissions. Current mitigation: localhost-only binding limits remote attack surface. Ref: wx-lhg","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:45:34Z","created_by":"unknown","updated_at":"2026-01-26T21:36:32Z","closed_at":"2026-01-26T21:30:21Z","labels":["rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-7ib","title":"[Good] Builder sshd disables password auth","description":"POSITIVE FINDING: Builder sshd configuration disables password authentication.\n\n**Files:**\n- lib/sandbox/builder/entrypoint.sh:32 - PasswordAuthentication no\n- lib/sandbox/builder/entrypoint.sh:33 - PermitRootLogin no\n- lib/sandbox/builder/entrypoint.sh:34 - AllowUsers builder\n\nThis enforces key-based authentication only and restricts access to a single non-root user.","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:48Z","created_by":"unknown","updated_at":"2026-01-26T21:36:32Z","closed_at":"2026-01-26T21:33:04Z","labels":["good-practice","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-7jj","title":"Review secrets handling","description":"Review deploy key management, environment variable handling, and credential storage.\n\nFocus areas:\n- Deploy key generation and storage\n- Environment variable exposure\n- Credential leakage in logs or errors\n- Secret rotation mechanisms\n- Secrets transmission security\n\nDocument findings with severity ratings.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:21Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:50:54Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-7kd","title":"NixOS VM test type check failure","description":"The NixOS integration tests fail type checking:\n\n```\ntestScriptWithTypes:84: error: Incompatible types in assignment (expression has\ntype \"tuple[int, str]\", variable has type \"str\")  [assignment]\n    result = machine.execute(\n             ^\n```\n\nThe `machine.execute()` returns a tuple (exit_code, output) but the test assigns it to a string variable.\n\nThis blocks `nix flake check` from passing.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T21:24:02Z","created_by":"shaun","updated_at":"2026-01-10T11:31:42Z","closed_at":"2026-01-07T15:06:45Z","work_type":"mutex"}
{"id":"wx-7ls","title":"[INFO] Open network by design - verify documentation","description":"**Finding**: Network egress is unrestricted by design (architecture.md states 'Open network - Full internet access').\n\n**Impact**: Sandboxed code can reach arbitrary internet hosts, DNS resolvers, and external services.\n\n**Analysis**: This is documented and intentional for the use case (AI research, package managers, git). The architecture explicitly states this is NOT protected.\n\n**Recommendation**: Consider adding prominent security callout in user-facing docs that network is NOT restricted. Users should understand sandbox only protects filesystem/processes, not network.\n\n**Severity**: Info (design decision, not vulnerability)","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:38:31Z","created_by":"unknown","updated_at":"2026-01-26T21:36:32Z","closed_at":"2026-01-26T21:34:49Z","labels":["network","rl-security-review"],"work_type":"mutex"}
{"id":"wx-7mv","title":"[Low] OAuth token passed via environment variable","description":"CLAUDE_CODE_OAUTH_TOKEN is passed to containers via environment variable (-e flag).\n\n**Files:** lib/sandbox/linux/default.nix:196, lib/sandbox/darwin/default.nix:242\n\n**Risk:** Environment variables can be read by:\n- Other processes in the container via /proc/$pid/environ\n- Process listing tools\n- Container introspection\n\nHowever, the risk is mitigated because:\n- The container runs as a single user (non-root after entrypoint)\n- The token is already in the host environment\n- The container is isolated\n\n**Remediation options:**\n1. Use secrets file mount instead of env var (e.g., /run/secrets/oauth_token)\n2. Accept current risk as low given container isolation","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:05Z","created_by":"unknown","updated_at":"2026-01-26T21:04:16Z","closed_at":"2026-01-26T21:04:16Z","labels":["low","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-7qp","title":"[INFO] No ingress ports exposed on sandbox containers","description":"**Finding**: Neither Linux nor macOS sandbox containers expose any ingress ports.\n\n**Analysis**:\n- Linux (lib/sandbox/linux/default.nix): No `-p` or `--publish` flags in podman run\n- macOS (lib/sandbox/darwin/default.nix): No port forwarding in container run\n\n**Impact**: Positive security posture - sandbox cannot receive inbound connections from network.\n\n**Verification**:\n- Searched for: `--publish|--port|-p [0-9]` - no matches in sandbox code\n- Only port forwarding found is in wrapix-builder (separate service, not sandbox)\n\n**Note**: The notification daemon (port 5959 on macOS) is a HOST service, not a container service. It's documented in a separate finding (wx-i6m).\n\n**Severity**: Info (positive finding - no vulnerability)","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:38:49Z","created_by":"unknown","updated_at":"2026-01-26T21:20:21Z","closed_at":"2026-01-26T21:20:21Z","labels":["network","rl-security-review"],"work_type":"mutex"}
{"id":"wx-7sj","title":"Linux init container (linux/init-image.nix)","description":"Create lib/sandbox/linux/init-image.nix - minimal ~5MB image with iptables. Sets up transparent proxy redirect rules, DNS filtering, drops other traffic, then exits.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:35Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-7tb","title":"Happy Path Feature","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-26T15:29:37Z","created_by":"unknown","updated_at":"2026-01-26T16:38:33Z","closed_at":"2026-01-26T16:38:33Z","labels":["rl-test"],"work_type":"mutex"}
{"id":"wx-7v05","title":"Simplify Ralph","description":"Systematic simplification of ralph codebase to reduce churn and complexity. See spec for details.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-02T13:36:55Z","created_by":"unknown","updated_at":"2026-02-02T17:36:18Z","closed_at":"2026-02-02T17:36:18Z","labels":["spec-simplify-ralph"],"work_type":"mutex"}
{"id":"wx-7v05.1","title":"Define variable metadata in default.nix","description":"Add variable metadata to lib/ralph/template/default.nix as single source of truth.\n\n## Requirements\n- Define all template variables with metadata (source, required, default values)\n- Structure: variables = { LABEL = { source = \"args\"; required = true; }; ... }\n- Include all existing variables: LABEL, SPEC_CONTENT, PINNED_CONTEXT, SPEC_PATH, etc.\n- Export variable definitions in a format readable by shell scripts (JSON output)\n\n## Files\n- lib/ralph/template/default.nix\n\n## Acceptance\n- All template variables defined with metadata\n- nix eval can output variable definitions as JSON\n- No changes to shell scripts yet (next task)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:37:54Z","created_by":"unknown","updated_at":"2026-02-02T13:44:28Z","closed_at":"2026-02-02T13:44:26Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.1","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.10","title":"Create test library modules","description":"Split run-tests.sh into reusable test infrastructure libraries.\n\n## Requirements\n- Create tests/ralph/lib/ directory structure:\n  - assertions.sh: test_pass, test_fail, assert_* functions\n  - fixtures.sh: setup_*, teardown_* functions\n  - mock-claude.sh: mock infrastructure (move from tests/ralph/)\n  - runner.sh: scenario execution logic\n- Extract reusable functions from run-tests.sh\n- Keep run-tests.sh as thin wrapper\n\n## Files\n- tests/ralph/lib/assertions.sh (create)\n- tests/ralph/lib/fixtures.sh (create)\n- tests/ralph/lib/mock-claude.sh (create)\n- tests/ralph/lib/runner.sh (create)\n- tests/ralph/run-tests.sh (refactor)\n\n## Acceptance\n- Library files contain reusable functions\n- run-tests.sh is significantly smaller\n- All existing tests still pass","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:05Z","created_by":"unknown","updated_at":"2026-02-02T13:54:59Z","closed_at":"2026-02-02T13:54:56Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.10","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.11","title":"Convert test scenarios to JSON format","description":"Convert imperative shell scenarios to declarative JSON format.\n\n## Requirements\n- Create JSON schema for test scenarios\n- Convert existing scenarios to JSON format\n- Update runner.sh to execute JSON scenarios\n- Use JSON (not YAML) per spec recommendation\n\n## Example format:\n{\n  \"name\": \"happy-path\",\n  \"description\": \"Full workflow from plan to completion\",\n  \"phases\": [\n    {\n      \"name\": \"plan\",\n      \"input\": \"Create a feature that does X\",\n      \"expect_signal\": \"RALPH_COMPLETE\"\n    }\n  ]\n}\n\n## Files\n- tests/ralph/scenarios/*.json (create)\n- tests/ralph/lib/runner.sh (update)\n\n## Acceptance\n- At least 3 scenarios converted to JSON\n- runner.sh can execute JSON scenarios\n- Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:06Z","created_by":"unknown","updated_at":"2026-02-02T14:00:18Z","closed_at":"2026-02-02T14:00:16Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.11","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.12","title":"Update specs and documentation","description":"Update specification files with new command names and structure.\n\n## Requirements\n- Update specs/ralph-workflow.md with new commands (todo, run)\n- Update specs/ralph-tests.md with new test structure\n- Remove references to deprecated commands (ready, step, loop, diff)\n- Document new flags (run --once, sync --diff, logs -n)\n\n## Files\n- specs/ralph-workflow.md\n- specs/ralph-tests.md\n\n## Acceptance\n- Specs reflect current command structure\n- No references to deprecated commands\n- New flags documented","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:07Z","created_by":"unknown","updated_at":"2026-02-02T14:05:12Z","closed_at":"2026-02-02T14:05:11Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.12","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.2","title":"Create render_template function in util.sh","description":"Add centralized template rendering function to lib/ralph/cmd/util.sh.\n\n## Requirements\n- Single render_template function for all placeholder substitution\n- Usage: render_template \u003ctemplate-name\u003e [VAR=value ...]\n- Read variable requirements from Nix output\n- Validate all required variables are present before rendering\n- Replace all {{VAR}} placeholders with values\n- Handle multiline values correctly\n\n## Files\n- lib/ralph/cmd/util.sh\n\n## Acceptance\n- render_template function implemented\n- Validates required variables\n- Works with all existing templates\n- Other scripts not yet migrated (next task)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:37:55Z","created_by":"unknown","updated_at":"2026-02-02T14:42:43Z","closed_at":"2026-02-02T14:42:43Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.2","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.3","title":"Migrate scripts to use render_template","description":"Update plan.sh, ready.sh, step.sh to use centralized render_template.\n\n## Requirements\n- Replace inline awk substitutions with render_template calls\n- Remove duplicated placeholder substitution code\n- Ensure all templates render correctly\n\n## Files\n- lib/ralph/cmd/plan.sh\n- lib/ralph/cmd/ready.sh\n- lib/ralph/cmd/step.sh\n\n## Acceptance\n- All three scripts use render_template\n- No inline placeholder substitution remaining\n- Existing tests pass","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:37:57Z","created_by":"unknown","updated_at":"2026-02-02T15:21:11Z","closed_at":"2026-02-02T15:21:11Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.3","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.4","title":"Update check.sh to read variables from Nix","description":"Modify check.sh to read variable definitions from Nix instead of hardcoded dummyVars.\n\n## Requirements\n- Remove hardcoded dummyVars array\n- Read variable definitions from default.nix output\n- Generate dummy values dynamically based on variable metadata\n- Validate templates using actual variable definitions\n\n## Files\n- lib/ralph/cmd/check.sh\n\n## Acceptance\n- check.sh no longer has hardcoded variable list\n- Uses variable metadata from Nix\n- ralph check works correctly","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:37:59Z","created_by":"unknown","updated_at":"2026-02-02T16:02:51Z","closed_at":"2026-02-02T16:02:51Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.4","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.5","title":"Create bd_json wrapper for consistent bd output","description":"Add wrapper function to handle bd JSON output inconsistencies.\n\n## Requirements\n- Create bd_json() function in util.sh\n- Filter stderr from stdout to get clean JSON\n- Usage: bd_json list --format=json (instead of bd list --format=json)\n- Remove or simplify extract_json multi-strategy logic\n\n## Files\n- lib/ralph/cmd/util.sh\n\n## Acceptance\n- bd_json function implemented\n- extract_json simplified to single strategy\n- All scripts using bd for JSON work correctly","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:00Z","created_by":"unknown","updated_at":"2026-02-02T16:12:41Z","closed_at":"2026-02-02T16:12:41Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.5","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.6","title":"Rename ready command to todo","description":"Rename ready.sh to todo.sh and update all references.\n\n## Requirements\n- Rename lib/ralph/cmd/ready.sh to lib/ralph/cmd/todo.sh\n- Update lib/ralph/cmd/ralph.sh dispatch table\n- Update template files (ready-new.md, ready-update.md → todo-new.md, todo-update.md)\n- Update references in other scripts\n- Keep 'ready' as deprecated alias with warning\n\n## Files\n- lib/ralph/cmd/ready.sh → lib/ralph/cmd/todo.sh\n- lib/ralph/template/ready-new.md → lib/ralph/template/todo-new.md\n- lib/ralph/template/ready-update.md → lib/ralph/template/todo-update.md\n- lib/ralph/cmd/ralph.sh\n\n## Acceptance\n- ralph todo works as expected\n- ralph ready shows deprecation warning but still works\n- Tests updated for new command name","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:01Z","created_by":"unknown","updated_at":"2026-02-02T16:25:54Z","closed_at":"2026-02-02T16:25:54Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.6","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.7","title":"Merge step and loop into run command","description":"Consolidate step.sh and loop.sh into single run.sh command.\n\n## Requirements\n- Create lib/ralph/cmd/run.sh combining step and loop functionality\n- Default behavior: loop (execute issues until done)\n- --once/-1 flag: single iteration (replaces step behavior)\n- Extract shared logic to util.sh to avoid 500+ line file\n- Delete step.sh and loop.sh after migration\n- Update ralph.sh dispatch table\n\n## Files\n- lib/ralph/cmd/step.sh (delete)\n- lib/ralph/cmd/loop.sh (delete)\n- lib/ralph/cmd/run.sh (create)\n- lib/ralph/cmd/ralph.sh\n- lib/ralph/cmd/util.sh\n\n## Acceptance\n- ralph run loops until completion\n- ralph run --once executes single issue\n- step/loop commands show deprecation + call run","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:02Z","created_by":"unknown","updated_at":"2026-02-02T16:32:45Z","closed_at":"2026-02-02T16:32:45Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.7","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.8","title":"Rework logs command for error-focused output","description":"Rewrite logs.sh to find errors and show context.\n\n## Requirements\n- Default: Find most recent error, show 20 lines before\n- -n \u003ccount\u003e: Show \u003ccount\u003e lines of context\n- --all: Show full log without error filtering\n- Scan for error patterns: exit code != 0, 'error:', 'failed', stack traces\n- Show context leading up to first match\n\n## Files\n- lib/ralph/cmd/logs.sh\n\n## Acceptance\n- ralph logs finds and highlights errors\n- Context before error is shown\n- --all flag works for full output","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:03Z","created_by":"unknown","updated_at":"2026-02-02T17:08:51Z","closed_at":"2026-02-02T17:08:51Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.8","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-7v05.9","title":"Absorb diff into sync --diff","description":"Merge diff.sh functionality into sync.sh.\n\n## Requirements\n- Add --diff flag to sync.sh that shows template changes\n- Remove diff.sh after migration\n- Update ralph.sh to warn on 'ralph diff' usage\n- Ensure sync --diff shows same output as old diff command\n\n## Files\n- lib/ralph/cmd/diff.sh (delete)\n- lib/ralph/cmd/sync.sh\n- lib/ralph/cmd/ralph.sh\n\n## Acceptance\n- ralph sync --diff works\n- ralph diff shows deprecation warning\n- diff.sh deleted","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-02T13:38:04Z","created_by":"unknown","updated_at":"2026-02-02T17:36:18Z","closed_at":"2026-02-02T17:36:18Z","labels":["profile:base","spec-simplify-ralph"],"dependencies":[{"issue_id":"wx-7v05.9","depends_on_id":"wx-7v05","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-80o","title":"Add git SSH signing config to Darwin entrypoint","description":"Modify lib/sandbox/darwin/entrypoint.sh to configure git SSH signing using the deploy key.\n\nAdd after the SSH config setup (after line 109):\n```bash\n# Configure git SSH signing using deploy key\nif [ -n \"${WRAPIX_DEPLOY_KEY:-}\" ] \u0026\u0026 [ -f \"$WRAPIX_DEPLOY_KEY\" ]; then\n  git config --global gpg.format ssh\n  git config --global user.signingkey \"$WRAPIX_DEPLOY_KEY\"\n  # Create allowed_signers for signature verification\n  mkdir -p \"$HOME/.config/git\"\n  ssh-keygen -y -f \"$WRAPIX_DEPLOY_KEY\" \u003e \"$WRAPIX_DEPLOY_KEY.pub.tmp\" 2\u003e/dev/null || true\n  if [ -f \"$WRAPIX_DEPLOY_KEY.pub.tmp\" ]; then\n    echo \"$GIT_AUTHOR_EMAIL $(cat $WRAPIX_DEPLOY_KEY.pub.tmp)\" \u003e \"$HOME/.config/git/allowed_signers\"\n    rm \"$WRAPIX_DEPLOY_KEY.pub.tmp\"\n    git config --global gpg.ssh.allowedSignersFile \"$HOME/.config/git/allowed_signers\"\n  fi\nfi\n\n# Enable auto-signing if requested\nif [ \"${WRAPIX_GIT_SIGN:-}\" = \"1\" ] || [ \"${WRAPIX_GIT_SIGN:-}\" = \"true\" ]; then\n  git config --global commit.gpgsign true\nfi\n```\n\nFile: lib/sandbox/darwin/entrypoint.sh","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-18T18:00:07Z","created_by":"unknown","updated_at":"2026-01-18T18:47:26Z","closed_at":"2026-01-18T18:03:45Z","dependencies":[{"issue_id":"wx-80o","depends_on_id":"wx-scc","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-885p","title":"Implement ralph check command for template validation","description":"Create lib/ralph/cmd/check.sh that validates all templates: partial files exist, body files parse correctly, no syntax errors in Nix expressions, dry-run render with dummy values to catch placeholder typos. Exit codes: 0=valid, 1=errors with details.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T01:41:44Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-886","title":"Task C - Third task","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T15:29:37Z","created_by":"unknown","updated_at":"2026-01-26T16:38:35Z","closed_at":"2026-01-26T16:38:35Z","labels":["rl-test"],"work_type":"mutex"}
{"id":"wx-89c","title":"SSH/git push not working in container","description":"## Problem\ngit push fails with \"Permission denied (publickey)\" inside the container, even though SSH access should be available.\n\n## Observed\n```\ngit@github.com: Permission denied (publickey).\nfatal: Could not read from remote repository.\n```\n\n## Expected\nDeploy key or SSH agent forwarding should enable git push from within the container.\n\n## Investigation needed\n- Check if deploy key is mounted correctly\n- Verify SSH agent forwarding works\n- Check GIT_SSH_COMMAND / SSH config","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-11T18:09:58Z","created_by":"shaun","updated_at":"2026-01-11T19:50:01Z","closed_at":"2026-01-11T19:50:01Z","work_type":"mutex"}
{"id":"wx-8brr","title":"Add ralph diff integration tests","description":"Create tests for ralph diff command:\n- No local changes (clean output)\n- Local modifications detected\n- Specific template diff (ralph diff step)\n- Missing local templates handled\n\nTest scenarios in tests/ralph/scenarios/diff-*.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T03:15:56Z","closed_at":"2026-01-30T03:15:56Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-8cb07e","title":"Update step.sh to support hidden mode","description":"Update lib/ralph/step.sh to: 1) Read spec.hidden from config, 2) Compute SPEC_PATH based on hidden flag, 3) Skip update_spec_status_to_review README update when hidden=true (print simple completion message instead). Remove state/spec references.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:12Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:02:16Z","closed_at":"2026-01-26T12:01:46Z","labels":["rl-spec-hidden"],"dependencies":[{"issue_id":"wx-8cb07e","depends_on_id":"wx-2163b5","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-8cl","title":"Rewrite Linux orchestration for OCI hooks","description":"Update lib/sandbox/linux/default.nix: remove --userns from pod create, add hook installation, use --userns=keep-id on individual containers, add annotation to trigger hook.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T19:59:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:00:48Z","work_type":"mutex"}
{"id":"wx-8iib","title":"Configure prek stage separation in .pre-commit-config.yaml","description":"Add staged hooks to .pre-commit-config.yaml:\n- pre-commit stage: nixfmt, shellcheck, builtin hooks (trailing-whitespace, end-of-file-fixer, check-merge-conflict)\n- pre-push stage: nix flake check, tests\n\nBuiltin hooks are Rust-native in prek and work offline.\n\nAffected file: .pre-commit-config.yaml\n\nSuccess criteria: prek run executes only fast hooks; slow hooks run on git push","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T18:30:20Z","created_by":"unknown","updated_at":"2026-01-30T19:43:35Z","closed_at":"2026-01-30T19:27:51Z","labels":["spec-pre-commit"],"dependencies":[{"issue_id":"wx-8iib","depends_on_id":"wx-t6rh","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-8k7f","title":"Add RALPH_CLARIFY signal test scenario","description":"Create tests/ralph/scenarios/clarify.sh to test RALPH_CLARIFY signal:\n- Signal detected and handled correctly\n- Issue remains in_progress (not closed)\n- Distinct from RALPH_BLOCKED behavior\n\nEnsure the workflow loop handles CLARIFY differently from BLOCKED and COMPLETE.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T03:32:36Z","closed_at":"2026-01-30T03:24:35Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-8ox","title":"Add GitHub Actions CI/CD workflow","description":"No CI/CD automation exists for the project.\n\n**Current state:**\n- No .github/workflows/ directory\n- Tests must be run manually via 'nix flake check'\n- No automated testing on PRs/commits\n\n**Recommended workflow:**\n1. Automated 'nix flake check' on all PRs\n2. Multi-platform builds (x86_64-linux, aarch64-linux, aarch64-darwin)\n3. Run nixfmt, shellcheck, statix linting\n4. Cache Nix store for faster builds\n\n**Impact:** Without CI, broken changes can be merged without detection.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-10T19:51:49Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-920044","title":"Verify Dolt storage migration","description":"## Summary\n\nVerification that beads successfully migrated from SQLite+JSONL to Dolt-native storage.\n\n## Verification Steps Performed\n\n1. **bd doctor** - System health check\n   - Storage: Dolt ✓\n   - Database version: 0.49.0\n   - Schema compatibility: Working\n   - 64 checks passed, 8 warnings (non-blocking)\n\n2. **bd stats** - Database statistics\n   - Total issues: 98\n   - All 98 closed (no open work)\n   - Database accessible and queryable\n\n3. **bd sync --status** - Sync configuration\n   - Mode: dolt-native (Dolt remotes only, no JSONL)\n   - Federation remote: file:///workspace/.beads/dolt-remote\n   - No pending changes, no conflicts\n\n4. **bd list --status=closed** - Data integrity\n   - All 98 closed issues present\n   - Full details preserved (descriptions, dependencies, metadata)\n   - Hierarchical IDs intact (e.g., wx-ope.1, wx-ope.2)\n\n5. **bd show wx-ope** - Detailed verification\n   - Epic with 5 child tasks fully preserved\n   - Dependency relationships intact\n   - All fields (description, blocks, metadata) present\n\n## Result\n\nMigration successful. Dolt-native storage fully operational.","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-22T16:13:47Z","created_by":"unknown","updated_at":"2026-01-22T16:13:50Z","closed_at":"2026-01-22T16:13:50Z","work_type":"mutex"}
{"id":"wx-9540d2","title":"Add focus detection to notification daemon","description":"Skip notifications when terminal is focused. Attempted implementation with xdotool but didn't match Alacritty window correctly. Needs proper testing to match various terminal window titles.","status":"closed","priority":3,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-01-22T18:10:49Z","created_by":"unknown","updated_at":"2026-01-25T15:50:58Z","closed_at":"2026-01-25T15:50:58Z","work_type":"mutex"}
{"id":"wx-9cc","title":"Fix Darwin container networking with Tailscale exit node","description":"## Problem\n\nContainer networking fails when Tailscale is using an exit node. TCP connections timeout while ICMP (ping) works.\n\n## Root Cause\n\n1. Apple container CLI uses vmnet for networking (192.168.64.0/24 subnet)\n2. When Tailscale exit node is enabled, ALL traffic routes through Tailscale\n3. Container traffic from 192.168.64.x goes to exit node, but exit node can't NAT responses back to that private IP\n4. \"Allow Local Network Access\" in Tailscale only covers physical LAN, not vmnet's virtual network\n\n## Diagnosis Steps Performed\n\n1. Confirmed networking works with Tailscale off\n2. Confirmed ping works but TCP fails with Tailscale on (exit node intercepts TCP)\n3. Confirmed MTU adjustment doesn't help (tried 1220)\n4. Confirmed this is NOT an NSS/DNS issue - added fakeNss, glibc, resolv.conf correctly\n5. Checked Apple container GitHub issues - found #345 (VPN/MTU issues) and #919 (Local Network Privacy)\n\n## Previous Solution (Removed in bcec832)\n\nThe custom Swift runner used gvproxy (gvisor-tap-vsock) for userspace networking:\n- Connected VM to gvproxy via VZFileHandleNetworkDeviceAttachment\n- gvproxy handled NAT in userspace, traffic appeared from host IP\n- Host IP is recognized by Tailscale, so routing worked correctly\n\nThis was removed when migrating to Apple container CLI, which manages vmnet internally and doesn't allow custom network attachments.\n\n## Proposed Solutions\n\n### Option 1: HTTP Proxy on Host (Recommended)\n- Run tinyproxy/mitmproxy on host bound to 192.168.64.1:8080\n- Set HTTP_PROXY/HTTPS_PROXY in container pointing to gateway\n- Traffic: Container → Proxy → Host network (Tailscale) → Exit node → Internet\n- Pros: Simple, works with current architecture\n- Cons: Proxy config needed, some tools don't respect proxy vars\n\n### Option 2: SOCKS Proxy via SSH Tunnel\n- Create SSH tunnel to exit node: ssh -D 1080 exit-node\n- Configure container to use SOCKS proxy\n- Similar to Option 1 but uses SSH instead of HTTP proxy\n\n### Option 3: Revert to Custom Swift Runner\n- Re-add the Swift runner from before bcec832\n- Use gvproxy for networking as before\n- Pros: Transparent networking, no proxy config\n- Cons: Maintains separate code path, more complex\n\n### Option 4: Tailscale Inside Container\n- Run Tailscale daemon inside container\n- Container joins tailnet directly\n- Pros: Full Tailscale features in container\n- Cons: Auth complexity, resource overhead\n\n## Files Changed (Investigation)\n\n- lib/sandbox/image.nix: Added fakeNss, glibc, NSS symlinks, resolv.conf\n- lib/sandbox/darwin/default.nix: Added --dns 1.1.1.1\n- lib/tests/*.nix: Added --dns 1.1.1.1\n\n## Files to Change (Fix)\n\nFor Option 1 (HTTP Proxy):\n- lib/sandbox/darwin/default.nix: Start proxy, add HTTP_PROXY env vars\n- lib/sandbox/darwin/proxy.nix: New file for tinyproxy package/config\n- flake.nix: Add tinyproxy dependency\n\n## Related\n\n- GitHub issue: https://github.com/apple/container/issues/345\n- Commit that removed gvproxy: bcec832","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-09T14:45:36Z","created_by":"shaun","updated_at":"2026-01-09T18:17:49Z","closed_at":"2026-01-09T18:17:49Z","work_type":"mutex"}
{"id":"wx-9nx","title":"Evaluate stable nixpkgs channel for security","description":"Finding: flake.nix:5 uses nixos-unstable channel.\n\nRisk: Rolling release has less predictable CVE backport timeline compared to stable releases.\n\nRecommendation: Evaluate whether nixos-24.11 or another stable release would be appropriate for production use while maintaining needed package versions.\n\nSeverity: Medium","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:43:18Z","created_by":"unknown","updated_at":"2026-01-26T21:14:01Z","closed_at":"2026-01-26T21:14:01Z","labels":["rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-a0u","title":"Update flake.nix for podman","description":"Update flake.nix - replace bubblewrap with podman sandbox, export packages (wrapix, wrapix-rust, wrapix-go, etc.) and lib functions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:36Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-a13n","title":"Live Specs: queryable, verifiable, observable specifications","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-08T14:54:32Z","created_by":"wrapix","updated_at":"2026-02-08T16:16:07Z","closed_at":"2026-02-08T16:16:07Z","labels":["spec-live-specs"],"work_type":"mutex"}
{"id":"wx-a13n.1","title":"Add annotation parsing helpers to util.sh","description":"Add shared helper functions to lib/ralph/cmd/util.sh for parsing [verify](path::fn) and [judge](path::fn) annotations from spec markdown files.\n\nImplementation:\n- Add parse_spec_annotations() function that scans a spec file's Success Criteria section\n- For each '- [ ]' or '- [x]' line, check the next line for [verify](...) or [judge](...) links\n- Extract: criterion text, annotation type (verify/judge/none), file path, function name\n- Output structured data (one record per criterion) suitable for consumption by other commands\n- Add parse_annotation_link() helper to split 'path::function' format\n- Handle edge cases: no Success Criteria section, no annotations, malformed links\n\nFiles to modify:\n- lib/ralph/cmd/util.sh (add functions)\n\nTesting approach: Add inline debug output showing parsed annotations from a spec file","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:56:23Z","created_by":"wrapix","updated_at":"2026-02-08T15:07:44Z","closed_at":"2026-02-08T15:07:44Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.1","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.10","title":"Add --deps flag to ralph sync","description":"Implement ralph sync --deps to print required nix packages for verify and judge tests.\n\nImplementation:\n- Add --deps flag parsing to sync.sh\n- Scan annotations in the current spec (use annotation parsing helpers from util.sh)\n- For each annotated test file, determine what tools/packages it needs\n- Approach: scan test files for common tool references (curl, jq, tmux, etc.) and map to nix packages\n- Output a list suitable for 'nix shell' or profile construction\n- Format: one package per line, suitable for piping to nix shell\n\nFiles to modify:\n- lib/ralph/cmd/sync.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:57:38Z","created_by":"wrapix","updated_at":"2026-02-08T15:13:17Z","closed_at":"2026-02-08T15:13:17Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.10","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.11","title":"Add [verify] and [judge] annotations to existing specs","description":"Add [verify] and [judge] annotation links to success criteria in existing spec files.\n\nImplementation:\n- Review each spec in specs/*.md that has a Success Criteria section\n- For existing test files, add [verify](path::function) annotations linking to the tests\n- For criteria that would benefit from LLM evaluation, add [judge](path::function) annotations\n- Create corresponding judge test files in tests/judges/ for any [judge] annotations added\n- Ensure annotations use standard markdown link syntax (clickable in GitHub and VS Code)\n- Annotation format: on the line after the '- [ ]' criterion\n  - [verify](tests/some-test.sh::test_function_name)\n  - [judge](tests/judges/some.sh::test_function_name)\n- Start with specs that already have corresponding test files in tests/\n\nFiles to modify:\n- specs/*.md (add annotations)\n- tests/judges/*.sh (create judge test files as needed)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:57:47Z","created_by":"wrapix","updated_at":"2026-02-08T15:23:16Z","closed_at":"2026-02-08T15:23:16Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.11","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.12","title":"Add integration tests for ralph spec commands","description":"Create integration tests validating the ralph spec command and its flags.\n\nImplementation:\n- Create test files in tests/ralph/ following existing test patterns\n- Test cases:\n  - ralph spec produces correct annotation counts for a sample spec\n  - ralph spec --verbose shows per-criterion detail\n  - ralph spec --verify runs shell tests and reports PASS/FAIL/SKIP correctly\n  - ralph spec --judge invokes LLM evaluation (can be mocked for test)\n  - ralph spec --all runs both\n  - Annotation parsing handles edge cases (no annotations, malformed links, missing files)\n  - ralph status --watch errors when not in tmux\n- Use existing test infrastructure from tests/ralph/\n\nFiles to create/modify:\n- tests/ralph/test-spec.sh (new)\n- tests/ralph/test-watch.sh (new)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:57:54Z","created_by":"wrapix","updated_at":"2026-02-08T15:31:29Z","closed_at":"2026-02-08T15:31:29Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.12","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.2","title":"Implement ralph spec subcommand with annotation index","description":"Create lib/ralph/cmd/spec.sh implementing the 'ralph spec' subcommand that displays a fast annotation index across all spec files.\n\nImplementation:\n- Create new file lib/ralph/cmd/spec.sh\n- Register 'spec' subcommand in lib/ralph/cmd/ralph.sh dispatcher\n- Default mode (no flags): scan all specs/*.md files, count [verify], [judge], and unannotated criteria\n- Display formatted table:\n  Ralph Specs\n  ============================\n    notifications.md     3 verify, 1 judge, 2 unannotated\n    sandbox.md           0 verify, 0 judge, 5 unannotated\n  Total: 5 verify, 1 judge, 15 unannotated\n- Must be instant: no test execution, no LLM calls\n- Source util.sh and use the annotation parsing helpers from task 1\n- Follow existing command file patterns (shebang, set -euo pipefail, source util.sh)\n- No container detection needed (read-only, runs on host)\n\nFiles to create/modify:\n- lib/ralph/cmd/spec.sh (new)\n- lib/ralph/cmd/ralph.sh (add spec dispatch)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:56:32Z","created_by":"wrapix","updated_at":"2026-02-08T15:38:33Z","closed_at":"2026-02-08T15:38:33Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.2","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.3","title":"Add --verbose flag to ralph spec","description":"Extend ralph spec to support --verbose flag showing per-criterion detail.\n\nImplementation:\n- Add --verbose flag parsing to spec.sh\n- When --verbose: for each spec file, list every criterion with its annotation type:\n  notifications.md:\n    [verify] Notification appears within 2s → tests/notify-test.sh::test_notification_timing\n    [judge]  Clear visibility into current state → tests/judges/notify.sh::test_clear_visibility\n    [none]   Works on both Linux and macOS\n- Show annotation type, criterion text, and linked test path\n- Maintain the summary totals at the bottom\n\nFiles to modify:\n- lib/ralph/cmd/spec.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:56:39Z","created_by":"wrapix","updated_at":"2026-02-08T15:43:21Z","closed_at":"2026-02-08T15:43:21Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.3","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.4","title":"Implement ralph spec --verify runner","description":"Add --verify flag to ralph spec that runs all [verify] shell tests from the current spec's success criteria.\n\nImplementation:\n- Add --verify flag parsing to spec.sh\n- Determine current spec from .wrapix/ralph/state/current.json (label field)\n- For each criterion in the current spec:\n  - If has [verify] annotation: parse path::function, invoke test, report PASS/FAIL\n  - If has [judge] only: report SKIP (judge only)\n  - If no annotation: report SKIP (no annotation)\n- Test execution: if function specified, invoke test file with function name as argument; if file only, run entire file\n- PASS on exit 0, FAIL on non-zero\n- Capture and optionally display stdout/stderr\n- Summary line: N passed, N failed, N skipped\n- Display format:\n  Ralph Verify: \u003cspec-label\u003e (\u003cmolecule-id\u003e)\n  ======================================\n    [PASS] Criterion text\n           path::function (exit 0)\n    [FAIL] Another criterion\n           path::function (exit 1)\n    [SKIP] No annotation criterion (no annotation)\n\nFiles to modify:\n- lib/ralph/cmd/spec.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:56:47Z","created_by":"wrapix","updated_at":"2026-02-08T15:49:20Z","closed_at":"2026-02-08T15:49:20Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.4","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.5","title":"Create judge test infrastructure","description":"Set up the tests/judges/ directory and judge helper functions for LLM-based evaluation rubrics.\n\nImplementation:\n- Create tests/judges/ directory\n- Add judge helper functions to lib/ralph/cmd/util.sh:\n  - judge_files(): sets JUDGE_FILES variable with source files to evaluate\n  - judge_criterion(): sets JUDGE_CRITERION variable with evaluation text\n  - run_judge(): invokes LLM with source files + criterion, returns PASS/FAIL + reasoning\n- The run_judge function should:\n  - Read contents of files specified by judge_files\n  - Construct prompt with file contents + criterion\n  - Call LLM (use existing run_claude_stream or similar pattern from util.sh)\n  - Parse response for PASS/FAIL verdict and reasoning text\n- Create a sample judge test file as reference (tests/judges/example.sh)\n- Judge test file format:\n  test_function_name() {\n    judge_files 'lib/ralph/cmd/status.sh'\n    judge_criterion 'Output includes progress percentage and status indicators'\n  }\n\nFiles to create/modify:\n- tests/judges/ (new directory)\n- tests/judges/example.sh (sample rubric)\n- lib/ralph/cmd/util.sh (judge helper functions)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:56:57Z","created_by":"wrapix","updated_at":"2026-02-08T15:54:35Z","closed_at":"2026-02-08T15:54:35Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.5","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.6","title":"Implement ralph spec --judge runner","description":"Add --judge flag to ralph spec that runs all [judge] LLM evaluations from the current spec's success criteria.\n\nImplementation:\n- Add --judge flag parsing to spec.sh\n- For each criterion in the current spec:\n  - If has [judge] annotation: parse path::function, source judge file, call function to get judge_files and judge_criterion, invoke LLM evaluation\n  - If has [verify] only: report SKIP (verify only)\n  - If no annotation: report SKIP (no annotation)\n- Use the judge infrastructure from task 5 (judge_files, judge_criterion, run_judge)\n- Display format:\n  Ralph Judge: \u003cspec-label\u003e (\u003cmolecule-id\u003e)\n  =====================================\n    [PASS] Criterion text\n           'LLM reasoning text here'\n    [SKIP] Another criterion (verify only)\n- Summary: N passed, N failed, N skipped\n- Also implement --all flag as shorthand for --verify --judge combined\n\nFiles to modify:\n- lib/ralph/cmd/spec.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:57:04Z","created_by":"wrapix","updated_at":"2026-02-08T15:59:31Z","closed_at":"2026-02-08T15:59:31Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.6","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.7","title":"Implement ralph status --watch live view","description":"Add --watch / -w flag to ralph status for an auto-refreshing tmux-based live view.\n\nImplementation:\n- Add --watch / -w flag parsing to status.sh\n- Check $TMUX is set; error with clear message if not in tmux session\n- Create tmux split layout:\n  - Top pane: run 'watch -n5 ralph status' (auto-refreshing molecule progress)\n  - Bottom pane: live tail of agent output if ralph run is active (tail -f on log file)\n  - If no active ralph run: bottom pane shows recent git log + last errors from ralph logs\n- Must work standalone (no active ralph run required)\n- Existing ralph status and ralph logs commands continue working outside tmux unchanged\n\nFiles to modify:\n- lib/ralph/cmd/status.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:57:13Z","created_by":"wrapix","updated_at":"2026-02-08T16:03:57Z","closed_at":"2026-02-08T16:03:57Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.7","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.8","title":"Add awaiting:input label handling to ralph run","description":"Implement RALPH_CLARIFY signal handling and awaiting:input convention in the ralph run orchestrator.\n\nImplementation:\n- In lib/ralph/cmd/run.sh, detect RALPH_CLARIFY signal in agent output\n- When detected: extract question text from the signal\n- Add 'awaiting:input' label to the current bead: bd update \u003cid\u003e --labels 'awaiting:input'\n- Store question in bead notes: bd update \u003cid\u003e --notes 'Question: \u003ctext\u003e'\n- In the work selection loop, skip beads with 'awaiting:input' label (they are not truly ready)\n- The filtering should happen when selecting next work item, before the execution step\n- Human workflow: answer question, remove label (bd update \u003cid\u003e --labels '-awaiting:input'), bead becomes ready again\n- Convention is tracker-agnostic: uses labels, not custom status fields\n\nFiles to modify:\n- lib/ralph/cmd/run.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:57:23Z","created_by":"wrapix","updated_at":"2026-02-08T16:10:52Z","closed_at":"2026-02-08T16:10:52Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.8","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a13n.9","title":"Surface awaiting:input items in ralph status","description":"Update ralph status to display beads with awaiting:input label distinctly, showing the question text and age.\n\nImplementation:\n- In lib/ralph/cmd/status.sh, query beads with 'awaiting:input' label\n- Display them in a distinct section:\n  [awaiting] wx-q6x-10  Cross-platform CI\n               'Should CI use GitHub Actions or Buildkite?' (2h ago)\n- Show: status indicator [awaiting], bead ID, title, question text from notes, and time since question was asked\n- Awaiting items should be visually distinct from in_progress/blocked items\n- Parse question from bead notes (look for 'Question: ...' format)\n\nFiles to modify:\n- lib/ralph/cmd/status.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T14:57:31Z","created_by":"wrapix","updated_at":"2026-02-08T16:16:07Z","closed_at":"2026-02-08T16:16:07Z","labels":["profile:base","spec-live-specs"],"dependencies":[{"issue_id":"wx-a13n.9","depends_on_id":"wx-a13n","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a2p","title":"Add NixOS VM integration tests","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T19:43:18Z","created_by":"shaun","updated_at":"2026-01-10T15:10:28Z","closed_at":"2026-01-10T15:10:28Z","dependencies":[{"issue_id":"wx-a2p","depends_on_id":"wx-c0h","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h","title":"Skip Tests: Audit and Fix Test Skip Hygiene","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-08T19:28:49Z","created_by":"wrapix","updated_at":"2026-02-08T20:13:03Z","closed_at":"2026-02-08T20:13:03Z","labels":["spec-skip-tests"],"work_type":"mutex"}
{"id":"wx-a47h.1","title":"FR1+FR2: Update test_skip to exit 77, add test_not_implemented exit 78","description":"Foundation task. Update tests/ralph/lib/assertions.sh:\n- Modify test_skip() (line 29) to print message to stderr AND exit 77 (not just increment counter)\n- Add test_not_implemented() function that prints message to stderr AND exits 78\n- Both should include reason in their output message\n- Update tests/ralph/lib/runner.sh:\n  - run_test_isolated() (line 46-78): detect exit codes 77 and 78 from subshell, track separately\n  - Result file format: add not_implemented= key alongside passed/failed/skipped\n  - run_tests_parallel() and run_tests_sequential(): aggregate not_implemented counts\n  - print_test_summary() (line 272-297): show 4-category breakdown: passed/failed/skipped(77)/not-implemented(78)\n  - Ensure exit 77 and 78 do NOT cause overall test suite failure (only exit 1 = fail)\n\nIMPORTANT: test_skip currently just increments SKIPPED counter and returns. The new behavior should EXIT the test subshell with code 77. Similarly test_not_implemented exits with 78. The runner must catch these exit codes and categorize them.\n\nFiles: tests/ralph/lib/assertions.sh, tests/ralph/lib/runner.sh\nSpec refs: FR1, FR2, FR7","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:31:05Z","created_by":"wrapix","updated_at":"2026-02-08T19:43:02Z","closed_at":"2026-02-08T19:43:02Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.1","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.10","title":"FR3: Fix tmux-mcp test prerequisites, remove command -v guards","description":"The tmux-mcp tests run inside a NixOS VM (tests/tmux-mcp.nix) that already includes tmux and tmux-debug-mcp in environment.systemPackages. The command -v guards are redundant in the VM context.\n\nPart 1: Verify tests/tmux-mcp.nix includes these in the VM:\n- tmux (integration tests)\n- tmux-debug-mcp (integration tests)\n- jq (integration tests - run-integration.sh line 120)\n- nix (e2e tests)\n- podman (e2e tests)\n\nIf any are missing, add them to the appropriate test derivation.\n\nPart 2: Remove command -v guards from:\n- tests/tmux-mcp/run-integration.sh: lines 114-137 (tmux, jq, tmux-debug-mcp checks) and line 254 (graceful skip exit 0)\n- tests/tmux-mcp/test_audit_log.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_cleanup_on_exit.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_create_pane.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_exited_pane.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_send_keys.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_kill_pane.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_list_panes.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_error_handling.sh: command -v tmux/jq guards\n- tests/tmux-mcp/test_capture_pane.sh: command -v tmux/jq guards\n\nEach test file has the pattern at lines ~14-24:\n  if \\! command -v tmux \u0026\u003e/dev/null; then\n    echo \"SKIP: tmux not found\"\n    exit 0\n  fi\n  if \\! command -v jq \u0026\u003e/dev/null; then\n    echo \"SKIP: jq not found\"\n    exit 0\n  fi\n\nRemove these guards entirely since the VM provides the binaries.\n\nFor e2e tests (tests/tmux-mcp/e2e/*.sh), check for command -v nix and command -v podman guards and remove if the e2e VM provides them.\n\nFiles: tests/tmux-mcp.nix, tests/tmux-mcp/run-integration.sh, tests/tmux-mcp/test_*.sh, tests/tmux-mcp/e2e/test_*.sh\nSpec ref: FR3","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:33:01Z","created_by":"wrapix","updated_at":"2026-02-08T19:47:49Z","closed_at":"2026-02-08T19:47:49Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.10","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.11","title":"Doc: Document exit code convention in specs/ralph-tests.md","description":"Update specs/ralph-tests.md to document the test exit code convention (FR1):\n\nAdd a section documenting:\n\n| Exit Code | Meaning | When to Use |\n|-----------|---------|-------------|\n| 0 | Pass | Test ran and succeeded |\n| 1 | Fail | Test ran and failed |\n| 77 | Skip | Test cannot run on this platform/environment (legitimate) |\n| 78 | Not Yet Implemented | Test exists for a feature that hasn't been built yet |\n\nInclude:\n- When to use exit 77 (platform checks, missing hardware, runtime conditions)\n- When to use exit 78 (feature not built yet, config option doesn't exist)\n- How the test runner handles these codes (non-failure, separate counters)\n- Summary format: 'Results: X passed, Y failed, Z skipped (exit 77), W not implemented (exit 78)'\n- Note that Nix derivation tests (*.nix) must still exit 0 since Nix requires it for build success; the exit 77/78 convention applies to standalone shell test scripts only\n- NFR1: Every skip must print a message explaining why\n\nAlso update specs/README.md if needed.\n\nFiles: specs/ralph-tests.md\nSpec ref: FR1, FR7, NFR1, NFR2","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:33:12Z","created_by":"wrapix","updated_at":"2026-02-08T19:49:26Z","closed_at":"2026-02-08T19:49:26Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.11","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.3","title":"FR5: Convert Darwin shell test skips from exit 0 to exit 77","description":"Convert platform-dependent skips in Darwin shell tests to exit 77:\n\nFiles and changes:\n- tests/darwin/mount-test.sh lines 11-14: change exit 0 to exit 77 on platform check\n- tests/darwin/network-test.sh lines 9-12: change exit 0 to exit 77 on platform check\n- tests/darwin/uid-test.sh lines 13-16: change exit 0 to exit 77 on platform check\n\nPattern: if [[ \"$(uname -s)\" \\!= \"Darwin\" ]]; then echo SKIP...; exit 0; fi\nChange: exit 0 → exit 77\n\nThese are legitimate platform skips. Only change the exit code, nothing else.\n\nSpec ref: FR5","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:31:28Z","created_by":"wrapix","updated_at":"2026-02-08T19:50:32Z","closed_at":"2026-02-08T19:50:32Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.3","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.4","title":"FR5: Convert Nix-based test skips from exit 0 to exit 77","description":"Convert platform/environment skips in Nix test derivations to exit 77:\n\nDarwin Nix tests (tests/darwin/*.nix - uid.nix, network.nix, mounts.nix, default.nix):\n- All exit 0 in platform checks (uname \\!= Darwin) → exit 77\n- All exit 0 in macOS version checks (\u003c 26) → exit 77\n- All exit 0 in console user checks → exit 77\n- All exit 0 in container CLI checks → exit 77\n- All exit 0 in container system running checks → exit 77\n- All exit 0 in storage access checks → exit 77\n\nSmoke tests (tests/smoke.nix):\n- Line 54-58: skipImageTest conditional already creates a skip derivation with echo SKIP. Need to add exit 77 to the inline script IF the derivation test script uses exit 0 after echo. Check if runCommandLocal scripts exit implicitly. If so, the skip is fine as-is since Nix derivation success = the skip marker file was created.\n\nIMPORTANT for Nix tests: These use runCommandLocal or writeShellScript inside Nix derivations. The exit 77 must NOT cause the Nix derivation to fail. In Nix, a non-zero exit code fails the build. So for Nix derivations, the skip should still exit 0 (creating $out) but ALSO echo the skip with exit code info. The exit 77 convention only applies to standalone shell scripts, not Nix build scripts. For Nix tests, keep exit 0 but ensure the SKIP message is printed. Alternatively, wrap in a way that catches 77 and treats it as success.\n\nActually - re-reading the spec: the Nix derivation tests (darwin/*.nix, smoke.nix) run scripts that must exit 0 for the derivation to succeed. The exit 77 convention applies to shell test scripts run by the runner, not Nix build scripts. For Nix derivations that skip, the current pattern (echo SKIP + mkdir $out + exit 0) is correct because the Nix build system requires exit 0. Only standalone shell scripts (darwin/*.sh, builder-test.sh, notify-test.sh) should use exit 77.\n\nRevised scope: Only change darwin/*.sh files (handled in T2) and leave Nix derivation skips as-is since they must exit 0 for Nix compatibility. Document this distinction in specs/ralph-tests.md.\n\nActually the spec says to change darwin/*.nix too. Let me check the affected files list again.\n\nThe spec lists: 'tests/darwin/*.nix — Change exit 0 to exit 77 on platform/version/container checks' and 'tests/smoke.nix — Change exit 0 to exit 77 on platform checks and SKIP_IMAGE_TEST'.\n\nSo the spec requires exit 77 in Nix scripts too. But this will break Nix derivation builds since non-zero exit fails the build. The fix must wrap the test script to catch exit 77 and still create $out. This requires modifying the Nix derivation wrapper to handle exit 77 gracefully.\n\nApproach: In each Nix test derivation, wrap the test script so that:\n1. The test script itself exits 77 for skips\n2. The Nix derivation script catches exit code 77 and creates $out anyway (so the derivation succeeds)\n3. The skip message is propagated\n\nThis is a non-trivial change to the Nix test infrastructure.\n\nFiles: tests/darwin/uid.nix, tests/darwin/network.nix, tests/darwin/mounts.nix, tests/darwin/default.nix, tests/smoke.nix\nSpec ref: FR5","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:31:53Z","created_by":"wrapix","updated_at":"2026-02-08T19:57:53Z","closed_at":"2026-02-08T19:57:53Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.4","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.5","title":"FR5: Fix builder-test.sh platform skip from exit 1 to exit 77","description":"In tests/builder-test.sh, the macOS version check currently exits with code 1 (ERROR) for platform skips. This should be exit 77 (SKIP).\n\nCurrent code (around line 6-9):\n  MACOS_VERSION=$(sw_vers -productVersion | cut -d. -f1)\n  if [ \"$MACOS_VERSION\" -lt 26 ]; then\n    echo \"ERROR: Requires macOS 26+ (current: $(sw_vers -productVersion))\"\n    exit 1\n  fi\n\nChange to:\n  if [ \"$MACOS_VERSION\" -lt 26 ]; then\n    echo \"SKIP: Requires macOS 26+ (current: $(sw_vers -productVersion))\"\n    exit 77\n  fi\n\nAlso update: If there's a non-Darwin platform check (uname), change that exit to 77 too.\n\nFiles: tests/builder-test.sh\nSpec ref: FR5 (Success Criteria: tests/builder-test.sh uses exit 77 not exit 1)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:32:03Z","created_by":"wrapix","updated_at":"2026-02-08T19:58:54Z","closed_at":"2026-02-08T19:58:54Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.5","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.6","title":"FR5: Fix notify-test.sh socket skip from exit 0 to exit 77","description":"In tests/notify-test.sh, the notification socket skip guard uses exit 0.\n\nCurrent code (graceful skip when daemon not running):\n  if [ -S \"$SOCKET\" ]; then\n    # test socket\n  else\n    echo \"SKIP: Socket not mounted (daemon may not be running on host)\"\n    exit 0\n  fi\n\nChange exit 0 to exit 77 for the socket skip.\n\nAlso check for any other exit 0 skip patterns in the file and convert them.\n\nFiles: tests/notify-test.sh\nSpec ref: FR5","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:32:12Z","created_by":"wrapix","updated_at":"2026-02-08T20:00:03Z","closed_at":"2026-02-08T20:00:03Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.6","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.7","title":"FR5+FR6: Categorize test_skip calls in run-tests.sh as skip(77) or not-implemented(78)","description":"In tests/ralph/run-tests.sh, convert test_skip calls to the appropriate category.\n\nConvert to test_not_implemented (exit 78) - features not yet built:\n- Line 1735: test_skip \"loop.max-iterations (not yet implemented)\" → test_not_implemented\n- Line 1847: test_skip \"loop.pause-on-failure=false (not yet implemented)\" → test_not_implemented  \n- Line 2302: test_skip \"failure-patterns (not yet implemented)\" → test_not_implemented\n- Line 303: test_skip \"bd mol current position markers (ad-hoc epics not yet supported)\" → test_not_implemented\n\nKeep as test_skip (exit 77) - legitimate runtime/platform skips:\n- Line 63: test_skip \"echo.sh scenario not found\" → keep as test_skip (runtime conditional)\n- Line 1085: test_skip \"Task C blocked-by-in_progress filtering (known bd limitation)\" → keep as test_skip\n- Line 1110: test_skip \"Correct task selection (bd --ready limitation)\" → keep as test_skip\n- Lines 2579, 2607, 2645, 2673, 2708, 2714: bd mol bond runtime conditionals → keep as test_skip\n\nIMPORTANT: After T1 is complete, test_skip will exit 77 and test_not_implemented will exit 78. Each call to these functions will EXIT the test subshell. Make sure the call sites are at points where exiting is appropriate (they currently return after test_skip, so the exit should be fine).\n\nReview each call site to ensure cleanup (teardown_test_env) happens before the skip/not-implemented call, since the function now exits instead of returning.\n\nFiles: tests/ralph/run-tests.sh\nSpec ref: FR5, FR6","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:32:26Z","created_by":"wrapix","updated_at":"2026-02-08T20:04:15Z","closed_at":"2026-02-08T20:04:15Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.7","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.8","title":"FR3: Add ralph-spec to test runner PATH, remove has_ralph_spec guards","description":"Two-part task:\n\nPart 1: Fix tests/default.nix to include ralph-spec in the ralph integration test runner's PATH/nativeBuildInputs. The ralph-spec binary is built as part of the project. Find where it's defined (likely in lib/ralph/cmd/spec.sh or a Nix derivation) and add it to the test derivation's dependencies.\n\nPart 2: Remove all has_ralph_spec guards from tests/ralph/test-spec.sh. There are 20 occurrences at lines: 79, 158, 247, 351, 412, 486, 893, 945, 997, 1066, 1120, 1168, 1216, 1294, 1343, 1391, 1461, 1524, 1587, 1658.\n\nEach guard follows this pattern (remove the entire if block):\n  if \\! has_ralph_spec; then\n    test_skip \"ralph-spec command not available (spec.sh not yet implemented)\"\n    teardown_test_env\n    return\n  fi\n\nAlso remove the has_ralph_spec() function definition at lines 25-27:\n  has_ralph_spec() {\n    command -v ralph-spec \u0026\u003e/dev/null\n  }\n\nAfter removal, these 20 tests should run and pass because ralph-spec is now in PATH.\n\nFiles: tests/default.nix, tests/ralph/test-spec.sh\nSpec ref: FR3 (Success Criteria: ralph-spec tests run without skipping - 18+ tests fixed)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:32:37Z","created_by":"wrapix","updated_at":"2026-02-08T20:08:35Z","closed_at":"2026-02-08T20:08:35Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.8","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a47h.9","title":"FR4: Fix RALPH_METADATA_DIR propagation, remove env var guards","description":"The integration runner in tests/default.nix line ~114 already sets RALPH_METADATA_DIR. But 4 tests in tests/ralph/run-tests.sh still guard on it:\n\nLines 3995-3996: test_render_template_missing_required()\nLines 4084-4085: test_render_template_env_vars()\nLines 4135-4136: test_get_template_variables()\nLines 4181-4182: test_get_variable_definitions()\n\nEach has pattern:\n  if [ -z \"${RALPH_METADATA_DIR:-}\" ]; then\n    test_skip \"RALPH_METADATA_DIR not set (run via nix build .#ralphTests)\"\n    return\n  fi\n\nTask:\n1. Verify that RALPH_METADATA_DIR is properly set in the Nix test runner for these tests\n2. If yes: remove all 4 guards (the env var is guaranteed to be set)\n3. If no: fix the Nix test derivation to propagate RALPH_METADATA_DIR, then remove guards\n\nAlso add bd and ralph-run to the test runner PATH if not already present (FR3 table mentions these).\n\nFiles: tests/default.nix, tests/ralph/run-tests.sh\nSpec ref: FR3, FR4","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T19:32:47Z","created_by":"wrapix","updated_at":"2026-02-08T20:13:03Z","closed_at":"2026-02-08T20:13:03Z","labels":["profile:base","spec-skip-tests"],"dependencies":[{"issue_id":"wx-a47h.9","depends_on_id":"wx-a47h","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-a8l","title":"Implement full Darwin support with Containerization framework","description":"The Darwin sandbox currently shows a 'not yet implemented' message. Full support requires:\n\n1. Swift 6.0 in nixpkgs (currently 5.10.1)\n2. Working Darwin-to-Linux cross-compilation for container images\n3. Pre-built kernel or kernel build support on Darwin\n\nThe infrastructure is in place (Swift source, kernel config) but blocked on nixpkgs toolchain support.\n\nRelated files:\n- lib/sandbox/darwin/default.nix\n- lib/sandbox/darwin/kernel.nix\n- lib/sandbox/darwin/swift/","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:23:49Z","created_by":"shaun","updated_at":"2026-01-10T15:13:55Z","closed_at":"2026-01-10T15:13:55Z","work_type":"mutex"}
{"id":"wx-a931","title":"Delete lib/mcp/tmux/profile.nix","description":"Delete the lib/mcp/tmux/profile.nix file entirely.\n\nThis file currently defines debug profiles (debug, debug-audited, rust-debug, mkAuditedDebug) which are being replaced by the opt-in MCP mechanism at mkSandbox time.\n\nAfter deletion, ensure lib/mcp/tmux/default.nix no longer imports this file.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:30Z","created_by":"unknown","updated_at":"2026-02-01T20:42:10Z","closed_at":"2026-02-01T20:42:10Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-ac4n","title":"ralph diff test fails: Output should mention step template","description":"The test_diff_local_modifications test in tests/ralph/run-tests.sh fails with: 'FAIL: Output should mention step template'. The test passes the other assertions (output indicates local template changes, diff shows custom changes) but fails to find 'step' or 'step.md' in the output.","status":"closed","priority":2,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-01-30T16:46:01Z","created_by":"unknown","updated_at":"2026-01-30T20:05:10Z","closed_at":"2026-01-30T20:03:15Z","work_type":"mutex"}
{"id":"wx-ad9r","title":"Ralph Workflow: Spec-driven AI orchestration","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:14Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T02:20:42Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-agd3","title":"mkRalph doesn't pass packages/mounts/env to mkSandbox","status":"closed","priority":2,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-01-29T23:38:44Z","created_by":"unknown","updated_at":"2026-01-29T23:40:09Z","closed_at":"2026-01-29T23:40:09Z","work_type":"mutex"}
{"id":"wx-apl","title":"Add vmnet support for full internet access (requires Apple Developer cert)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T22:48:53Z","updated_at":"2026-01-08T23:03:48Z","closed_at":"2026-01-08T23:03:48Z","work_type":"mutex"}
{"id":"wx-axe","title":"Merge ralph start into plan","description":"Remove start.sh and absorb its logic into plan.sh. Substitution should happen fresh on each 'ralph plan \u003clabel\u003e' run, reading from state file. Update ralph.sh to remove start command routing. Fix the stale template substitution bug by keeping templates as templates with placeholders.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:42Z","created_by":"unknown","updated_at":"2026-01-26T13:46:38Z","closed_at":"2026-01-26T13:46:13Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-ayz","title":"Test Nix builds inside container","description":"## Context\nCommit 1ae8835 added includeNixDB=true and sandbox=false to enable Nix builds inside containers.\n\n## Test plan\n1. Rebuild container image with the new changes\n2. Enter container and verify:\n   - `nix flake check` completes successfully (with builds)\n   - `nix build .#somePackage` works\n   - `nix develop` enters a dev shell\n   - Nix can fetch from cache.nixos.org\n\n## Success criteria\n- Nix commands work without errors about missing store paths\n- Builds complete (may take time to fetch deps on first run)\n- No host /nix/store access required","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T18:11:17Z","created_by":"shaun","updated_at":"2026-01-11T19:23:39Z","closed_at":"2026-01-11T19:23:39Z","work_type":"mutex"}
{"id":"wx-b2f659","title":"Update plan.sh to support hidden mode","description":"Update lib/ralph/plan.sh to: 1) Read spec.hidden from config via nix eval/jq, 2) Compute SPEC_PATH based on hidden flag (state/{label}.md vs specs/{label}.md), 3) Pass SPEC_PATH and README_INSTRUCTIONS to template. Remove state/spec references.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:11Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:41:30Z","closed_at":"2026-01-26T12:41:05Z","labels":["rl-spec-hidden"],"dependencies":[{"issue_id":"wx-b2f659","depends_on_id":"wx-2163b5","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-b3a6b2","title":"Update plan.md template with SPEC_PATH placeholder","description":"Update lib/ralph/template/plan.md to: 1) Replace hardcoded specs path with {{SPEC_PATH}}, 2) Add {{README_INSTRUCTIONS}} placeholder for conditional README update section (empty when hidden=true).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T00:30:11Z","created_by":"Shaun Taheri","updated_at":"2026-01-26T12:41:30Z","closed_at":"2026-01-26T12:41:23Z","labels":["rl-spec-hidden"],"dependencies":[{"issue_id":"wx-b3a6b2","depends_on_id":"wx-b2f659","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-b59","title":"Simplify Linux orchestration","description":"Single container with direct network (pasta), remove init/squid sidecars","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T20:29:03Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:30:08Z","work_type":"mutex"}
{"id":"wx-b72","title":"[Good] Builder SSH port localhost only","description":"POSITIVE FINDING: Builder SSH port is bound to localhost only.\n\n**File:** lib/builder/default.nix:190\n```\n-p \"127.0.0.1:$SSH_PORT:22\"\n```\n\nThis prevents remote access to the builder SSH service, significantly reducing attack surface.","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:47Z","created_by":"unknown","updated_at":"2026-01-26T21:45:58Z","closed_at":"2026-01-26T21:37:21Z","labels":["good-practice","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-b8q","title":"Fix util.sh not found in ralph-step","description":"ralph-step failed with 'util.sh: No such file or directory' because writeShellScriptBin doesn't install the sourced file. Fixed by adding util.sh as a writeTextFile to the scripts list.","status":"closed","priority":1,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-01-26T12:15:45Z","created_by":"unknown","updated_at":"2026-01-26T12:23:41Z","closed_at":"2026-01-26T12:22:54Z","work_type":"mutex"}
{"id":"wx-bc9","title":"Unify test command in flake.nix","description":"Add .#test target to flake.nix that runs all tests: darwin tests (skipped gracefully on Linux), integration tests, ralph tests. Tests should be deterministic, fast, isolated. Create tests/ralph/default.nix for Nix test derivation.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:50Z","created_by":"unknown","updated_at":"2026-01-26T14:02:23Z","closed_at":"2026-01-26T13:54:11Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-bg2q","title":"Refactor run_spec_tests to iterate all specs by default with grouped output","description":"Refactor run_spec_tests() in lib/ralph/cmd/spec.sh to run across all spec files by default instead of only the current spec. When --spec/-s is NOT provided: iterate all specs in specs/ (excluding README.md), skip specs with no success criteria silently, group results by spec with per-spec headers, end with cross-spec summary line 'Summary: X passed, Y failed, Z skipped (N specs)', exit non-zero if any failure. When --spec/-s IS provided: run only against specs/\u003cname\u003e.md, output matches single-spec format. For molecule ID lookup per spec, check specs/README.md Beads column. Affected file: lib/ralph/cmd/spec.sh (run_spec_tests function)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T17:24:07Z","created_by":"wrapix","updated_at":"2026-02-08T17:35:54Z","closed_at":"2026-02-08T17:35:54Z","labels":["profile:base","spec-live-specs"],"work_type":"mutex"}
{"id":"wx-buk","title":"Add git author env var passthrough to Linux launcher","description":"Modify lib/sandbox/linux/default.nix to read host's git config and pass as env vars.\n\nAdd before container launch:\n```bash\nGIT_AUTHOR_NAME=\"${GIT_AUTHOR_NAME:-$(git config --global user.name 2\u003e/dev/null || echo 'Wrapix Sandbox')}\"\nGIT_AUTHOR_EMAIL=\"${GIT_AUTHOR_EMAIL:-$(git config --global user.email 2\u003e/dev/null || echo 'sandbox@wrapix.dev')}\"\nGIT_COMMITTER_NAME=\"${GIT_COMMITTER_NAME:-$GIT_AUTHOR_NAME}\"\nGIT_COMMITTER_EMAIL=\"${GIT_COMMITTER_EMAIL:-$GIT_AUTHOR_EMAIL}\"\n```\n\nThen pass to container via -e flags:\n```bash\n-e \"GIT_AUTHOR_NAME=$GIT_AUTHOR_NAME\"\n-e \"GIT_AUTHOR_EMAIL=$GIT_AUTHOR_EMAIL\"\n-e \"GIT_COMMITTER_NAME=$GIT_COMMITTER_NAME\"\n-e \"GIT_COMMITTER_EMAIL=$GIT_COMMITTER_EMAIL\"\n```\n\nAlso pass through WRAPIX_GIT_SIGN if set:\n```bash\n[ -n \"${WRAPIX_GIT_SIGN:-}\" ] \u0026\u0026 EXTRA_ARGS=\"$EXTRA_ARGS -e WRAPIX_GIT_SIGN=$WRAPIX_GIT_SIGN\"\n```\n\nFile: lib/sandbox/linux/default.nix","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-18T18:00:04Z","created_by":"unknown","updated_at":"2026-01-18T18:47:26Z","closed_at":"2026-01-18T18:03:45Z","work_type":"mutex"}
{"id":"wx-bvm","title":"Document Nix sandbox disabled in container","description":"Finding: lib/sandbox/image.nix:26-30 sets sandbox=false and filter-syscalls=false in nix.conf.\n\nRisk: Nix builds inside container have unrestricted access. Malicious flakes could exfiltrate data.\n\nRemediation:\n1. Add documentation warning users about running untrusted flakes\n2. Consider sandbox=relaxed if some isolation is needed\n3. Document that outer container provides the security boundary\n\nSeverity: Medium","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:43:22Z","created_by":"unknown","updated_at":"2026-01-26T21:16:12Z","closed_at":"2026-01-26T21:16:12Z","labels":["rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-c0h","title":"Build NixOS podman machine image using darwin.linux-builder","description":"## Goal\nCreate a NixOS-based podman machine to replace the default Fedora CoreOS machine for native Nix linux-builder support.\n\n## Background\n- Podman machine on macOS uses Apple Hypervisor (vfkit), not QEMU\n- Default podman machine runs Fedora CoreOS\n- We need a NixOS image compatible with vfkit for native Nix builds\n\n## Prerequisites\n- darwin.linux-builder from nixpkgs (QEMU-based, pre-built from cache)\n- Path: /nix/store/smc5avq1kxn465iz27ihs4g2da7lkbhd-create-builder\n\n## Plan\n\n### Phase 1: Bootstrap with darwin.linux-builder\n1. Start the darwin.linux-builder (QEMU VM on port 31022)\n2. Configure as Nix remote builder in /etc/nix/machines\n3. Verify aarch64-linux builds work\n\n### Phase 2: Build NixOS podman-compatible image\n4. Create NixOS configuration for vfkit/Apple Hypervisor:\n   - Use raw-efi disk format\n   - Uncompressed aarch64 kernel (required for Apple VF)\n   - virtio drivers for block, net, console\n   - virtiofs support for host mounts (/Users, /private, /var/folders)\n   - SSH server for remote access\n   - Nix daemon pre-configured\n\n5. Build the image using darwin.linux-builder:\n   ```bash\n   nix build --system aarch64-linux .#nixos-podman-image\n   ```\n\n### Phase 3: Create podman machine with NixOS\n6. Stop existing podman machine: `podman machine stop`\n7. Remove old machine: `podman machine rm podman-machine-default`\n8. Create new machine with NixOS image:\n   ```bash\n   podman machine init --image-path /path/to/nixos.raw nixos-builder\n   ```\n9. Start and configure: `podman machine start nixos-builder`\n\n### Phase 4: Configure as Nix remote builder\n10. Configure SSH access to podman machine\n11. Add to /etc/nix/machines with appropriate settings\n12. Test linux builds work via podman machine\n\n## NixOS Configuration Template\n\n```nix\n{ config, lib, pkgs, modulesPath, ... }:\n{\n  imports = [ (modulesPath + \"/profiles/qemu-guest.nix\") ];\n\n  # Boot configuration for Apple Hypervisor\n  boot = {\n    loader.grub.efiSupport = true;\n    loader.grub.efiInstallAsRemovable = true;\n    loader.grub.device = \"nodev\";\n    initrd.kernelModules = [ \"virtio_pci\" \"virtio_blk\" ];\n    # Uncompressed kernel for Apple VF\n    kernelParams = [ \"console=ttyAMA0,115200n8\" ];\n  };\n\n  # Filesystem layout\n  fileSystems.\"/\" = { device = \"/dev/vda2\"; fsType = \"ext4\"; };\n  fileSystems.\"/boot\" = { device = \"/dev/vda1\"; fsType = \"vfat\"; };\n\n  # Networking\n  networking.hostName = \"nixos-builder\";\n  networking.useDHCP = true;\n\n  # SSH for remote builder access\n  services.openssh.enable = true;\n  services.openssh.settings.PermitRootLogin = \"yes\";\n\n  # Nix daemon configuration\n  nix.settings.trusted-users = [ \"root\" \"@wheel\" ];\n  nix.settings.experimental-features = [ \"nix-command\" \"flakes\" ];\n\n  # User configuration\n  users.users.root.initialPassword = \"nixos\";\n\n  system.stateVersion = \"24.11\";\n}\n```\n\n## Key Considerations\n- Apple Hypervisor requires uncompressed aarch64 kernel\n- virtiofs mounts may need special configuration\n- podman machine expects specific partition layout\n- SSH key exchange needed for remote builder auth\n\n## References\n- darwin.linux-builder: https://ryantm.github.io/nixpkgs/builders/special/darwin-builder/\n- NixOS disk images: https://jade.fyi/blog/nixos-disk-images-m1/\n- nixos-generators: https://github.com/nix-community/nixos-generators","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T15:29:09Z","created_by":"shaun","updated_at":"2026-01-07T18:41:34Z","closed_at":"2026-01-07T18:41:34Z","work_type":"mutex"}
{"id":"wx-c6z","title":"Add input validation for environment variables in entrypoints","description":"Entrypoint scripts trust environment variables without validation.\n\n**Locations:**\n- lib/sandbox/darwin/entrypoint.sh:19-30 - Uses WRAPIX_DIR_MOUNTS without validation\n- lib/sandbox/darwin/entrypoint.sh:34-45 - Uses WRAPIX_FILE_MOUNTS without validation\n\n**Risk:** Malformed environment variables could cause unexpected behavior.\n\n**Fix:** Add validation to check format before processing mount specifications.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T19:50:44Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-c7f","title":"Fix Darwin VM file mounts - API key not being read","description":"After implementing the file mount workaround for Darwin VMs (parent directory mounting with copy), Claude still shows 'Invalid API key · Please run /login' on startup. The ~/.claude.json file should be copied from the VirtioFS mount to /home/$USER/.claude.json with correct ownership, but something is still not working. Need to debug the entrypoint to verify the copy is happening correctly.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T13:16:01Z","created_by":"shaun","updated_at":"2026-01-08T14:01:36Z","closed_at":"2026-01-08T14:01:36Z","work_type":"mutex"}
{"id":"wx-ca5","title":"macOS kernel build (darwin/kernel.nix)","description":"Create lib/sandbox/darwin/kernel.nix - build Linux kernel with Apple Containerization config for arm64, VIRTIO_FS built-in.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:19:42Z","work_type":"mutex"}
{"id":"wx-cc4","title":"OCI image builder (image.nix)","description":"Create lib/sandbox/image.nix using dockerTools.buildLayeredImage. Include base packages, profile packages, cacert, macOS entrypoint script.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-ccq","title":"Reorganize darwin tests to tests/darwin/","description":"Move darwin test files into tests/darwin/ subdirectory: darwin-network-test.sh → tests/darwin/network-test.sh, darwin-mount-test.sh → tests/darwin/mount-test.sh, darwin-mounts.nix → tests/darwin/mounts.nix, darwin-network.nix → tests/darwin/network.nix, darwin.nix → tests/darwin/default.nix. Update any imports in flake.nix.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:43Z","created_by":"unknown","updated_at":"2026-01-26T14:43:35Z","closed_at":"2026-01-26T14:10:33Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-cds","title":"Integrate Beads Molecules into Ralph Workflow","description":"Integrate bd mol commands into Ralph workflow. Currently Ralph uses labels and individual beads; this epic changes it to use molecules for work tracking. Key changes: ready.sh creates molecules and stores IDs in current.json, status.sh uses bd mol progress/current/stale, step.md uses bd mol bond for discovered work, and tests verify molecule integration.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-26T23:04:48Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:59:04Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-ce6","title":"Task B - Second task","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T15:29:37Z","created_by":"unknown","updated_at":"2026-01-26T16:38:38Z","closed_at":"2026-01-26T16:38:38Z","labels":["rl-test"],"work_type":"mutex"}
{"id":"wx-cga","title":"macOS Swift CLI (darwin/swift/)","description":"Create lib/sandbox/darwin/swift/ with Package.swift and SandboxRunner.swift - VM orchestration using Apple Containerization framework.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:19:42Z","work_type":"mutex"}
{"id":"wx-ck1s","title":"Fix remain-on-exit not applied to new windows","description":"The MCP server sets remain-on-exit with `tmux set-option -t session_name remain-on-exit on` but this doesn't apply to newly created windows. When a pane's process exits, the window is destroyed instead of remaining. Fix by using `set-option -g remain-on-exit on` or setting the option on each window after creation.","status":"closed","priority":2,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-01-30T21:48:50Z","created_by":"unknown","updated_at":"2026-02-01T19:53:25Z","closed_at":"2026-02-01T19:53:23Z","labels":["spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-cpc","title":"System prompt for sandbox (sandbox-prompt.txt)","description":"Create lib/sandbox/sandbox-prompt.txt with sandbox environment description for Claude.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-cqc","title":"Validate threat model against implementation","description":"Validate the threat model in the spec against actual implementation.\n\nRequirements:\n- Verify threat actors and attack surfaces match reality\n- Map attack paths showing how threats could chain together\n- Identify gaps between documented and actual security controls\n- Create threat model diagram if complex paths found\n\nThis task depends on all review tasks being completed.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:37Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:53:33Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-cqu","title":"[Medium] Deploy keys lack passphrase protection","description":"Deploy keys are generated without passphrases (ssh-keygen -N \"\"). While this is intentional for automated use, it means if the ~/.ssh/deploy_keys directory is compromised, the keys are immediately usable.\n\n**File:** scripts/setup-deploy-key:56, lib/builder/hostkey.nix:19,22\n\n**Risk:** If an attacker gains read access to the user's home directory, they can exfiltrate deploy keys and use them immediately without needing to crack a passphrase.\n\n**Remediation options:**\n1. Document the security tradeoff clearly in the README\n2. Consider optional passphrase support with ssh-agent integration\n3. Recommend users set restrictive permissions on ~/.ssh/deploy_keys (currently done: 700 on dir, 600 on keys)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:04Z","created_by":"unknown","updated_at":"2026-01-26T21:01:45Z","closed_at":"2026-01-26T21:01:45Z","labels":["medium","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-cru","title":"Create test harness run-tests.sh","description":"Create tests/ralph/run-tests.sh that: sets up isolated temp directory for each test, configures isolated beads database (BD_DB in temp dir) so test beads don't persist, configures MOCK_SCENARIO and PATH to use mock-claude, runs ralph commands, verifies expected end state (files, beads issues, exit codes), cleans up temp directory after each test, reports pass/fail for each test case.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:46Z","created_by":"unknown","updated_at":"2026-01-30T15:04:49Z","closed_at":"2026-01-30T14:27:39Z","labels":["rl-ralph-tests"],"dependencies":[{"issue_id":"wx-cru","depends_on_id":"wx-t5b","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-d3998d","title":"Model field not persisting on startup from Nix config","description":"Issue: The model field defined in lib/sandbox/default.nix (line 41) is not being applied on container startup. The settings.json file is missing the model field.\n\nRoot Cause: The entrypoint only copies /etc/wrapix/claude-settings.json to ~/.claude/settings.json if the file doesn't exist. When upgrading from an older container image, the existing settings.json is preserved and missing the model field.\n\nImpact: Users need to manually run /model command after each container restart to set their preferred model.\n\nSolutions to consider:\n1. Delete settings.json before container starts (loses user preferences)\n2. Merge/update existing settings with new defaults (complex)\n3. Document the workaround (delete settings.json manually)\n4. Add migration logic to entrypoint for schema updates","status":"closed","priority":1,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-01-22T17:52:22Z","created_by":"unknown","updated_at":"2026-01-22T17:52:49Z","closed_at":"2026-01-22T17:52:49Z","work_type":"mutex"}
{"id":"wx-d8k","title":"Fix Nix store access in Linux sandbox","description":"## Problem\nRunning `nix flake check` in the Linux sandbox fails due to read-only /nix/store.\n\n## Constraints (from ARCHITECTURE.md)\n- No elevated capabilities\n- Must use --userns=keep-id for correct file ownership\n- Container isolation is the security boundary\n\n## What Works\n- Evaluation-only: When /nix/var/nix doesn't exist, Nix falls back to chroot store at ~/.local/share/nix/root (writable under home tmpfs)\n- Shows warning but evaluation succeeds\n- Builds fail because chroot store doesn't have packages from image\n\n## What We Tried\n1. **tmpfs on /nix/var/nix** - Makes Nix try real /nix/store, fails on lock files\n2. **tmpfs on /nix/store/.links** - Doesn't help, lock files are next to store paths\n3. **NIX_STORE_DIR/NIX_STATE_DIR** - Breaks binary cache (paths baked in)\n4. **eval-store config** - Not a valid config option (CLI flag only)\n5. **Kernel overlay mount** - Podman doesn't support type=overlay\n6. **fuse-overlayfs** - fusermount not working in container\n7. **Running as root + setpriv** - UID mapping breaks file access\n\n## Potential Solutions to Investigate\n- https://github.com/chrisguest75/nix-examples - may have container examples\n- nix-user-chroot tool\n- Different podman configuration\n- Nix's read-only=true store option for query-only operations\n- Accept evaluation-only (`nix flake check --no-build`)\n\n## Current State\nSimple setup with:\n- --userns=keep-id\n- --passwd-entry for correct home\n- tmpfs on /home/$USER\n- Chroot store fallback (warning shown, evaluation works)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T14:53:18Z","created_by":"shaun","updated_at":"2026-01-10T15:12:53Z","closed_at":"2026-01-10T15:12:53Z","work_type":"mutex"}
{"id":"wx-dbm6","title":"Add hooks schema to config.nix template","description":"Update lib/ralph/template/config.nix with new hooks structure:\n\n```nix\n{\n  hooks = {\n    pre-loop = \"prek run\";\n    pre-step = \"bd sync\";\n    post-step = \"prek run \u0026\u0026 git add -A \u0026\u0026 bd sync\";\n    post-loop = '''\n      git add -A\n      bd sync\n      git commit -m \"feat({{LABEL}}): implementation complete\"\n      git push\n      git -C .git/beads-worktrees/beads add -A\n      git -C .git/beads-worktrees/beads commit -m \"bd sync\"\n      git push origin beads\n    ''';\n  };\n  hooks-on-failure = \"block\";  # block | warn | skip\n}\n```\n\nAffected file: lib/ralph/template/config.nix","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T18:30:29Z","created_by":"unknown","updated_at":"2026-01-30T19:43:35Z","closed_at":"2026-01-30T19:31:09Z","labels":["spec-pre-commit"],"dependencies":[{"issue_id":"wx-dbm6","depends_on_id":"wx-t6rh","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-dbs","title":"Update service log paths to XDG-compliant locations","description":"Log files in scripts/notify/*.service and scripts/tailscale/ are written to /tmp which could be read by other users on multi-user systems. Update to use XDG-compliant paths like $XDG_STATE_HOME/wrapix/ or ~/.local/state/wrapix/","status":"closed","priority":3,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-12T18:23:40Z","created_by":"unknown","updated_at":"2026-01-12T19:12:54Z","closed_at":"2026-01-12T19:01:03Z","work_type":"mutex"}
{"id":"wx-dc7","title":"Update setup-deploy-key to register signing key with GitHub","description":"Modify scripts/setup-deploy-key to also add the key to the user's GitHub account as a signing key (not just as a repo deploy key).\n\nFor GitHub to show commits as 'Verified', the signing key must be on the user's account.\n\nAdd after the deploy key registration (after line 64):\n```bash\n# Add to user's signing keys for commit verification\nEXISTING_SIGNING_KEY=$(gh ssh-key list --json title,key \\\n    | jq -r \".[] | select(.title == \\\"signing-$KEYNAME\\\") | .key\" 2\u003e/dev/null || true)\n\nif [[ -n \"$EXISTING_SIGNING_KEY\" ]]; then\n    if [[ \"$FORCE\" == true ]]; then\n        KEY_ID=$(gh ssh-key list --json id,title | jq -r \".[] | select(.title == \\\"signing-$KEYNAME\\\") | .id\")\n        gh api -X DELETE \"/user/keys/$KEY_ID\"\n        gh ssh-key add \"$KEY_PATH.pub\" --title \"signing-$KEYNAME\" --type signing\n    fi\nelse\n    gh ssh-key add \"$KEY_PATH.pub\" --title \"signing-$KEYNAME\" --type signing\nfi\n\necho \"Signing key added to your GitHub account\"\n```\n\nFile: scripts/setup-deploy-key","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-18T18:00:09Z","created_by":"unknown","updated_at":"2026-01-18T18:47:26Z","closed_at":"2026-01-18T18:03:45Z","work_type":"mutex"}
{"id":"wx-de3","title":"Implement gvproxy vsock networking in SandboxRunner.swift","description":"Modify SandboxRunner.swift to use gvproxy vsock networking instead of VZNATNetworkDeviceAttachment.\n\n## Changes required:\n1. Add VZVirtioSocketDeviceConfiguration to VM config\n2. Launch gvproxy daemon as subprocess before VM start\n3. Connect vsock to gvproxy Unix socket\n4. Remove VZNATNetworkDeviceAttachment (ICMP-only, broken for TCP/UDP)\n\n## Files:\n- lib/sandbox/darwin/swift/Sources/wrapix-runner/SandboxRunner.swift\n- lib/sandbox/darwin/default.nix (add gvproxy dependency)\n\n## Reference:\n- gvproxy package: lib/sandbox/darwin/gvproxy.nix (already built)\n- Lima VM implementation for vsock networking pattern\n- vfkit: https://github.com/crc-org/vfkit","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T23:02:23Z","updated_at":"2026-01-08T23:16:16Z","closed_at":"2026-01-08T23:16:16Z","work_type":"mutex"}
{"id":"wx-ded","title":"Simplify image build","description":"Remove squid, iptables, proxy env vars from image.nix","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T20:29:03Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:30:48Z","work_type":"mutex"}
{"id":"wx-dsf","title":"Review notifications for information leakage","description":"Review lib/notify/ for information leakage via desktop notifications.\n\nFocus areas:\n- Sensitive data in notification content\n- Notification visibility controls\n- Focus-aware suppression effectiveness\n\nDocument findings with severity ratings.","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:23Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:53:32Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-dtry","title":"Ralph Test Suite Overhaul","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-30T02:37:44Z","created_by":"unknown","updated_at":"2026-01-30T14:24:20Z","closed_at":"2026-01-30T04:05:18Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-dv5","title":"Platform dispatcher (sandbox/default.nix)","description":"Create lib/sandbox/default.nix - dispatch to linux/ or darwin/ based on system platform.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:36Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-e4r","title":"Add checks output to flake.nix","description":"Update flake.nix to export checks attribute from lib/tests. Enables nix flake check to run all tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T19:43:18Z","created_by":"shaun","updated_at":"2026-01-06T19:46:14Z","closed_at":"2026-01-06T19:46:14Z","work_type":"mutex"}
{"id":"wx-e8h","title":"Remove hardcoded git author from image.nix","description":"Remove the hardcoded GIT_AUTHOR_* and GIT_COMMITTER_* environment variables from lib/sandbox/image.nix (lines 107-110).\n\nThese are currently set to:\n- GIT_AUTHOR_NAME=Wrapix Sandbox\n- GIT_AUTHOR_EMAIL=sandbox@wrapix.dev\n- GIT_COMMITTER_NAME=Wrapix Sandbox\n- GIT_COMMITTER_EMAIL=sandbox@wrapix.dev\n\nThese will now be set at runtime by the launcher scripts instead.\n\nFile: lib/sandbox/image.nix\nLines: 107-110 (remove these 4 lines from the environment block)","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-18T18:00:02Z","created_by":"unknown","updated_at":"2026-01-18T18:47:26Z","closed_at":"2026-01-18T18:03:45Z","work_type":"mutex"}
{"id":"wx-ec3788","title":"Focus-aware notifications: suppress when terminal is focused","description":"## Summary\n\nOnly trigger desktop notifications when the terminal window running the container is unfocused. Currently notifications fire regardless of focus state, which is distracting when actively working in the terminal.\n\n## Design\n\nFocus detection happens on the **host daemon**, not in the container (container has no window manager access).\n\n### Architecture\n\n```\nContainer                              Host\n┌─────────────────┐                   ┌─────────────────────────────┐\n│ wrapix-notify   │──payload──────────│ wrapix-notifyd              │\n│ +session_id     │                   │   ├─ lookup session file    │\n└─────────────────┘                   │   ├─ check if terminal      │\n                                      │   │   is focused (niri)     │\n                                      │   └─ show if unfocused      │\n                                      └─────────────────────────────┘\n                                               │\n                                               ▼\n                                      ~/.local/share/wrapix/sessions/\n                                      └── 0-1-0.json (tmux 0:1.0)\n```\n\n### Session ID Strategy\n\nUse tmux pane identifiers: `{session}:{window}.{pane}` (e.g., `0:1.0`)\n- Query via: `tmux display-message -p '#S:#I.#P'`\n- If not in tmux: no session_id sent, focus check disabled (graceful degradation)\n- Multiple panes work correctly (each pane has unique ID)\n\n### Implementation\n\n1. **Launcher** (`lib/sandbox/linux/default.nix`, `lib/sandbox/darwin/default.nix`):\n   - If in tmux, generate session ID and capture window info\n   - Linux: Store niri window ID from `niri msg -j focused-window | jq -r '.id'`\n   - Darwin: Store terminal app name from osascript\n   - Pass `WRAPIX_SESSION_ID` env var to container\n   - Clean up session file on exit (trap)\n\n2. **Client** (`lib/notify/client.nix`):\n   - Add `session_id` field to JSON payload\n\n3. **Daemon** (`lib/notify/daemon.nix`):\n   - Add `check_terminal_focused()` function\n   - Linux: Compare stored window ID with current focused window ID\n   - Darwin: Compare stored app name with current frontmost app\n   - Skip notification if terminal is focused\n\n### Configuration\n\n- `WRAPIX_NOTIFY_ALWAYS=1` - Disable focus checking (always show notifications)\n- `WRAPIX_NOTIFY_VERBOSE=1` - Enable debug logging for troubleshooting\n\n### Platform Notes\n\n- Linux/niri: Uses exact window ID matching (multiple terminal windows tracked independently)\n- macOS: Uses app-level matching (any iTerm/Terminal window counts as focused)\n- osascript does not require sudo, may need Accessibility permission on first use\n\n### Error Handling\n\nIf any step fails (no session file, window manager query fails, etc.), show notification anyway.\nMissing notifications are worse than spurious ones.\n\n## Files to Modify\n\n- `lib/sandbox/linux/default.nix`\n- `lib/sandbox/darwin/default.nix`\n- `lib/notify/client.nix`\n- `lib/notify/daemon.nix`\n\n## Testing\n\n1. Build: `nix build .#wrapix-rust`\n2. Start daemon: `WRAPIX_NOTIFY_VERBOSE=1 nix run .#wrapix-notifyd`\n3. Focused test: Keep terminal focused, trigger notification → should NOT appear\n4. Unfocused test: Focus another window, trigger notification → should appear\n5. Opt-out test: `WRAPIX_NOTIFY_ALWAYS=1` → notifications always appear","status":"closed","priority":2,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-01-23T00:20:38Z","created_by":"unknown","updated_at":"2026-01-25T15:50:58Z","closed_at":"2026-01-25T15:50:58Z","work_type":"mutex"}
{"id":"wx-ej6","title":"Create parallel simulation test","description":"Create test that verifies coordination: step marks issue in_progress before work, subsequent step skips in_progress items, subsequent step skips items blocked by in_progress dependencies. Verify task selection logic correctly handles concurrent agent simulation.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:48Z","created_by":"unknown","updated_at":"2026-01-26T14:59:13Z","closed_at":"2026-01-26T14:44:52Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-emka","title":"Remove debug profiles from lib/sandbox/profiles.nix","description":"Remove the debug and rust-debug profile definitions from lib/sandbox/profiles.nix.\n\nDelete:\n1. The `debug` profile (lines 141-157)\n2. The `rust-debug` profile (lines 159-210)\n3. The `mkAuditedDebug` export (line 213)\n4. The `tmuxMcp` import at top (line 5)\n\nKeep: base, rust, python profiles and the mkProfile helper.\n\nThis eliminates profile proliferation - users will now enable MCP servers via the new mkSandbox mcp parameter instead of using dedicated profiles.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:30Z","created_by":"unknown","updated_at":"2026-02-01T20:42:10Z","closed_at":"2026-02-01T20:42:10Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-eok","title":"Security Review Specification","description":"Comprehensive security audit of wrapix sandbox isolation, secrets management, and permission controls. Produces documented findings with severity ratings and actionable remediation beads.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-26T20:32:58Z","created_by":"unknown","updated_at":"2026-01-26T21:45:58Z","closed_at":"2026-01-26T21:45:14Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-et2v","title":"Update check-status.sh test for bd mol current","description":"Update tests/ralph/scenarios/check-status.sh to:\n1. Test ralph status uses bd mol current to show position\n2. Verify correct position marker ([current], [done], [blocked])\n3. Test that completed tasks show as [done]\n4. Test that blocked tasks show reason","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:36Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:36:40Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-f7c3fb","title":"Implement Ralph Wiggum Loop System","description":"# Plan: Ergonomic Prompt Updating for Ralph Wiggum Loops\n\n## Summary\n\nAdd a full-featured `ralph-loop` system to Wrapix with **Nix config**, prompt versioning, failure detection, and **beads integration** for issue tracking.\n\n## Background\n\n**Ralph Wiggum Loop**: An iterative AI pattern using `while :; do cat PROMPT.md | claude; done`. Each iteration starts fresh (no conversation history), reading prompts and state from disk. Prompts are tuned reactively based on observed failures.\n\n**Beads integration**: Projects use `bd` (beads) for issue tracking. The workflow is:\n1. **Plan phase**: Iterate on plan in markdown (no beads yet - still iterating)\n2. **Finalize**: Convert finalized plan to beads issues\n3. **Build phase**: Work on and close those specific beads\n\n## Architecture\n\n```\n.claude/ralph/\n├── config.nix            # Loop configuration (Nix - native to project)\n├── prompts/\n│   ├── plan.md           # Planning phase prompt\n│   ├── build.md          # Build/implement phase prompt\n│   └── review.md         # Review phase prompt\n├── history/              # Auto-snapshot of prompts per iteration\n│   ├── 001-build.md\n│   └── 002-build.md\n├── state/\n│   └── plan.md           # Draft plan (before finalization to beads)\n└── logs/\n    └── iteration-001.log # Output capture for failure analysis\n```\n\n## Workflow\n\n```\n[Plan Mode] → iterate until satisfied → [ralph-finalize] → creates beads\n     ↓                                                           ↓\nstate/plan.md (markdown)                            bd issues (beads-xxx)\n                                                              ↓\n                                               [Build Mode] → closes beads\n```\n\n## Implementation Steps\n\n### Step 1: Create config schema\n\n**File**: `lib/ralph/init-template/config.nix`\n\n```nix\n{\n  # Active prompt mode: \"plan\" | \"build\" | \"review\"\n  mode = \"plan\";\n\n  # Beads integration\n  beads = {\n    # Label for issues - leave null to auto-generate random 6-char ID\n    # Final label will be prefixed: rl-{label}\n    label = null;\n    priority = 2;       # Default priority (0=critical, 2=medium, 4=backlog)\n  };\n\n  prompts = {\n    plan = \"prompts/plan.md\";\n    build = \"prompts/build.md\";\n    review = \"prompts/review.md\";\n  };\n\n  loop = {\n    max-iterations = 0;       # 0 = infinite\n    pause-on-failure = true;\n    pre-hook = \"\";            # Command to run before each iteration\n    post-hook = \"\";           # Command to run after each iteration\n  };\n\n  history = {\n    enabled = true;\n    max-snapshots = 50;\n  };\n\n  failure-patterns = [\n    { pattern = \"error:\"; action = \"log\"; }      # log | pause | notify\n    { pattern = \"FAILED\"; action = \"pause\"; }\n    { pattern = \"Exception\"; action = \"pause\"; }\n    { pattern = \"BLOCKED:\"; action = \"pause\"; }\n  ];\n\n  exit-signals = {\n    complete = \"PLAN_COMPLETE\";\n    blocked = \"BLOCKED:\";\n    clarify = \"CLARIFY:\";\n  };\n}\n```\n\n### Step 2: Create ralph-loop script\n\n**File**: `lib/ralph/loop.sh`\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nRALPH_DIR=\"${RALPH_DIR:-.claude/ralph}\"\nCONFIG_FILE=\"$RALPH_DIR/config.nix\"\n\n# Load entire config as JSON once at startup\nCONFIG=$(nix eval --json --file \"$CONFIG_FILE\")\n\n# Extract values from cached JSON (no repeated nix eval calls)\nMODE=$(echo \"$CONFIG\" | jq -r '.mode // \"plan\"')\nMAX=$(echo \"$CONFIG\" | jq -r '.loop.\"max-iterations\" // 0')\nPAUSE_ON_FAIL=$(echo \"$CONFIG\" | jq -r '.loop.\"pause-on-failure\" // true')\nHISTORY_ENABLED=$(echo \"$CONFIG\" | jq -r '.history.enabled // true')\nPRE_HOOK=$(echo \"$CONFIG\" | jq -r '.loop.\"pre-hook\" // empty')\nPOST_HOOK=$(echo \"$CONFIG\" | jq -r '.loop.\"post-hook\" // empty')\nCOMPLETE_SIGNAL=$(echo \"$CONFIG\" | jq -r '.\"exit-signals\".complete // \"PLAN_COMPLETE\"')\nPROMPT_PATH=\"$RALPH_DIR/$(echo \"$CONFIG\" | jq -r \".prompts.$MODE // \\\"prompts/plan.md\\\"\")\"\n\nmkdir -p \"$RALPH_DIR/history\" \"$RALPH_DIR/logs\"\n\niteration=0\nwhile :; do\n  ((iteration++))\n  [ \"$MAX\" -gt 0 ] \u0026\u0026 [ \"$iteration\" -gt \"$MAX\" ] \u0026\u0026 { echo \"Max iterations reached\"; break; }\n\n  LOG=\"$RALPH_DIR/logs/iteration-$(printf '%03d' $iteration).log\"\n\n  # Snapshot prompt if history enabled\n  if [ \"$HISTORY_ENABLED\" = \"true\" ]; then\n    cp \"$PROMPT_PATH\" \"$RALPH_DIR/history/$(printf '%03d' $iteration)-$(basename \"$PROMPT_PATH\")\"\n  fi\n\n  # Run pre-hook\n  [ -n \"$PRE_HOOK\" ] \u0026\u0026 eval \"$PRE_HOOK\"\n\n  # Inject iteration and run, capturing output\n  sed \"s/{{ITERATION}}/$iteration/g; s/{{MODE}}/$MODE/g\" \"$PROMPT_PATH\" | \\\n    claude --dangerously-skip-permissions 2\u003e\u00261 | tee \"$LOG\"\n\n  # Check exit signals\n  if grep -q \"$COMPLETE_SIGNAL\" \"$LOG\" 2\u003e/dev/null; then\n    echo \"Loop complete signal received\"\n    break\n  fi\n\n  # Check failure patterns\n  echo \"$CONFIG\" | jq -c '.\"failure-patterns\"[]' | while read -r fp; do\n    pattern=$(echo \"$fp\" | jq -r '.pattern')\n    action=$(echo \"$fp\" | jq -r '.action')\n    if grep -q \"$pattern\" \"$LOG\"; then\n      echo \"Failure detected: $pattern (action: $action)\"\n      if [ \"$action\" = \"pause\" ] \u0026\u0026 [ \"$PAUSE_ON_FAIL\" = \"true\" ]; then\n        echo \"Pausing for prompt tuning. Edit $PROMPT_PATH and run ralph-loop again.\"\n        exit 1\n      fi\n    fi\n  done\n\n  # Run post-hook\n  [ -n \"$POST_HOOK\" ] \u0026\u0026 eval \"$POST_HOOK\"\ndone\n```\n\n### Step 3: Create ralph-finalize script\n\n**File**: `lib/ralph/finalize.sh`\n\nConverts finalized plan from `state/plan.md` to beads issues using YAML frontmatter documents:\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nRALPH_DIR=\"${RALPH_DIR:-.claude/ralph}\"\nCONFIG_FILE=\"$RALPH_DIR/config.nix\"\nPLAN=\"$RALPH_DIR/state/plan.md\"\n\n# Load config as JSON once\nCONFIG=$(nix eval --json --file \"$CONFIG_FILE\")\nLABEL_SUFFIX=$(echo \"$CONFIG\" | jq -r '.beads.label // empty')\nDEFAULT_PRIORITY=$(echo \"$CONFIG\" | jq -r '.beads.priority // 2')\n\n# Generate random 6-char suffix if not set in config\nif [ -z \"$LABEL_SUFFIX\" ]; then\n  LABEL_SUFFIX=$(head -c 6 /dev/urandom | base64 | tr -dc 'a-z0-9' | head -c 6)\nfi\nLABEL=\"rl-$LABEL_SUFFIX\"\n\n[ ! -f \"$PLAN\" ] \u0026\u0026 { echo \"No plan found at $PLAN\"; exit 1; }\n\necho \"Converting plan to beads issues...\"\necho \"Label: $LABEL, Default priority: $DEFAULT_PRIORITY\"\n\n# Save label to state file for build phase to use\necho \"$LABEL\" \u003e \"$RALPH_DIR/state/label\"\n\n# Parse YAML frontmatter documents (separated by ---)\n# Uses awk to split into documents, then parse each\nawk 'BEGIN { RS=\"---\\n\"; FS=\"\\n\" }\nNR \u003e 1 {\n  # First record after --- is frontmatter, rest is body\n  type=\"\"; title=\"\"; priority=\"\"; body=\"\"\n  in_frontmatter=1\n  for (i=1; i\u003c=NF; i++) {\n    line = $i\n    if (in_frontmatter) {\n      if (match(line, /^type:[[:space:]]*(.*)/, m)) type=m[1]\n      else if (match(line, /^title:[[:space:]]*(.*)/, m)) title=m[1]\n      else if (match(line, /^priority:[[:space:]]*(.*)/, m)) priority=m[1]\n      else if (line == \"\" || substr(line,1,1) != \" \") in_frontmatter=0\n    }\n    if (!in_frontmatter \u0026\u0026 line != \"\") {\n      if (body != \"\") body = body \"\\n\" line\n      else body = line\n    }\n  }\n  if (title != \"\") {\n    # Output as JSON for shell to process\n    gsub(/\"/, \"\\\\\\\"\", title)\n    gsub(/\"/, \"\\\\\\\"\", body)\n    gsub(/\\n/, \"\\\\n\", body)\n    print \"{\\\"type\\\":\\\"\" type \"\\\",\\\"title\\\":\\\"\" title \"\\\",\\\"priority\\\":\\\"\" priority \"\\\",\\\"body\\\":\\\"\" body \"\\\"}\"\n  }\n}' \"$PLAN\" | while IFS= read -r json; do\n  type=$(echo \"$json\" | jq -r '.type')\n  title=$(echo \"$json\" | jq -r '.title')\n  priority=$(echo \"$json\" | jq -r \".priority | if . == \\\"\\\" then \\\"$DEFAULT_PRIORITY\\\" else . end\")\n  body=$(echo \"$json\" | jq -r '.body')\n\n  [ -z \"$title\" ] \u0026\u0026 continue\n\n  echo \"Creating $type: $title\"\n  bd create --title=\"$title\" --description=\"$body\" \\\n    --type=\"$type\" --priority=\"$priority\" --labels=\"$LABEL\"\ndone\n\necho \"\"\necho \"Beads created. Switch to build mode by editing $CONFIG_FILE:\"\necho \"  mode = \\\"build\\\";\"\necho \"Then run: ralph-loop\"\n```\n\n### Step 4: Create ralph-tune script\n\n**File**: `lib/ralph/tune.sh`\n\nAnalyzes recent failure logs and suggests prompt improvements:\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nRALPH_DIR=\"${RALPH_DIR:-.claude/ralph}\"\nLOGS=\"$RALPH_DIR/logs\"\n\n# Find recent failures\nRECENT=$(ls -t \"$LOGS\"/*.log 2\u003e/dev/null | head -3)\n[ -z \"$RECENT\" ] \u0026\u0026 { echo \"No logs found\"; exit 0; }\n\n# Extract failure context\necho \"Recent failure patterns:\"\nfor log in $RECENT; do\n  echo \"--- $(basename \"$log\") ---\"\n  grep -E \"(error:|FAILED|Exception|BLOCKED:)\" \"$log\" | head -5\ndone\n\necho \"\"\necho \"Suggestion: Review the above patterns and update your prompts in $RALPH_DIR/prompts/\"\necho \"Common fixes:\"\necho \"  - Add explicit constraints for the failing case\"\necho \"  - Clarify exit conditions\"\necho \"  - Add 'Do not...' guardrails\"\n```\n\n### Step 5: Create prompt templates\n\n**File**: `lib/ralph/init-template/prompts/plan.md`\n\n```markdown\n# Planning Phase (iteration {{ITERATION}})\n\n1. Read specs/ or requirements docs\n2. Analyze current codebase structure\n3. Update `.claude/ralph/state/plan.md` with structured tasks\n\n## Output Format\nEach item in plan.md: `---`, metadata (type/title/priority), blank line, description body.\n\n---\ntype: task\ntitle: Implement feature X\npriority: 2\n\nFull description for fresh agent context.\nFiles, APIs, constraints go here.\n---\n\nTypes: epic, feature, task, chore\n\nExit: \"PLAN_COMPLETE\" when done, \"BLOCKED: reason\" if stuck, \"CLARIFY: question\" if need input.\n```\n\n**File**: `lib/ralph/init-template/prompts/build.md`\n\n```markdown\n# Build Phase (iteration {{ITERATION}})\n\nLABEL=$(cat .claude/ralph/state/label)\n\n1. `bd list --labels=$LABEL --status=open` - find next task\n2. `bd update \u003cid\u003e --status=in_progress` - claim it\n3. `bd show \u003cid\u003e` - read full context\n4. Implement and test\n5. `bd close \u003cid\u003e` - mark done\n\nExit: \"PLAN_COMPLETE\" when all tasks closed, \"BLOCKED: reason\" if stuck, \"CLARIFY: question\" if need input.\n```\n\n### Step 6: Create ralph-init script\n\n**File**: `lib/ralph/init.sh`\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nDEST=\"${1:-.claude/ralph}\"\nTEMPLATE=\"/etc/wrapix/ralph-template\"\n\n[ -d \"$DEST\" ] \u0026\u0026 { echo \"Ralph already initialized at $DEST\"; exit 1; }\n\nmkdir -p \"$(dirname \"$DEST\")\"\ncp -r \"$TEMPLATE\" \"$DEST\"\nmkdir -p \"$DEST/history\" \"$DEST/logs\" \"$DEST/state\"\ntouch \"$DEST/state/plan.md\"\n\necho \"Initialized ralph at $DEST\"\necho \"Edit prompts in $DEST/prompts/\"\necho \"Run 'ralph-loop' to start (mode=plan by default)\"\n```\n\n### Step 7: Add scripts to base profile\n\n**File**: `lib/sandbox/profiles.nix`\n\nAdd `ralph-loop`, `ralph-init`, `ralph-finalize`, and `ralph-tune` to basePackages.\n\n### Step 8: Bundle templates in image\n\n**File**: `lib/sandbox/image.nix`\n\nCopy ralph template directory to `/etc/wrapix/ralph-template/`.\n\n## Files to Modify\n\n| File | Change |\n|------|--------|\n| `lib/sandbox/profiles.nix` | Add ralph scripts to base packages |\n| `lib/sandbox/image.nix` | Bundle ralph template directory |\n\n## Files to Create\n\n| File | Purpose |\n|------|---------|\n| `lib/ralph/loop.sh` | Main loop orchestrator with failure detection |\n| `lib/ralph/init.sh` | Project initialization script |\n| `lib/ralph/finalize.sh` | Convert plan.md to beads issues |\n| `lib/ralph/tune.sh` | Failure analysis and tuning suggestions |\n| `lib/ralph/init-template/config.nix` | Default Nix config |\n| `lib/ralph/init-template/prompts/plan.md` | Planning prompt |\n| `lib/ralph/init-template/prompts/build.md` | Build prompt (uses beads) |\n| `lib/ralph/init-template/prompts/review.md` | Review prompt |\n\n## Usage\n\n```bash\n# Initialize ralph in a project\nralph-init\n\n# Edit config and prompts\n$EDITOR .claude/ralph/config.nix\n$EDITOR .claude/ralph/prompts/plan.md\n\n# Run planning loop (default mode)\nralph-loop\n# Iterate until satisfied with plan in state/plan.md\n\n# Finalize: convert plan to beads issues\nralph-finalize\n\n# Switch to build mode (edit config.nix)\n# Change: mode = \"plan\"; → mode = \"build\";\n\n# Run build loop (works on beads)\nralph-loop\n# Each iteration closes one bead\n\n# After failure, analyze logs\nralph-tune\n```\n\n## Workflow Summary\n\n```\n1. ralph-init              → Creates .claude/ralph/ structure\n2. ralph-loop (plan mode)  → Iterates, outputs state/plan.md\n3. ralph-finalize          → Creates beads with unique rl-{random} label\n4. ralph-loop (build mode) → Closes beads one by one\n```\n\n## Multiple Loops\n\nFor multiple concurrent loops in the same repo, use separate directories:\n\n```bash\nralph-init .claude/ralph-feature-a\nRALPH_DIR=.claude/ralph-feature-a ralph-loop\n\nralph-init .claude/ralph-feature-b\nRALPH_DIR=.claude/ralph-feature-b ralph-loop\n```\n\nEach `ralph-finalize` generates a unique label (`rl-{random}`), so beads won't conflict even if loops share a directory. But state files (plan.md, logs/) would be overwritten.\n\n## Verification\n\n1. Build sandbox: `nix build .#sandbox-linux` (or darwin)\n2. Enter sandbox, verify all ralph-* commands in PATH\n3. Run `ralph-init` - confirm `.claude/ralph/` structure created with config.nix\n4. Run `ralph-loop` with `max-iterations = 1;` in plan mode - verify iteration runs\n5. Create test plan in `state/plan.md` with YAML frontmatter format:\n   ```\n   ---\n   type: task\n   title: Test task\n   priority: 2\n   ---\n   Test description with **markdown**.\n   ```\n6. Run `ralph-finalize`:\n   - Verify `state/label` file created with `rl-{random}` format\n   - Verify beads created with `bd list --labels=$(cat state/label)`\n7. Edit config.nix to set `mode = \"build\";` and run `ralph-loop` - verify it reads beads\n8. Run `ralph-tune` and verify it shows failure context from logs\n","status":"closed","priority":2,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-01-25T15:47:24Z","created_by":"unknown","updated_at":"2026-01-25T16:02:12Z","closed_at":"2026-01-25T16:02:12Z","work_type":"mutex"}
{"id":"wx-faon","title":"Create status-wrapper.sh test scenario","description":"Create new test scenario tests/ralph/scenarios/status-wrapper.sh to verify:\n1. ralph status calls bd mol progress with correct molecule\n2. ralph status calls bd mol current with correct molecule\n3. ralph status calls bd mol stale for hygiene warnings\n4. Output format matches spec (progress bar, ETA, position)\n\nTest should mock bd mol commands and verify:\n- Correct molecule ID passed\n- Output formatted as specified in spec\n- Graceful fallback if molecule not set","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:39Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:42:35Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-fh6","title":"Harmonize system prompt paths between Linux and Darwin","description":"System prompt path differs between Linux and Darwin without clear reason.\n\n**Locations:**\n- lib/sandbox/linux/entrypoint.sh:30 - Uses /etc/wrapix-prompt\n- lib/sandbox/darwin/entrypoint.sh:84 - Uses /etc/wrapix/wrapix-prompt\n\n**Impact:** Confusing inconsistency between platforms.\n\n**Fix:** Use consistent path on both platforms (e.g., /etc/wrapix/prompt or /etc/wrapix-prompt).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T19:51:18Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-fhmy","title":"Add ralph sync integration tests","description":"Create tests/ralph/scenarios/sync-*.sh test scenarios:\n- sync-fresh.sh: Fresh project with no existing templates\n- sync-backup.sh: Existing project with customizations (backup created)\n- sync-dry-run.sh: Dry-run mode shows but doesn't execute\n- sync-partials.sh: Partial directory handling\n\nEach test should verify exit codes and expected file state.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:08Z","created_by":"unknown","updated_at":"2026-01-30T03:32:36Z","closed_at":"2026-01-30T03:30:06Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-fhsj","title":"Ralph update mode: separate state file for new requirements","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-01T17:44:11Z","created_by":"unknown","updated_at":"2026-02-01T18:27:04Z","closed_at":"2026-02-01T17:48:50Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-fhsj.1","title":"Update plan-update.md: write new requirements to state/\u003clabel\u003e.md","description":"The plan-update template should instruct Claude to write NEW requirements to state/\u003clabel\u003e.md instead of just summarizing them. This file is then consumed by ralph ready.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T17:44:26Z","created_by":"unknown","updated_at":"2026-02-01T18:27:04Z","closed_at":"2026-02-01T17:46:15Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-fhsj.1","depends_on_id":"wx-fhsj","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-fhsj.2","title":"Update ready.sh: detect and process state/\u003clabel\u003e.md in update mode","description":"In update mode, ready.sh should: 1) Check if state/\u003clabel\u003e.md exists (if not, no new work to do), 2) Read NEW_REQUIREMENTS from it, 3) Pass to template, 4) After success, merge into specs/\u003clabel\u003e.md and delete state file.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T17:44:26Z","created_by":"unknown","updated_at":"2026-02-01T18:27:04Z","closed_at":"2026-02-01T17:47:46Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-fhsj.2","depends_on_id":"wx-fhsj","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-fhsj.3","title":"Update ready-update.md: use NEW_REQUIREMENTS and add merge/cleanup logic","description":"The ready-update template should: 1) Show EXISTING_SPEC from specs/\u003clabel\u003e.md for context, 2) Show NEW_REQUIREMENTS from state/\u003clabel\u003e.md, 3) Create tasks ONLY for new requirements, 4) Include merge/cleanup instructions.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T17:44:26Z","created_by":"unknown","updated_at":"2026-02-01T18:27:04Z","closed_at":"2026-02-01T17:48:18Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-fhsj.3","depends_on_id":"wx-fhsj","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"},{"issue_id":"wx-fhsj.3","depends_on_id":"wx-fhsj.2","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-fhsj.4","title":"Update ready-new.md: add per-task profile assignment guidance","description":"Add profile assignment guidance to the template so the LLM assigns profile:X labels per-task based on implementation needs (e.g., tasks touching .rs files get profile:rust).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T17:44:26Z","created_by":"unknown","updated_at":"2026-02-01T18:27:04Z","closed_at":"2026-02-01T17:48:49Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-fhsj.4","depends_on_id":"wx-fhsj","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-fxl","title":"Update documentation","description":"Update CLAUDE.md and README.md with usage instructions, requirements, and examples.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:59Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:19:47Z","work_type":"mutex"}
{"id":"wx-g57","title":"Investigate Nix store solutions for container builds","description":"## Problem\n`nix flake check` can evaluate but not build inside the container because:\n1. Container's /nix/store is incomplete (runtime packages only, no build deps like stdenv)\n2. Derivations are evaluated with /nix/store paths that don't exist\n3. --store and NIX_STORE_DIR options don't change paths inside derivations\n\n## Current workaround\n- `nix flake check --no-build --impure` works for evaluation verification\n- Full builds must run outside the container\n\n## Potential solutions to investigate\n1. Nix experimental local-overlay-store feature\n2. Mounting host /nix/var/nix with proper isolation (not full /nix)\n3. Pre-populating container with build dependencies\n4. Using a remote Nix daemon/store\n5. Exploring NIX_REMOTE or other env vars for store redirection\n\n## References\n- https://nix.dev/manual/nix/2.30/store/types/experimental-local-overlay-store\n- The chroot store at ~/.local/share/nix/root works for fetching but not for builds","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T22:56:29Z","created_by":"unknown","updated_at":"2026-01-12T17:55:48Z","closed_at":"2026-01-11T18:04:58Z","work_type":"mutex"}
{"id":"wx-gh2","title":"Blocklist (blocklist.nix)","description":"Create lib/sandbox/blocklist.nix with blocked domains: pastebin sites, file sharing, URL shorteners, webhook sites, code execution platforms, risky TLDs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-gu9","title":"[MEDIUM] Linux builder exposes SSH port 2222 with port forwarding","description":"**Finding**: wrapix-builder forwards SSH on port 2222 (container port 22 -\u003e host port 2222).\n\n**Impact**: SSH service accessible from localhost on the host machine. Could be exposed to network if host firewall allows.\n\n**Analysis**:\n- Port forwarding: \"-p $SSH_PORT:22\" (lib/builder/default.nix:190)\n- SSH key authentication only (no password)\n- Keys stored in nix store with controlled paths\n- Only `builder` user has SSH access\n\n**Current mitigations**:\n- Key-based auth only\n- Port bound to localhost by default (Darwin container behavior)\n- Requires manual setup (`wrapix-builder setup`)\n\n**Recommendation**: \n1. Verify port is bound only to localhost (127.0.0.1), not all interfaces\n2. Document that SSH port is exposed when builder is running\n3. Consider documenting host firewall configuration\n\n**Severity**: Medium (sensitive service exposed, but requires auth)\n**File**: lib/builder/default.nix:37,190","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:38:32Z","created_by":"unknown","updated_at":"2026-01-26T20:41:58Z","closed_at":"2026-01-26T20:41:58Z","labels":["network","rl-security-review"],"work_type":"mutex"}
{"id":"wx-gxf","title":"Fix unquoted ls output parsing in Darwin entrypoint","description":"In the Darwin entrypoint, ls output is parsed without proper quoting, which could cause issues with special characters.\n\n**Location:** lib/sandbox/darwin/entrypoint.sh:55-56\n\n**Current code:**\n```bash\nif [ -d \"$HOME/.ssh/deploy_keys\" ] \u0026\u0026 [ -n \"$(ls -A $HOME/.ssh/deploy_keys 2\u003e/dev/null)\" ]; then\n  DEPLOY_KEY=$(ls $HOME/.ssh/deploy_keys/* | head -1)\n```\n\n**Issues:**\n- $HOME not quoted inside ls command\n- ls output isn't quoted and could cause issues with spaces in filenames\n- Parsing ls output is generally discouraged\n\n**Fix:** Use find or glob patterns instead of parsing ls output.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T19:51:37Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-hfp","title":"Ralph Integration Tests","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:11Z","created_by":"unknown","updated_at":"2026-01-26T16:09:20Z","closed_at":"2026-01-26T16:07:48Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-hm89","title":"Remove wrapix-debug and wrapix-rust-debug from flake.nix","description":"Remove the debug-related package exports from flake.nix.\n\nDelete these lines from packages section:\n- wrapix-debug = (wrapix.mkSandbox { profile = wrapix.profiles.debug; }).package;\n- wrapix-rust-debug = (wrapix.mkSandbox { profile = wrapix.profiles.rust-debug; }).package;\n\nThese packages are no longer needed since:\n1. The debug/rust-debug profiles no longer exist\n2. Users enable MCP servers via the mcp parameter to mkSandbox\n\nKeep: wrapix, wrapix-rust, wrapix-python, wrapix-builder, wrapix-notifyd, tmux-debug-mcp","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:31Z","created_by":"unknown","updated_at":"2026-02-01T20:42:10Z","closed_at":"2026-02-01T20:42:10Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-i6m","title":"[LOW] Notification daemon TCP port bound to vmnet interface","description":"**Finding**: On macOS, wrapix-notifyd listens on TCP port 5959, bound to 192.168.64.1 (vmnet gateway).\n\n**Impact**: Limited exposure - only containers on the vmnet bridge can connect. However, any container can trigger desktop notifications on the host.\n\n**Analysis**: \n- Binding to 192.168.64.1 (not 0.0.0.0) limits exposure to vmnet network only\n- No authentication on the notification protocol\n- Impact is low (can only trigger benign desktop notifications)\n- This is necessary because VirtioFS cannot pass Unix sockets\n\n**Current mitigations**:\n- Port bound to vmnet interface only\n- Notifications are cosmetic (no code execution)\n- Focus-aware suppression limits spam potential\n\n**Recommendation**: Document this behavior. Consider if rate limiting would be useful.\n\n**Severity**: Low\n**File**: lib/notify/daemon.nix:176","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:38:13Z","created_by":"unknown","updated_at":"2026-01-26T21:07:08Z","closed_at":"2026-01-26T21:07:08Z","labels":["network","rl-security-review"],"work_type":"mutex"}
{"id":"wx-idm","title":"Test Linux profiles","description":"Test all profiles work on Linux: pod starts \u003c2s, init sets iptables and exits, Claude container has no caps, UID mapping works.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:36Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:24:22Z","work_type":"mutex"}
{"id":"wx-irg","title":"Fix beads sync in containers - staging mount breaks git visibility","description":"## Problem\n\nContainer staging mount for .beads isolates the JSONL from git, causing sync issues:\n- Container writes to /workspace/.beads/issues.jsonl (staged copy)\n- Git sees underlying host file (unchanged)\n- bd sync exports correctly but git add picks up stale host file\n\n## Root Cause\n\nLinux/Darwin default.nix mounts entire .beads directory to staging:\n```bash\nBEADS_ARGS=\"-v $BEADS_STAGING:/workspace/.beads\"\n```\n\nThis isolates both beads.db (needed) AND issues.jsonl (breaks sync).\n\n## Proposed Fix\n\nOnly stage the database, mount JSONL directly:\n```bash\nBEADS_ARGS=\"-v $BEADS_STAGING:/workspace/.beads\"\nBEADS_ARGS=\"$BEADS_ARGS -v $PROJECT_DIR/.beads/issues.jsonl:/workspace/.beads/issues.jsonl\"\n```\n\nThis way:\n- beads.db is isolated in staging (SQLite happy)\n- issues.jsonl is shared with host (git sync works)\n\n## Files\n- lib/sandbox/linux/default.nix\n- lib/sandbox/darwin/default.nix","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T22:06:06Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T23:01:07Z","closed_at":"2026-01-10T23:01:07Z","work_type":"mutex"}
{"id":"wx-iwuw","title":"Deduplicate signal scenario phase functions","description":"Extract common base from signal scenarios (complete.sh, blocked.sh, no-signal.sh) which all define similar phase_plan(), phase_ready(), phase_step() functions.\n\nCreate a shared base in tests/ralph/scenarios/lib/ and have each scenario only override the differing phase.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T03:49:19Z","closed_at":"2026-01-30T03:37:07Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-iye","title":"Linux pod orchestration (linux/default.nix)","description":"Create lib/sandbox/linux/default.nix - Podman pod script with 3-container pattern: init (NET_ADMIN, exits), squid (sidecar), claude (unprivileged, interactive).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:35Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-j4o","title":"Fix --userns/--pod conflict in Linux sandbox","description":"Move --userns=keep-id from podman run (line 40) to podman pod create (line 24) in lib/sandbox/linux/default.nix. Recent Podman versions don't allow --userns and --pod together on run.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T19:43:17Z","created_by":"shaun","updated_at":"2026-01-06T19:44:29Z","closed_at":"2026-01-06T19:44:29Z","work_type":"mutex"}
{"id":"wx-j6m","title":"Fix inconsistent error handling in shell scripts","description":"Shell scripts use inconsistent error handling - some use 'set -e', others use 'set -euo pipefail'.\n\n**Locations:**\n- lib/sandbox/linux/entrypoint.sh:2 - Uses 'set -euo pipefail' ✓\n- lib/sandbox/darwin/entrypoint.sh:2 - Uses 'set -euo pipefail' ✓\n- lib/tests/darwin-mount-test.sh:6 - Uses only 'set -e' ✗\n- lib/tests/darwin-network-test.sh:4 - Uses only 'set -e' ✗\n\n**Impact:** Tests might not fail on undefined variables or pipe failures.\n\n**Fix:** All scripts should use 'set -euo pipefail' for strictest error handling.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T19:50:29Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-j7d","title":"Replace sed YAML parsing with yq for beads config","description":"Both entrypoint scripts parse YAML config using sed regex, which is fragile.\n\n**Locations:**\n- lib/sandbox/linux/entrypoint.sh:24\n- lib/sandbox/darwin/entrypoint.sh:77\n\n**Current code:**\n```bash\nPREFIX=$(grep 'issue-prefix:' /workspace/.beads/config.yaml | sed 's/.*\"\\([^\"]*\\)\".*/\\1/' || echo \"\")\n```\n\n**Issues:**\n- Assumes specific YAML formatting (quotes around value)\n- Doesn't handle edge cases (multiple matches, malformed YAML)\n- Could fail silently and default to empty string\n\n**Fix:** Use yq which is already in the base packages.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T19:51:03Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-jf5","title":"Extract shared path expansion functions to lib/sandbox/paths.nix","description":"expandPath and expandDest functions are duplicated between lib/sandbox/linux/default.nix:17-30 and lib/sandbox/darwin/default.nix:8-21. Create lib/sandbox/paths.nix with shared implementations to reduce duplication.","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-12T18:24:09Z","created_by":"unknown","updated_at":"2026-01-12T19:12:54Z","closed_at":"2026-01-12T18:33:05Z","work_type":"mutex"}
{"id":"wx-k8m","title":"Fix etc/gitconfig permission error in wrapix-base-customisation-layer","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T19:30:00Z","created_by":"shaun","updated_at":"2026-01-07T19:42:42Z","closed_at":"2026-01-07T19:42:42Z","work_type":"mutex"}
{"id":"wx-kbz9","title":"Add -n/--new flag to ralph plan command","description":"The spec requires exactly one mode flag (-n, -h, or -u). Currently -h (hidden) and -u (update) exist, but -n/--new for creating a new spec in specs/ is not explicit. Update plan.sh to require -n for new specs (currently the default behavior). Error if no flag or invalid combination.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T01:50:26Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-kvu","title":"Create setup-claude-auth.sh script for OAuth token extraction","description":"Claude Code stores OAuth tokens in macOS Keychain, which is not accessible from the Linux VM. This causes 'Missing API key' error.\n\nSolution: Create scripts/setup-claude-auth.sh that:\n1. Extracts OAuth token from Keychain ('Claude Code-credentials')\n2. Adds it to ~/.claude.json as oauthAccount.accessToken\n3. User runs once after Claude login, then wrapix works\n\nSee plan: ~/.claude/plans/sunny-hugging-wind.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T19:33:09Z","created_by":"shaun","updated_at":"2026-01-08T19:46:56Z","closed_at":"2026-01-08T19:46:56Z","work_type":"mutex"}
{"id":"wx-kwr2","title":"Refactor lib/mcp/tmux/default.nix to export server definition","description":"Refactor lib/mcp/tmux/default.nix to export a server definition instead of profile exports.\n\nCurrent structure exports profiles (debug, rust-debug, mkAuditedDebug).\nNew structure should export:\n```nix\n{\n  name = \"tmux-debug\";\n  package = import ./mcp-server.nix { inherit pkgs; };\n  mkServerConfig = { audit ? null, auditFull ? null }: {\n    command = \"tmux-debug-mcp\";\n    env = lib.optionalAttrs (audit != null) { TMUX_DEBUG_AUDIT = audit; }\n       // lib.optionalAttrs (auditFull != null) { TMUX_DEBUG_AUDIT_FULL = auditFull; };\n  };\n}\n```\n\nThe mkServerConfig function takes options (audit path, auditFull path) and generates the appropriate MCP server configuration with environment variables.\n\nThis will be consumed by the MCP registry in lib/mcp/default.nix.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:30Z","created_by":"unknown","updated_at":"2026-02-01T20:42:10Z","closed_at":"2026-02-01T20:42:10Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-kyuq","title":"Implement template partials system with {{\u003e partial-name}} markers","description":"Create lib/ralph/template/partial/ directory with shared content files: context-pinning.md, exit-signals.md, spec-header.md. Update template rendering to resolve {{\u003e partial-name}} markers. Partials should be resolved during template rendering in the Nix template system.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T02:06:14Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-l4qk","title":"Rename WRAPIX_NETWORK values: full→open, allow→limit","description":"Rename WRAPIX_NETWORK mode 'full' to 'open' and 'allow' to 'limit' across code and specs.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T10:52:44Z","created_by":"wrapix","updated_at":"2026-02-08T10:58:48Z","closed_at":"2026-02-08T10:58:48Z","work_type":"mutex"}
{"id":"wx-l54","title":"Fix beads database detection inside container","description":"bd commands fail with 'database not initialized: issue_prefix config is missing' even though .beads/config.yaml exists with issue-prefix set. Requires explicit BD_DB=/workspace/.beads/beads.db to work. Likely an issue with database path resolution or daemon socket communication in the sandbox environment.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T19:24:19Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T19:28:18Z","closed_at":"2026-01-10T19:28:18Z","work_type":"mutex"}
{"id":"wx-l89i","title":"Add resolve_partials unit tests","description":"Add Nix unit tests to tests/ralph/default.nix for resolve_partials function:\n- Single partial resolution\n- Multiple partials in one template\n- Nested content preserved\n- Missing partial error handling\n\nUse Nix testing patterns consistent with existing tests.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T03:49:19Z","closed_at":"2026-01-30T03:41:01Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-l9x","title":"Create error handling tests","description":"Create tests for: no RALPH_COMPLETE signal (issue stays open), RALPH_BLOCKED signal (workflow pauses), malformed bd output with warning + JSON (parsing succeeds), partial epic completion (2/3 tasks closed, epic stays open).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:50Z","created_by":"unknown","updated_at":"2026-01-26T14:59:13Z","closed_at":"2026-01-26T14:51:03Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-lhg","title":"Review Linux builder security","description":"Review lib/builder/default.nix for remote build security.\n\nFocus areas:\n- SSH configuration security\n- Remote build trust model\n- Build environment isolation\n- Output integrity verification\n\nDocument findings with severity ratings.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:23Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:47:03Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-lqg9","title":"Extend mkSandbox to accept mcp configuration parameter","description":"Modify lib/sandbox/default.nix to accept an 'mcp' parameter in mkSandbox.\n\nCurrent signature:\n```nix\nmkSandbox = { profile, cpus, memoryMb, deployKey, packages, mounts, env }:\n```\n\nNew signature:\n```nix\nmkSandbox = { profile, cpus, memoryMb, deployKey, packages, mounts, env, mcp ? {} }:\n```\n\nThe mcp parameter is an attrset mapping server names to their options:\n```nix\nmcp = {\n  tmux-debug = { };  # enable with defaults\n  # or with auditing:\n  tmux-debug = { audit = \"/workspace/.debug-audit.log\"; };\n};\n```\n\nImplementation:\n1. Import the MCP registry from lib/mcp\n2. For each entry in mcp parameter:\n   - Look up the server in the registry\n   - Add its package to finalProfile.packages\n   - Generate server config via mkServerConfig with user options\n   - Merge into finalProfile.mcp.servers\n3. Pass the enhanced finalProfile to mkImage and platform sandbox","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:30Z","created_by":"unknown","updated_at":"2026-02-01T20:42:10Z","closed_at":"2026-02-01T20:42:10Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-lzf","title":"Document skopeo --insecure-policy rationale","description":"In lib/sandbox/darwin/default.nix:91, skopeo is called with --insecure-policy which bypasses signature verification. This is acceptable because images are built locally from Nix derivations (trusted source). Add a comment documenting this decision for future maintainers.","status":"closed","priority":3,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-12T18:24:09Z","created_by":"unknown","updated_at":"2026-01-12T19:12:54Z","closed_at":"2026-01-12T19:03:38Z","work_type":"mutex"}
{"id":"wx-m261","title":"Fix shellcheck warnings in tests/ralph/run-tests.sh","description":"SC2329 warnings about indirect function invocation and SC2086 about unquoted variables in test file. These are pre-existing issues that block the pre-commit shellcheck hook.","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:48:57Z","created_by":"unknown","updated_at":"2026-01-30T15:04:49Z","closed_at":"2026-01-30T14:27:39Z","work_type":"mutex"}
{"id":"wx-ma9","title":"Delete network filtering files","description":"Delete squid.nix, blocklist.nix, init-image.nix, hook.nix","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T20:29:03Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:29:30Z","work_type":"mutex"}
{"id":"wx-mnf","title":"Profile definitions (profiles.nix)","description":"Create lib/sandbox/profiles.nix with profile definitions: base, rust, go, python, js, nix, devops. Include mount format with source/dest/mode/optional.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-mr3","title":"Fix beads-viewer dependency breaking dev shell","description":"The beads-viewer dependency fails to build, breaking 'nix develop'.\n\n**Error:**\n```\nerror: Cannot build '/nix/store/...-bv-0.11.3-go-modules.drv'\nbash: /nix/store/...-source-stdenv.sh: No such file or directory\n```\n\n**Impact:** Developers cannot access the dev shell with statix linter and other tools.\n\n**Fix options:**\n1. Update beads-viewer to a working version\n2. Make beads-viewer optional in the dev shell\n3. Fix the Go modules derivation","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T19:51:49Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-n2rq","title":"Add molecule test utilities to run-tests.sh","description":"Add molecule-aware test utilities to tests/ralph/run-tests.sh:\n1. assert_molecule_exists - verify molecule was created\n2. assert_molecule_progress - check completion percentage\n3. Update assert_bead_exists - keep for backward compat but prefer molecule assertions\n4. Update setup_test_env to create templates with molecule placeholders ({{MOLECULE_ID}})\n\nNew utility functions:\n```bash\nassert_molecule_exists() {\n  local molecule=$1\n  bd mol show \"$molecule\" \u003e/dev/null 2\u003e\u00261 || fail \"Molecule $molecule does not exist\"\n}\n\nassert_molecule_progress() {\n  local molecule=$1\n  local expected_pct=$2\n  # Parse bd mol progress output and compare\n}\n```","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:35Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:47:56Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-ncp4","title":"Update plan.md template with update mode section","description":"Update lib/ralph/template/plan.md to:\n1. Add update mode section explaining that spec file should NOT be modified during planning\n2. Clarify that requirements are captured in conversation, written by ralph ready\n3. Distinguish between new spec creation (write to file) vs update mode (conversation only)\n\nThe update mode section should explain:\n- In update mode, the spec already exists and has been implemented\n- New requirements are discussed but NOT written to spec during planning\n- ralph ready will update spec and create/bond new tasks to existing molecule","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:32Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:49:59Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-nfyr","title":"ralph ready: create molecule in update mode if missing","description":"When running ralph ready in update mode, if current.json has no molecule ID, the command errors with 'Update mode requires existing molecule ID'. Instead, it should create a new molecule (like new mode) while still checking for existing tasks to avoid recreation.","status":"closed","priority":2,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-01-30T17:39:19Z","created_by":"unknown","updated_at":"2026-01-30T17:41:31Z","closed_at":"2026-01-30T17:41:31Z","work_type":"mutex"}
{"id":"wx-nk4","title":"Create OCI hook for iptables setup","description":"Create lib/sandbox/linux/hook.nix with iptables hook script and JSON config. Hook runs in container namespace with NET_ADMIN before capabilities are dropped.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T19:59:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:00:26Z","work_type":"mutex"}
{"id":"wx-o4l","title":"Document Linux builder trust model in spec","description":"Medium-severity finding from security review: The Linux builder operates with trusted-users and sandbox=false. This is appropriate for single-user local builds but should be explicitly documented in the spec so users understand the security model. Ref: wx-lhg","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:45:33Z","created_by":"unknown","updated_at":"2026-01-26T21:09:25Z","closed_at":"2026-01-26T21:09:25Z","labels":["rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-o4q","title":"Fix README documentation mismatch - jujutsu not in packages","description":"README.md lists 'jujutsu' in the base profile packages, but it's not actually included.\n\n**Locations:**\n- README.md:28 - Lists jujutsu as included\n- lib/sandbox/profiles.nix:5-38 - No jujutsu package present\n\n**Impact:** Users may expect jujutsu to be available but it won't be installed.\n\n**Fix:** Either add jujutsu to base profile packages or remove it from README.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T19:50:59Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-odow","title":"Refactor spec.sh argument parsing: short flags and --spec filter","description":"Refactor argument parsing in lib/ralph/cmd/spec.sh to: (1) Reassign -v from --verbose to --verify; --verbose loses its short flag. (2) Add -j short flag for --judge. (3) Add -a short flag for --all. (4) Add --spec/-s \u003cname\u003e flag to filter to a single spec (matches filename without .md). (5) Short flags compose: -vj is equivalent to --all. (6) Update --help text. Affected file: lib/ralph/cmd/spec.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T17:23:52Z","created_by":"wrapix","updated_at":"2026-02-08T17:38:39Z","closed_at":"2026-02-08T17:38:39Z","labels":["profile:base","spec-live-specs"],"work_type":"mutex"}
{"id":"wx-ope","title":"Add persistent Linux builder using macOS 26 containers","description":"## Summary\n\nAdd a persistent Linux builder mode to wrapix that can serve as a `ssh-ng://` remote builder for Nix. This enables Darwin users to build aarch64-linux packages using Apple's container CLI (macOS 26+).\n\n## Background\n\n- Current wrapix containers are ephemeral (`--rm` flag, PID-based names)\n- Apple containers run each container as a separate lightweight Linux VM via Virtualization.framework\n- This epic adds a new `wrapix-builder` command that creates a persistent container with SSH access\n\n## Architecture\n\n```\nmacOS Host\n├── nix-daemon (uses ssh-ng://builder@localhost:2222)\n├── Persistent Storage (~/.local/share/wrapix/)\n│   ├── builder-nix/ (store)\n│   └── builder-keys/\n└── wrapix-builder Container (persistent, no --rm)\n    ├── sshd (:22) → port 2222 on host\n    ├── nix-daemon\n    └── /nix mounted (persistent VirtioFS)\n```\n\n## Key Principle\n\nBuilder is completely separate from `mkSandbox` - no modifications to existing sandbox code. The builder has its own:\n- Image (`lib/sandbox/builder/image.nix`)\n- Entrypoint (`lib/sandbox/builder/entrypoint.sh`)\n- CLI wrapper (`lib/builder/default.nix`)\n\n## Usage (Target)\n\n```bash\nwrapix-builder start    # Start persistent builder\nwrapix-builder ssh      # Connect to builder\nwrapix-builder config   # Show nix.conf settings\nwrapix-builder stop     # Stop builder\n```\n\n## Requirements\n\n- macOS 26+ (Tahoe) required\n- aarch64-linux only (native ARM64)\n- Apple Silicon\n\n## Reference\n\n- Plan file: ~/.claude/plans/modular-yawning-flame.md\n- Existing sandbox code: lib/sandbox/darwin/default.nix","status":"closed","priority":1,"issue_type":"epic","owner":"sandbox@wrapix.dev","created_at":"2026-01-15T00:02:57Z","created_by":"shaun","updated_at":"2026-01-15T00:19:19Z","closed_at":"2026-01-15T00:16:30Z","work_type":"mutex"}
{"id":"wx-ope.1","title":"Create builder entrypoint script","description":"## Summary\n\nCreate the entrypoint script for the Linux builder container that starts sshd and nix-daemon.\n\n## File to Create\n\n`lib/sandbox/builder/entrypoint.sh`\n\n## Implementation\n\nThe entrypoint script must:\n\n1. **Generate SSH host key on first run**\n   ```bash\n   if [ ! -f /etc/ssh/ssh_host_ed25519_key ]; then\n     ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N \"\"\n   fi\n   ```\n\n2. **Setup builder user**\n   - Create user with UID 1000 (for VirtioFS ownership)\n   - Create home directory at /home/builder\n   - Setup .ssh directory with correct permissions\n\n3. **Install authorized keys**\n   - Keys are mounted at /run/keys/builder_ed25519.pub\n   - Copy to /home/builder/.ssh/authorized_keys\n   - Set ownership to builder:builder, perms 600\n\n4. **Configure nix-daemon**\n   - Write /etc/nix/nix.conf with:\n     - `experimental-features = nix-command flakes`\n     - `sandbox = false` (container provides isolation)\n     - `trusted-users = root builder`\n     - `max-jobs = auto`\n     - `cores = 0`\n     - GC settings: `min-free = 1073741824`, `max-free = 3221225472`\n\n5. **Start services**\n   - Start nix-daemon in background (`nix-daemon \u0026`)\n   - Start sshd in foreground (`exec /usr/sbin/sshd -D -e`)\n   - sshd must stay in foreground to keep container alive\n\n## Reference Code\n\nSee `lib/sandbox/darwin/entrypoint.sh` for patterns on:\n- User creation\n- Home directory setup\n- Permission handling\n\n## Acceptance Criteria\n\n- [ ] Script is executable (`chmod +x`)\n- [ ] sshd starts and accepts connections with key auth\n- [ ] nix-daemon starts and can process build requests\n- [ ] Builder user can run nix commands\n- [ ] Container stays alive (sshd in foreground)","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-15T00:03:11Z","created_by":"shaun","updated_at":"2026-01-15T00:19:19Z","closed_at":"2026-01-15T00:10:59Z","dependencies":[{"issue_id":"wx-ope.1","depends_on_id":"wx-ope","type":"parent-child","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ope.2","title":"Create builder OCI image","description":"## Summary\n\nCreate the OCI image definition for the Linux builder container that includes sshd, nix-daemon, and all necessary configuration.\n\n## File to Create\n\n`lib/sandbox/builder/image.nix`\n\n## Implementation\n\n### Packages to Include\n\n```nix\nbuilderPackages = with pkgs; [\n  nix                    # nix-daemon\n  openssh                # sshd for remote access  \n  coreutils\n  bash\n  gnugrep\n  gnutar\n  gzip\n  xz\n  # From base sandbox profile (lib/sandbox/profiles.nix):\n  git\n  cacert\n];\n```\n\n### Configuration Files to Generate\n\n1. **passwd file** - root, builder (UID 1000), nobody\n2. **group file** - root, users (GID 100 with builder), nogroup\n3. **sshd_config** - key-only auth, allow builder user, port 22\n\n```nix\nsshdConfig = pkgs.writeTextDir \"etc/ssh/sshd_config\" ''\n  Port 22\n  HostKey /etc/ssh/ssh_host_ed25519_key\n  AuthorizedKeysFile /home/%u/.ssh/authorized_keys\n  PasswordAuthentication no\n  PermitRootLogin no\n  AllowUsers builder\n  Subsystem sftp internal-sftp\n'';\n```\n\n### Image Structure\n\nUse `dockerTools.buildLayeredImage` pattern from `lib/sandbox/image.nix`:\n\n```nix\npkgs.dockerTools.buildLayeredImage {\n  name = \"wrapix-builder\";\n  tag = \"latest\";\n  maxLayers = 50;\n  includeNixDB = true;\n\n  contents = [\n    passwdFile\n    groupFile\n    sshdConfig\n    pkgs.dockerTools.usrBinEnv\n    pkgs.dockerTools.binSh\n    pkgs.dockerTools.caCertificates\n    builderEnv\n  ];\n\n  extraCommands = ''\n    mkdir -p tmp var/run var/log home/builder/.ssh run/sshd etc/ssh\n    chmod 1777 tmp\n    chmod -R a+rwX nix/store nix/var/nix\n    cp ${./entrypoint.sh} entrypoint.sh\n    chmod +x entrypoint.sh\n  '';\n\n  config = {\n    Env = [\n      \"PATH=/bin:/usr/bin\"\n      \"NIX_SSL_CERT_FILE=/etc/ssl/certs/ca-bundle.crt\"\n    ];\n    Entrypoint = [ \"/entrypoint.sh\" ];\n    ExposedPorts = { \"22/tcp\" = {}; };\n  };\n}\n```\n\n## Reference Code\n\n- `lib/sandbox/image.nix` - Main image builder pattern\n- `lib/sandbox/profiles.nix` - Base packages list\n\n## Dependencies\n\n- Requires `wx-ope.1` (entrypoint script) to exist\n\n## Acceptance Criteria\n\n- [ ] Image builds successfully with `nix build`\n- [ ] Contains nix-daemon binary\n- [ ] Contains sshd binary with config\n- [ ] /nix/store is writable\n- [ ] Entrypoint script is at /entrypoint.sh\n- [ ] CA certificates are present","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-15T00:03:27Z","created_by":"shaun","updated_at":"2026-01-15T00:19:19Z","closed_at":"2026-01-15T00:11:55Z","dependencies":[{"issue_id":"wx-ope.2","depends_on_id":"wx-ope","type":"parent-child","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-ope.2","depends_on_id":"wx-ope.1","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ope.3","title":"Create wrapix-builder CLI wrapper","description":"## Summary\n\nCreate the main CLI wrapper that manages the persistent builder container lifecycle (start/stop/status/ssh/config commands).\n\n## File to Create\n\n`lib/builder/default.nix`\n\n## Implementation\n\n### Function Signature\n\n```nix\n{ pkgs, linuxPkgs, skopeo }:\n\nlet\n  builderImage = import ../sandbox/builder/image.nix {\n    pkgs = linuxPkgs;\n  };\nin pkgs.writeShellScriptBin \"wrapix-builder\" ''\n  # ... shell script\n''\n```\n\n### CLI Commands\n\n1. **start** - Start the builder container\n   - Check macOS 26+ requirement\n   - Ensure container system is running (`container system start`)\n   - Check if container already exists\n   - Generate SSH keys if missing\n   - Initialize persistent nix store directory\n   - Load builder image via skopeo\n   - Run container with: static name, no --rm, port 2222:22, nix store mount, keys mount\n\n2. **stop** - Stop and remove the container\n   ```bash\n   container stop wrapix-builder 2\u003e/dev/null || true\n   container rm wrapix-builder 2\u003e/dev/null || true\n   ```\n\n3. **status** - Show builder status and SSH connection info\n\n4. **ssh** - Connect to builder via SSH\n   ```bash\n   exec ssh -p 2222 -i \"$KEYS_DIR/builder_ed25519\" -o StrictHostKeyChecking=no builder@localhost\n   ```\n\n5. **config** - Print nix.conf configuration for remote builder\n\n### Key Paths\n\n```bash\nXDG_DATA_HOME=\"${XDG_DATA_HOME:-$HOME/.local/share}\"\nWRAPIX_DATA=\"$XDG_DATA_HOME/wrapix\"\nKEYS_DIR=\"$WRAPIX_DATA/builder-keys\"\nNIX_STORE=\"$WRAPIX_DATA/builder-nix\"\nCONTAINER_NAME=\"wrapix-builder\"\n```\n\n### Image Loading Pattern\n\nCopy from `lib/sandbox/darwin/default.nix:58-83`:\n\n```bash\n# Convert docker-archive to oci-archive via skopeo\nOCI_TAR=\"$WRAPIX_CACHE/builder-image.tar\"\n${skopeo}/bin/skopeo --insecure-policy copy \\\n  \"docker-archive:${builderImage}\" \"oci-archive:$OCI_TAR\"\n\n# Load into container CLI\nLOAD_OUTPUT=$(container image load --input \"$OCI_TAR\" 2\u003e\u00261)\nLOADED_REF=$(echo \"$LOAD_OUTPUT\" | grep -oE 'untagged@sha256:[a-f0-9]+')\ncontainer image tag \"$LOADED_REF\" \"$IMAGE_NAME\"\nrm -f \"$OCI_TAR\"\n```\n\n### Container Run Command\n\n```bash\nexec container run \\\n  --name \"$CONTAINER_NAME\" \\\n  -c 4 \\\n  -m 4096M \\\n  --network default \\\n  -p 2222:22 \\\n  -v \"$NIX_STORE:/nix\" \\\n  -v \"$KEYS_DIR:/run/keys:ro\" \\\n  \"$BUILDER_IMAGE\" \\\n  /entrypoint.sh\n```\n\n## Reference Code\n\n- `lib/sandbox/darwin/default.nix` - macOS version check, image loading, container run\n- `lib/util/shell.nix` - Cleanup utilities\n\n## Dependencies\n\n- Requires `wx-ope.2` (builder image) to exist\n\n## Acceptance Criteria\n\n- [ ] `wrapix-builder start` creates and starts container\n- [ ] `wrapix-builder stop` stops and removes container\n- [ ] `wrapix-builder status` shows running state\n- [ ] `wrapix-builder ssh` connects to container\n- [ ] `wrapix-builder config` outputs valid nix.conf snippet\n- [ ] Error on macOS \u003c 26\n- [ ] SSH keys generated automatically on first run","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-15T00:03:47Z","created_by":"shaun","updated_at":"2026-01-15T00:19:19Z","closed_at":"2026-01-15T00:13:04Z","dependencies":[{"issue_id":"wx-ope.3","depends_on_id":"wx-ope","type":"parent-child","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-ope.3","depends_on_id":"wx-ope.2","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ope.4","title":"Expose wrapix-builder in flake.nix","description":"## Summary\n\nAdd the wrapix-builder package to the flake outputs so users can build and run it.\n\n## File to Modify\n\n`flake.nix`\n\n## Implementation\n\n### Add to Packages\n\nAdd wrapix-builder to the packages output, similar to how wrapix is exposed:\n\n```nix\npackages = {\n  ${system} = {\n    # ... existing packages ...\n    \n    wrapix-builder = import ./lib/builder {\n      inherit pkgs;\n      linuxPkgs = import nixpkgs { system = \"aarch64-linux\"; };\n      inherit (pkgs) skopeo;\n    };\n  };\n};\n```\n\n### Considerations\n\n1. **Cross-compilation**: The builder image needs to be built for `aarch64-linux`, even when building on `aarch64-darwin`. This requires either:\n   - A remote Linux builder (existing setup)\n   - Cross-compilation support\n\n2. **Darwin-only**: This package only makes sense on Darwin systems. Consider adding a check or only exposing it for darwin systems.\n\n3. **Dependencies**: Ensure skopeo is available in the darwin pkgs.\n\n### Alternative Structure\n\nIf the flake already has conditional logic for darwin packages:\n\n```nix\npackages.${system} = {\n  # ... \n} // lib.optionalAttrs pkgs.stdenv.isDarwin {\n  wrapix-builder = import ./lib/builder { ... };\n};\n```\n\n## Reference Code\n\n- Current `flake.nix` - See how wrapix and test packages are exposed\n- `lib/sandbox/default.nix` - How linuxPkgs is created\n\n## Dependencies\n\n- Requires `wx-ope.3` (CLI wrapper) to exist\n\n## Acceptance Criteria\n\n- [ ] `nix build .#wrapix-builder` succeeds on Darwin\n- [ ] Result contains `bin/wrapix-builder` executable\n- [ ] Running `./result/bin/wrapix-builder --help` shows usage","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-15T00:04:00Z","created_by":"shaun","updated_at":"2026-01-15T00:19:19Z","closed_at":"2026-01-15T00:14:59Z","dependencies":[{"issue_id":"wx-ope.4","depends_on_id":"wx-ope","type":"parent-child","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-ope.4","depends_on_id":"wx-ope.3","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ope.5","title":"Integration test: verify linux builder works as remote builder","description":"## Summary\n\nCreate an integration test to verify the wrapix-builder works as a Nix remote builder via `ssh-ng://` protocol.\n\n## File to Create (Optional)\n\n`tests/darwin-builder.nix` or `tests/darwin-builder-test.sh`\n\n## Manual Test Procedure\n\n### 1. Build and Start Builder\n\n```bash\n# Build the wrapix-builder package\nnix build .#wrapix-builder\n\n# Start the builder\n./result/bin/wrapix-builder start\n\n# Verify it's running\n./result/bin/wrapix-builder status\n```\n\n### 2. Test SSH Connection\n\n```bash\n# Connect via SSH\n./result/bin/wrapix-builder ssh\n\n# Inside container, verify:\nnix --version\nnix-daemon --version\nwhoami  # Should be \"builder\"\n```\n\n### 3. Test Remote Build\n\n```bash\n# Get config snippet\n./result/bin/wrapix-builder config\n\n# Test build with explicit builder (no nix.conf changes)\nnix build --builders 'ssh-ng://builder@localhost:2222 aarch64-linux ~/.local/share/wrapix/builder-keys/builder_ed25519' \\\n  --max-jobs 0 \\\n  nixpkgs#hello\n\n# Verify build succeeded\n./result/bin/hello\n```\n\n### 4. Test Store Persistence\n\n```bash\n# Stop builder\n./result/bin/wrapix-builder stop\n\n# Restart builder\n./result/bin/wrapix-builder start\n\n# Verify store persists (hello should still be in remote store)\n./result/bin/wrapix-builder ssh\nls /nix/store | grep hello\n```\n\n### 5. Test Cleanup\n\n```bash\n./result/bin/wrapix-builder stop\n```\n\n## Automated Test (Optional)\n\n```bash\n#\\!/bin/bash\nset -euo pipefail\n\necho \"=== Building wrapix-builder ===\"\nnix build .#wrapix-builder\n\necho \"=== Starting builder ===\"\n./result/bin/wrapix-builder start \u0026\nBUILDER_PID=$\\!\nsleep 5\n\necho \"=== Testing SSH connection ===\"\n./result/bin/wrapix-builder ssh \"nix --version\"\n\necho \"=== Testing remote build ===\"\nKEYS=\"$HOME/.local/share/wrapix/builder-keys/builder_ed25519\"\nnix build --builders \"ssh-ng://builder@localhost:2222 aarch64-linux $KEYS\" \\\n  --max-jobs 0 \\\n  nixpkgs#hello\n\necho \"=== Stopping builder ===\"\n./result/bin/wrapix-builder stop\n\necho \"=== All tests passed ===\"\n```\n\n## Dependencies\n\n- Requires `wx-ope.4` (flake integration) to exist\n- Requires macOS 26+ environment with container CLI\n\n## Acceptance Criteria\n\n- [ ] Builder starts successfully\n- [ ] SSH connection works with generated keys\n- [ ] nix-daemon responds to build requests\n- [ ] Remote build of simple package succeeds\n- [ ] Store persists across container restart\n- [ ] Builder stops cleanly","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-15T00:04:16Z","created_by":"shaun","updated_at":"2026-01-15T00:19:19Z","closed_at":"2026-01-15T00:16:21Z","dependencies":[{"issue_id":"wx-ope.5","depends_on_id":"wx-ope","type":"parent-child","created_at":"2026-01-22T16:00:25Z","created_by":"import"},{"issue_id":"wx-ope.5","depends_on_id":"wx-ope.4","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ozn","title":"[INFO] pasta network mode uses default configuration","description":"**Finding**: Linux sandbox uses `--network=pasta` without additional restrictions.\n\n**Impact**: Full userspace networking with no egress filtering or port restrictions.\n\n**Analysis**:\n- pasta is Podman's userspace TCP/IP stack for rootless containers\n- Default pasta config provides: outbound TCP/UDP, inbound (if port-forwarded), DNS resolution\n- No ingress ports are forwarded by the wrapix sandbox (no `-p` flags)\n- This aligns with documented 'Open network' design principle\n\n**pasta capabilities**:\n- Outbound: All TCP/UDP traffic allowed\n- Inbound: Only if explicitly forwarded (not done here)\n- DNS: Container uses host's resolvers\n\n**Current configuration (lib/sandbox/linux/default.nix:188)**:\n```\n--network=pasta\n```\n\n**Recommendation**: This is correct for the design goals. Document that pasta provides open outbound access but no inbound ports unless explicitly configured.\n\n**Severity**: Info (works as designed)","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:38:34Z","created_by":"unknown","updated_at":"2026-01-26T21:45:58Z","closed_at":"2026-01-26T21:38:56Z","labels":["network","rl-security-review"],"work_type":"mutex"}
{"id":"wx-p42","title":"[INFO] macOS uses vmnet with --network=default","description":"**Finding**: macOS sandbox uses `--network default` with explicit DNS servers.\n\n**Impact**: Full network access through vmnet bridge (192.168.64.0/24 network).\n\n**Analysis** (lib/sandbox/darwin/default.nix:295-297):\n```\n--network default\n--dns 100.100.100.100\n--dns 1.1.1.1\n```\n\n**DNS Configuration**:\n- Primary: 100.100.100.100 (Tailscale MagicDNS)\n- Secondary: 1.1.1.1 (Cloudflare public DNS)\n\n**Tailscale consideration**:\n- When Tailscale exit node is active, vmnet traffic may route through VPN\n- scripts/tailscale/setup-routing.sh provides NAT rules for this case\n- This is a feature, not a vulnerability\n\n**Network capabilities**:\n- Outbound: All TCP/UDP/ICMP through vmnet NAT\n- Inbound: No ports forwarded to sandbox containers\n- DNS: Explicit servers configured (container doesn't inherit host resolvers)\n\n**Recommendation**: Documented behavior. DNS hardcoding is sensible for predictable resolution.\n\n**Severity**: Info (works as designed)","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:38:48Z","created_by":"unknown","updated_at":"2026-01-26T21:45:58Z","closed_at":"2026-01-26T21:40:13Z","labels":["network","rl-security-review"],"work_type":"mutex"}
{"id":"wx-p5m","title":"Library exports (lib/default.nix)","description":"Create lib/default.nix exporting: mkSandbox, mkDevShell, deriveProfile, profiles.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:36Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T19:03:55Z","work_type":"mutex"}
{"id":"wx-p6ud","title":"Add ralph check integration tests","description":"Create tests for ralph check command:\n- Valid templates pass\n- Missing partial fails\n- Invalid Nix syntax fails\n- Exit codes correct (0 = valid, 1 = errors)\n\nTest scenarios in tests/ralph/scenarios/check-*.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T14:24:20Z","closed_at":"2026-01-30T03:53:02Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-pzz","title":"Update ralph-workflow.md spec","description":"Update specs/ralph-workflow.md to document that 'ralph plan \u003clabel\u003e' now does setup AND interview (merged from start). Remove documentation of 'ralph start' as separate command. Note that setup steps are idempotent.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:52Z","created_by":"unknown","updated_at":"2026-01-26T15:33:47Z","closed_at":"2026-01-26T15:01:13Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-q514","title":"ralph plan fails when template dir missing outside container","description":"When running ralph plan outside a container, it fails with 'Plan prompt template not found' because /etc/wrapix/ralph-template doesn't exist and there's no fallback to lib/ralph/template/","status":"closed","priority":1,"issue_type":"bug","owner":"gpg@taheris.net","created_at":"2026-01-30T00:16:34Z","created_by":"unknown","updated_at":"2026-01-30T00:23:50Z","closed_at":"2026-01-30T00:23:50Z","work_type":"mutex"}
{"id":"wx-q6x","title":"Implement container-to-host notification system","description":"## Problem\nClaude Code runs inside containers but needs to trigger native notifications on the host machine (Linux or macOS).\n\n## Solution\nUnix socket + host daemon approach:\n- Host runs `wrapix-notifyd` listening on a Unix socket\n- Socket is mounted into containers\n- Container uses `wrapix-notify` client to send notification requests\n- Daemon triggers native notifications (terminal-notifier on macOS, notify-send on Linux)\n\n## Implementation\nSee plan file: ~/.claude/plans/ethereal-bubbling-hellman.md\n\nFiles to create/modify:\n- lib/notifyd.nix (create) - Host-side notification daemon\n- lib/notify-client.nix (create) - Container-side client\n- lib/sandbox/darwin/default.nix (modify) - Add socket mount\n- lib/sandbox/linux/default.nix (modify) - Add socket mount\n- lib/sandbox/image.nix (modify) - Include notify client\n- flake.nix (modify) - Expose notifyd package","status":"closed","priority":2,"issue_type":"feature","owner":"sandbox@wrapix.dev","created_at":"2026-01-12T00:12:15Z","created_by":"shaun","updated_at":"2026-01-12T00:44:26Z","closed_at":"2026-01-12T00:30:22Z","work_type":"mutex"}
{"id":"wx-qge","title":"Add resource limits to Linux containers","description":"Darwin containers have CPU (-c) and memory (-m 4G) limits, but Linux Podman containers have no resource limits configured.\n\n**Location:** lib/sandbox/linux/default.nix:133-147\n\n**Impact:** Container can consume unlimited CPU/memory on Linux host.\n\n**Fix:** Add --memory and --cpus flags to podman run command, similar to Darwin implementation.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-10T19:50:29Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T21:41:24Z","closed_at":"2026-01-10T21:41:24Z","work_type":"mutex"}
{"id":"wx-qpfk","title":"Refactor tmux-mcp to opt-in at sandbox creation","description":"Refactor MCP server integration from profile-based to opt-in at sandbox creation time. Eliminates profile proliferation and makes it easy for consumers to add MCP servers.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:26Z","created_by":"unknown","updated_at":"2026-02-01T20:36:54Z","closed_at":"2026-02-01T20:36:54Z","labels":["spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-qpfk.1","title":"Remove debug profiles from lib/sandbox/profiles.nix","description":"Remove the debug and rust-debug profile definitions from lib/sandbox/profiles.nix. Also remove the mkAuditedDebug export. This eliminates the profile-based MCP integration approach.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:44Z","created_by":"unknown","updated_at":"2026-02-01T20:36:56Z","closed_at":"2026-02-01T20:36:56Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-qpfk.1","depends_on_id":"wx-qpfk","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qpfk.2","title":"Delete lib/mcp/tmux/profile.nix","description":"Delete lib/mcp/tmux/profile.nix entirely. The package and server config will move to lib/mcp/tmux/default.nix.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:45Z","created_by":"unknown","updated_at":"2026-02-01T20:36:57Z","closed_at":"2026-02-01T20:36:57Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-qpfk.2","depends_on_id":"wx-qpfk","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qpfk.3","title":"Remove wrapix-debug exports from flake.nix","description":"Remove wrapix-debug and wrapix-rust-debug from flake.nix packages exports.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:46Z","created_by":"unknown","updated_at":"2026-02-01T20:36:58Z","closed_at":"2026-02-01T20:36:58Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-qpfk.3","depends_on_id":"wx-qpfk","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qpfk.4","title":"Create MCP registry in lib/mcp/default.nix","description":"Create lib/mcp/default.nix as an MCP registry that maps server names to their definitions. Each server should export: { name, package, mkServerConfig }. mkSandbox will look up enabled servers and merge their packages and configs.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:47Z","created_by":"unknown","updated_at":"2026-02-01T20:36:59Z","closed_at":"2026-02-01T20:36:59Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-qpfk.4","depends_on_id":"wx-qpfk","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qpfk.5","title":"Extend mkSandbox to accept MCP configuration","description":"Add mcp parameter to mkSandbox in lib/sandbox/default.nix. Example usage:\nmkSandbox { profile = profiles.rust; mcp = { tmux-debug = {}; }; }\nmkSandbox { profile = profiles.rust; mcp = { tmux-debug = { audit = \"/path\"; }; }; }","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:48Z","created_by":"unknown","updated_at":"2026-02-01T20:37:00Z","closed_at":"2026-02-01T20:37:00Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-qpfk.5","depends_on_id":"wx-qpfk","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qpfk.6","title":"Update tmux-debug server definition in lib/mcp/tmux/default.nix","description":"Update lib/mcp/tmux/default.nix to export server definition instead of profiles. Config schema: { audit = \"/path/to/log\"; auditFull = \"/path/to/dir\"; }. Generate MCP server config with appropriate env vars based on options.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:49Z","created_by":"unknown","updated_at":"2026-02-01T20:37:01Z","closed_at":"2026-02-01T20:37:01Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-qpfk.6","depends_on_id":"wx-qpfk","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qpfk.7","title":"Update specs/tmux-mcp.md documentation","description":"Update specs/tmux-mcp.md:\n- Remove 'Debug Profile' section showing profile definitions\n- Update 'Client Configuration' section to show new mkSandbox pattern\n- Update examples throughout to use new opt-in mechanism","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:25:50Z","created_by":"unknown","updated_at":"2026-02-01T20:37:02Z","closed_at":"2026-02-01T20:37:02Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-qpfk.7","depends_on_id":"wx-qpfk","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qtrk","title":"Expand ralph loop hook test coverage","description":"Update tests for ralph loop hooks:\n\n1. Update tests/ralph/run-tests.sh to remove skip for hook tests\n2. Expand tests/ralph/scenarios/hook-test.sh with coverage for:\n   - All four hook points (pre-loop, pre-step, post-step, post-loop)\n   - Template variable substitution ({{LABEL}}, {{ISSUE_ID}}, {{STEP_COUNT}}, {{STEP_EXIT_CODE}})\n   - Failure handling modes (block, warn, skip)\n\nSuccess criteria: Hook tests no longer skipped; all pass\n\nAffected files:\n- tests/ralph/run-tests.sh\n- tests/ralph/scenarios/hook-test.sh","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T18:31:03Z","created_by":"unknown","updated_at":"2026-01-30T19:43:35Z","closed_at":"2026-01-30T19:40:34Z","labels":["spec-pre-commit"],"dependencies":[{"issue_id":"wx-qtrk","depends_on_id":"wx-t6rh","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-qx3","title":"Reduce excessive use of || true error suppression","description":"Many commands use '|| true' to suppress errors, which could hide real problems.\n\n**High-risk locations:**\n- lib/sandbox/linux/entrypoint.sh:9 - fuse-overlayfs failure could silently break Nix builds\n- lib/sandbox/linux/entrypoint.sh:26 - bd init failure silently ignored\n- lib/sandbox/darwin/entrypoint.sh:79 - bd init failure silently ignored\n\n**Acceptable locations:**\n- lib/sandbox/darwin/default.nix:85 - container image delete (expected to fail if image doesn't exist)\n\n**Impact:** Real failures could be masked, making debugging difficult.\n\n**Fix:** Check specific error conditions rather than blanket suppression, or add logging when suppressing expected errors.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T19:51:37Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-r0u","title":"Verify sync pushes","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T22:20:48Z","created_by":"unknown","updated_at":"2026-01-26T22:21:11Z","closed_at":"2026-01-26T22:21:11Z","work_type":"mutex"}
{"id":"wx-r4v","title":"Add git SSH signing config to Linux entrypoint","description":"Modify lib/sandbox/linux/entrypoint.sh to configure git SSH signing using the deploy key.\n\nAdd after the existing deploy key SSH config (after line 11):\n```bash\n# Configure git SSH signing using deploy key\nif [ -n \"${WRAPIX_DEPLOY_KEY:-}\" ] \u0026\u0026 [ -f \"$WRAPIX_DEPLOY_KEY\" ]; then\n  git config --global gpg.format ssh\n  git config --global user.signingkey \"$WRAPIX_DEPLOY_KEY\"\n  # Create allowed_signers for signature verification\n  mkdir -p \"$HOME/.config/git\"\n  ssh-keygen -y -f \"$WRAPIX_DEPLOY_KEY\" \u003e \"$WRAPIX_DEPLOY_KEY.pub.tmp\" 2\u003e/dev/null || true\n  if [ -f \"$WRAPIX_DEPLOY_KEY.pub.tmp\" ]; then\n    echo \"$GIT_AUTHOR_EMAIL $(cat $WRAPIX_DEPLOY_KEY.pub.tmp)\" \u003e \"$HOME/.config/git/allowed_signers\"\n    rm \"$WRAPIX_DEPLOY_KEY.pub.tmp\"\n    git config --global gpg.ssh.allowedSignersFile \"$HOME/.config/git/allowed_signers\"\n  fi\nfi\n\n# Enable auto-signing if requested\nif [ \"${WRAPIX_GIT_SIGN:-}\" = \"1\" ] || [ \"${WRAPIX_GIT_SIGN:-}\" = \"true\" ]; then\n  git config --global commit.gpgsign true\nfi\n```\n\nFile: lib/sandbox/linux/entrypoint.sh","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-18T18:00:07Z","created_by":"unknown","updated_at":"2026-01-18T18:47:26Z","closed_at":"2026-01-18T18:03:45Z","dependencies":[{"issue_id":"wx-r4v","depends_on_id":"wx-buk","type":"blocks","created_at":"2026-01-22T16:00:25Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-r7u","title":"Clean up unused git sshCommand config in image","description":"The gitconfig includes a complex sshCommand setup that's no longer used after commit 23ec318.\n\n**Location:** lib/sandbox/image.nix:24\n\n**Code:**\n```nix\nsshCommand = sh -c '[ -n \"$DEPLOY_KEY_NAME\" ] \u0026\u0026 exec ssh -i \"$HOME/.ssh/deploy_keys/$DEPLOY_KEY_NAME\" -o IdentitiesOnly=yes \"$@\" || exec ssh \"$@\"' --\n```\n\n**Context:** Recent commit 23ec318 switched to GIT_SSH_COMMAND environment variable approach, but the old config remains in the image.\n\n**Fix:** Remove the unused sshCommand from gitconfig or verify it's still needed.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T19:51:18Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-rex","title":"Create happy path test scenario","description":"Create tests/ralph/scenarios/happy-path.sh that tests full workflow: ralph plan creates spec with RALPH_COMPLETE, ralph ready creates epic + tasks with dependencies (RALPH_COMPLETE), ralph step completes first unblocked task (RALPH_COMPLETE), ralph loop completes remaining tasks and closes epic.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:47Z","created_by":"unknown","updated_at":"2026-01-26T15:33:47Z","closed_at":"2026-01-26T15:33:43Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-rfr","title":"Fix ~/.claude.json and ~/.claude/ mounts in Darwin VM","description":"## Problem\nVirtioFS (Apple's Virtualization framework) only supports directory mounts via VZSingleDirectoryShare. The Swift runner explicitly skips file mounts (SandboxRunner.swift:150-152). This means:\n- ~/.claude/ (directory) - works\n- ~/.claude.json (file) - silently skipped\n- ~/.claude.json.backup (file) - silently skipped\n\n## Solution: Parent Directory Mounts with Symlinks\nFor file mounts, mount the parent directory to a hidden location, then symlink the specific file to its expected destination.\n\n## Files to Modify\n1. lib/sandbox/darwin/default.nix - Separate file vs directory mounts, add --file-mount args\n2. lib/sandbox/darwin/swift/Sources/wrapix-runner/SandboxRunner.swift - Handle file mounts by mounting parent dirs to /mnt/wrapix/fm/\u003cn\u003e/, pass WRAPIX_FILE_MOUNTS env var\n3. lib/sandbox/image.nix - Update entrypoint to parse WRAPIX_FILE_MOUNTS and create symlinks\n\n## Edge Cases\n- Optional mounts: Check file existence at runtime before adding to args\n- Multiple files from same parent: Each gets its own mount (simple, small overhead)\n- File permissions: Symlinks preserve original file permissions through virtiofs","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T11:06:33Z","created_by":"shaun","updated_at":"2026-01-08T12:57:58Z","closed_at":"2026-01-08T12:57:58Z","work_type":"mutex"}
{"id":"wx-rw6","title":"Review image building security","description":"Review lib/sandbox/image.nix for supply chain and base image security.\n\nFocus areas:\n- Base image provenance and pinning\n- Package version pinning\n- Known CVE exposure in dependencies\n- Build reproducibility\n- Layer composition security\n\nDocument findings with severity ratings.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:20Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:44:15Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-s3lp","title":"Remove hardcoded template copy code","description":"Remove the hardcoded template copy logic from plan.sh, ready.sh, step.sh (lines ~207-216):\n\n```bash\n# Copy missing template files (handles upgrades where new templates were added)\nif [ -d \"$TEMPLATE\" ]; then\n  for template_file in plan.md ready.md step.md; do\n    if [ ! -f \"$RALPH_DIR/$template_file\" ] ...\n```\n\nThis bug is replaced by the explicit ralph sync command.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T14:24:20Z","closed_at":"2026-01-30T03:58:22Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-s9rv","title":"Security review: boundary/policy/lifecycle overhaul","description":"Molecule for security-review spec updates: microVM boundary, threat model, network modes, PID limits, audit trail, and directory consolidation.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-08T01:33:57Z","created_by":"wrapix","updated_at":"2026-02-08T10:23:33Z","closed_at":"2026-02-08T10:23:33Z","labels":["spec-security-review"],"work_type":"mutex"}
{"id":"wx-s9rv.1","title":"Restructure security spec with boundary/policy/lifecycle taxonomy","description":"Restructure specs/security-review.md using a three-question model:\n- **Boundary**: where isolation is enforced (container vs microVM vs gVisor vs Wasm)\n- **Policy**: what the code can touch inside the boundary (filesystem, network, credentials, syscalls)\n- **Lifecycle**: what persists between runs (ephemeral, workspace, snapshot)\n\nDocument that both Linux and macOS now share the same boundary class (microVM via hardware virtualization), with implementation differences noted.\n\nThe existing component-by-component analysis (keys, mounts, nix) stays but is reorganized under the new taxonomy sections. This is a spec-only change — no code modifications.\n\n**Files:** specs/security-review.md","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T01:35:56Z","created_by":"wrapix","updated_at":"2026-02-08T09:29:17Z","closed_at":"2026-02-08T09:29:17Z","labels":["profile:base","spec-security-review"],"dependencies":[{"issue_id":"wx-s9rv.1","depends_on_id":"wx-s9rv","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-s9rv.2","title":"Add threat model section: policy leakage as primary threat","description":"Add a 'Threat Model' section to specs/security-review.md that names policy leakage as the primary realistic threat for AI sandboxes.\n\nPolicy leakage: the agent exfiltrates data through legitimate channels (network access, mounted credentials) without needing any exploit. A prompt injection or misbehaving model can use deploy keys + open network + OAuth token + workspace access to exfiltrate code, secrets, or credentials through normal operations.\n\nThis is distinct from kernel/boundary escapes (which are mitigated by the microVM boundary).\n\nThe existing component-by-component analysis (keys, mounts, nix) stays but is reframed under this threat model. The threat model section should come early in the spec, after the taxonomy introduction.\n\n**Files:** specs/security-review.md","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T01:35:56Z","created_by":"wrapix","updated_at":"2026-02-08T09:30:17Z","closed_at":"2026-02-08T09:30:17Z","labels":["profile:base","spec-security-review"],"dependencies":[{"issue_id":"wx-s9rv.2","depends_on_id":"wx-s9rv","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-s9rv.3","title":"Add microVM boundary for Linux via podman --runtime krun","description":"Linux currently uses a container boundary (shared host kernel). macOS already uses a microVM boundary (Apple Virtualization.framework). Close this asymmetry by making libkrun/krun the default Linux runtime.\n\n**Behavior:**\n- Default: use `podman --runtime krun` when krun is available and `/dev/kvm` exists\n- If krun is unavailable or `/dev/kvm` missing: **error** with instructions to install `crun-krun` or set `WRAPIX_NO_MICROVM=1`\n- `WRAPIX_NO_MICROVM=1`: explicit opt-out, falls back to container boundary (for cloud VMs without KVM, or when GPU passthrough is needed)\n\n**Implementation:**\n- Add `--runtime krun` to `podman run` in `lib/sandbox/linux/default.nix` (around line 188-214 where the podman command is assembled)\n- Detect krun availability and `/dev/kvm` before launching\n- Existing OCI image from `image.nix` works unchanged\n- Document known krun limitations: ~100MB memory overhead, `podman exec` does not enter VM, env var passthrough quirks\n\n**Boundary parity table:**\n| Aspect | Linux (krun) | macOS (Apple Vz) |\n|--------|-------------|-------------------|\n| Hypervisor | KVM | Hypervisor.framework |\n| VMM | libkrun (Rust, minimal) | Apple container CLI |\n| Networking | pasta (userspace) | vmnet (Apple managed) |\n| FS sharing | virtio-fs (libkrun) | VirtioFS (Apple) |\n| Boundary class | **microVM** | **microVM** |\n\n**Files:** lib/sandbox/linux/default.nix, specs/security-review.md (update boundary section)","status":"closed","priority":2,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-02-08T01:35:57Z","created_by":"wrapix","updated_at":"2026-02-08T09:44:54Z","closed_at":"2026-02-08T09:44:54Z","labels":["profile:base","spec-security-review"],"dependencies":[{"issue_id":"wx-s9rv.3","depends_on_id":"wx-s9rv","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-s9rv.4","title":"Add WRAPIX_NETWORK environment variable with full/allow modes","description":"Add `WRAPIX_NETWORK` environment variable with two modes:\n\n- `WRAPIX_NETWORK=full` — unrestricted outbound (current behavior, remains default)\n- `WRAPIX_NETWORK=allow` — outbound limited to profile allowlist + base allowlist\n\n**Base allowlist** (always included in `allow` mode):\n- `api.anthropic.com` — Claude API\n- `github.com` / `ssh.github.com` — git operations\n- `cache.nixos.org` — Nix binary cache\n\n**Profile allowlist** — each profile adds its package registries:\n- Rust: `crates.io`, `static.crates.io`, `index.crates.io`\n- Python: `pypi.org`, `files.pythonhosted.org`\n- (other profiles define their own)\n\n**Implementation:**\n- Add `networkAllowlist` field to the profile schema in `lib/sandbox/profiles.nix` (alongside existing `packages`, `mounts`, `env`)\n- In `lib/sandbox/linux/default.nix`: when `WRAPIX_NETWORK=allow`, configure network filtering (likely via pasta options or iptables in entrypoint)\n- In `lib/sandbox/darwin/default.nix`: equivalent network restriction for macOS\n- Potentially add network filtering tools to the image (`lib/sandbox/image.nix`)\n\nOpen network is documented as a conscious tradeoff: agent autonomy requires broad network access. The `allow` mode is for users who want tighter policy at the cost of manual allowlist management.\n\n**Files:** lib/sandbox/profiles.nix, lib/sandbox/linux/default.nix, lib/sandbox/darwin/default.nix, lib/sandbox/image.nix (potentially), specs/security-review.md","status":"closed","priority":2,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-02-08T01:35:57Z","created_by":"wrapix","updated_at":"2026-02-08T09:53:44Z","closed_at":"2026-02-08T09:53:44Z","labels":["profile:base","spec-security-review"],"dependencies":[{"issue_id":"wx-s9rv.4","depends_on_id":"wx-s9rv","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-s9rv.5","title":"Add PID limit to sandbox containers","description":"Add `--pids-limit` to Podman (and equivalent for macOS container CLI) to prevent fork bombs. Use a reasonable default (e.g. 4096).\n\n**Implementation:**\n- Linux: Add `--pids-limit 4096` to the podman run command in `lib/sandbox/linux/default.nix` (after line 192, near other resource limits like --cpus and --memory)\n- Darwin: Add equivalent PID limit flag to the container run command in `lib/sandbox/darwin/default.nix` (after line 301)\n\n**Document as NOT enforced (in specs/security-review.md):**\n- **Disk**: `/workspace` is a host bind mount; capping it requires host-side filesystem quotas, which is outside wrapix's scope\n- **Timeout**: interactive sessions have the user present; ralph handles timeouts for orchestrated runs\n\n**Files:** lib/sandbox/linux/default.nix, lib/sandbox/darwin/default.nix, specs/security-review.md","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T01:35:57Z","created_by":"wrapix","updated_at":"2026-02-08T09:56:48Z","closed_at":"2026-02-08T09:56:48Z","labels":["profile:base","spec-security-review"],"dependencies":[{"issue_id":"wx-s9rv.5","depends_on_id":"wx-s9rv","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-s9rv.6","title":"Move .ralph/ under .wrapix/ralph/","description":"Ralph's working directory (`.ralph/`) should live under `.wrapix/ralph/` to consolidate all wrapix state under a single top-level directory. Session logs (`.wrapix/log/`) and ralph state (`.wrapix/ralph/`) are siblings.\n\n**Files to update (all references to `.ralph/`):**\n- `lib/ralph/cmd/util.sh` — lines 225-226, 581: template resolution and state file paths\n- `lib/ralph/cmd/sync.sh` — lines 6-7, 32-41, 149-150: template creation and backup logic\n- `lib/ralph/cmd/check.sh` — lines 225-226: state file path references\n- `lib/ralph/template/default.nix` — line 90: template variable for state path\n- `specs/ralph-workflow.md` — lines 172-429: user-facing documentation\n- `specs/ralph-tests.md` — line 128: test documentation\n- `tests/ralph/lib/fixtures.sh` — lines 27-116: test fixtures creating .ralph/ dirs\n- `tests/ralph/run-tests.sh` — line 2213: template setup references\n- `.gitignore` — line 4: update ignore pattern\n\n**Approach:**\n- Search for all occurrences of `.ralph/` and `.ralph` in the codebase\n- Replace with `.wrapix/ralph/` systematically\n- Update .gitignore to ignore `.wrapix/` instead of `.ralph/`\n- Ensure backwards compatibility: if old `.ralph/` exists, migration note or auto-move","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T01:35:57Z","created_by":"wrapix","updated_at":"2026-02-08T10:15:36Z","closed_at":"2026-02-08T10:15:36Z","labels":["profile:base","spec-security-review"],"dependencies":[{"issue_id":"wx-s9rv.6","depends_on_id":"wx-s9rv","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-s9rv.7","title":"Add session transcript audit trail to .wrapix/log/","description":"Persist a structured session summary to `.wrapix/log/` after each wrapix session (both interactive and ralph-orchestrated).\n\nEach record captures:\n- Session timestamp and duration\n- Which beads issue was being worked on (if any)\n- Files read/written\n- Commands executed\n- Network-accessing tool calls\n- Link to full `.claude/` session data\n\n**Rationale**: The agent's own session transcript is a richer audit trail than OS-level logging (strace, process tree) because it includes intent and reasoning, not just syscalls. For the primary threat (policy leakage from misbehaving agent / prompt injection), the session transcript is sufficient. OS-level audit would only matter for an adversarial-agent threat model.\n\nRalph-orchestrated sessions additionally link the log entry to the bead ID for traceability.\n\n**Implementation:**\n- Add session logging logic to entrypoint scripts (both `lib/sandbox/linux/entrypoint.sh` and `lib/sandbox/darwin/entrypoint.sh`) — likely an EXIT trap that writes a summary\n- Create the `.wrapix/log/` directory structure\n- Define the log entry format (JSON recommended for structured querying)\n- Ensure ralph-orchestrated sessions include the bead ID in the log entry\n\n**Files:** lib/sandbox/linux/entrypoint.sh, lib/sandbox/darwin/entrypoint.sh, specs/security-review.md","status":"closed","priority":2,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-02-08T01:35:57Z","created_by":"wrapix","updated_at":"2026-02-08T10:23:33Z","closed_at":"2026-02-08T10:23:33Z","labels":["profile:base","spec-security-review"],"dependencies":[{"issue_id":"wx-s9rv.7","depends_on_id":"wx-s9rv","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-scc","title":"Add git author env var passthrough to Darwin launcher","description":"Modify lib/sandbox/darwin/default.nix to read host's git config and pass as env vars.\n\nAdd before container launch:\n```bash\nGIT_AUTHOR_NAME=\"${GIT_AUTHOR_NAME:-$(git config --global user.name 2\u003e/dev/null || echo 'Wrapix Sandbox')}\"\nGIT_AUTHOR_EMAIL=\"${GIT_AUTHOR_EMAIL:-$(git config --global user.email 2\u003e/dev/null || echo 'sandbox@wrapix.dev')}\"\nGIT_COMMITTER_NAME=\"${GIT_COMMITTER_NAME:-$GIT_AUTHOR_NAME}\"\nGIT_COMMITTER_EMAIL=\"${GIT_COMMITTER_EMAIL:-$GIT_AUTHOR_EMAIL}\"\n```\n\nThen add to ENV_ARGS:\n```bash\nENV_ARGS=\"$ENV_ARGS -e GIT_AUTHOR_NAME=$GIT_AUTHOR_NAME\"\nENV_ARGS=\"$ENV_ARGS -e GIT_AUTHOR_EMAIL=$GIT_AUTHOR_EMAIL\"\nENV_ARGS=\"$ENV_ARGS -e GIT_COMMITTER_NAME=$GIT_COMMITTER_NAME\"\nENV_ARGS=\"$ENV_ARGS -e GIT_COMMITTER_EMAIL=$GIT_COMMITTER_EMAIL\"\n```\n\nAlso pass through WRAPIX_GIT_SIGN if set:\n```bash\n[ -n \"${WRAPIX_GIT_SIGN:-}\" ] \u0026\u0026 ENV_ARGS=\"$ENV_ARGS -e WRAPIX_GIT_SIGN=$WRAPIX_GIT_SIGN\"\n```\n\nFile: lib/sandbox/darwin/default.nix","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-18T18:00:07Z","created_by":"unknown","updated_at":"2026-01-18T18:47:26Z","closed_at":"2026-01-18T18:03:45Z","work_type":"mutex"}
{"id":"wx-syy","title":"Review network controls","description":"PRIORITY FOCUS: Review pasta configuration and network namespace settings.\n\nFocus areas:\n- Ingress: What ports are exposed? Authentication required?\n- Egress: Can sandbox reach arbitrary internet hosts?\n- DNS: Can sandbox resolve arbitrary domains?\n- pasta configuration: Are network namespace settings secure?\n- Firewall rules: Are they applied correctly on both platforms?\n\nNote: Architecture states 'Open network - Full internet access' by design, but verify this is intentional and documented.\n\nDocument findings with severity ratings.","status":"closed","priority":1,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:21Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:40:18Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-t2w","title":"Review profiles and permissions","description":"Review lib/sandbox/profiles.nix for permission inheritance and package risks.\n\nFocus areas:\n- File permission defaults in containers\n- Permission inheritance between profiles\n- Package security risks in pre-configured profiles\n- Host filesystem access via mounts\n\nDocument findings with severity ratings.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:22Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:53:31Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-t4w","title":"Update ready.sh to create molecules and store ID","description":"Modify lib/ralph/cmd/ready.sh to:\n1. After creating epic, capture its ID as molecule root\n2. Write molecule ID to state/current.json under 'molecule' key\n3. In update mode, find existing molecule from current.json and pass to template for bonding new tasks\n4. Use bd mol commands instead of raw bd create for molecule management\n\nKey changes:\n- Add molecule ID capture after epic creation (parse bd create output)\n- Update current.json structure: {label, molecule, update}\n- Pass MOLECULE_ID to template substitution\n- Handle update mode: read existing molecule, bond new tasks","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:30Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:53:44Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-t5b","title":"Create test scenario format infrastructure","description":"Define scenario file format in tests/ralph/scenarios/. Each scenario is a bash file with phase functions: phase_plan(), phase_ready(), phase_step(). Functions create expected artifacts and echo exit signals (RALPH_COMPLETE, RALPH_BLOCKED).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:45Z","created_by":"unknown","updated_at":"2026-01-26T16:09:20Z","closed_at":"2026-01-26T15:37:53Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-t61","title":"Review sandbox isolation","description":"Review lib/sandbox/default.nix and platform-specific implementations (linux/, darwin/) for container escape vectors.\n\nFocus areas:\n- Container capability restrictions (CAP_SYS_ADMIN, etc.)\n- Seccomp profile completeness\n- Mount namespace isolation\n- /proc and /sys exposure\n- Device access controls\n- User namespace mapping\n- Rootless container configuration\n\nDocument findings with severity ratings (Critical/High/Medium/Low/Info).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:19Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:53:29Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-t6rh","title":"Pre-commit hooks and ralph loop integration","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-01-30T18:30:08Z","created_by":"unknown","updated_at":"2026-01-30T19:43:35Z","closed_at":"2026-01-30T19:43:13Z","labels":["spec-pre-commit"],"work_type":"mutex"}
{"id":"wx-t6z","title":"[Low] Deploy key directory mounted with all keys visible","description":"On Darwin, the entire ~/.ssh/deploy_keys directory is mounted into the container.\n\n**File:** lib/sandbox/darwin/default.nix:191\n\n**Risk:** A sandbox for project A can see deploy keys for projects B, C, etc. if they exist in the shared directory. The container cannot USE other keys (SSH config specifies the correct key), but the keys are readable.\n\n**Linux behavior:** Only the specific key file is mounted (lib/sandbox/linux/default.nix:121), which is more restrictive.\n\n**Remediation options:**\n1. On Darwin, stage only the specific key file to a temp location before mounting\n2. Accept current behavior as low risk (sandbox would need to know where to push)\n3. Document the behavior difference between platforms","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:30Z","created_by":"unknown","updated_at":"2026-01-26T21:18:42Z","closed_at":"2026-01-26T21:18:42Z","labels":["low","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-tme0","title":"Test Task B","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:32:53Z","created_by":"unknown","updated_at":"2026-01-26T23:35:57Z","closed_at":"2026-01-26T23:35:57Z","labels":["test-mol"],"dependencies":[{"issue_id":"wx-tme0","depends_on_id":"wx-5qzy","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"},{"issue_id":"wx-tme0","depends_on_id":"wx-6usw","type":"blocks","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu","title":"Fix spec test failures","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-08T18:10:01Z","created_by":"wrapix","updated_at":"2026-02-08T19:01:58Z","closed_at":"2026-02-08T19:01:58Z","labels":["spec-spec-tests"],"work_type":"mutex"}
{"id":"wx-tvwu.1","title":"Fix live-specs.md: add 6 missing judge functions","description":"Add 6 missing judge test functions to tests/judges/live-specs.sh. Each function needs judge_files pointing to lib/ralph/cmd/spec.sh and an appropriate judge_criterion string.\n\nFailures to fix:\n1. test_spec_verify_all_specs — criterion: ralph spec --verify runs across all spec files\n2. test_spec_judge_all_specs — criterion: ralph spec --judge runs across all spec files\n3. test_spec_all_all_specs — criterion: ralph spec --all runs both across all spec files\n4. test_spec_filter_single — criterion: ralph spec --verify --spec notifications filters to single spec\n5. test_spec_grouped_output — criterion: Multi-spec output groups results by spec with per-spec headers\n6. test_spec_summary_line — criterion: Multi-spec output ends with summary line\n\nPattern-match existing functions in the file. Each function should set judge_files and judge_criterion, following the convention of other functions in the file.\n\nFiles to modify: tests/judges/live-specs.sh\nVerification: ralph spec --verify --spec live-specs and ralph spec --judge --spec live-specs should show these 6 as PASS","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:10Z","created_by":"wrapix","updated_at":"2026-02-08T18:18:31Z","closed_at":"2026-02-08T18:18:31Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.1","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu.2","title":"Fix beads.md: correct judge_files target for bd sync test","description":"Fix the judge_files target in tests/judges/beads.sh::test_sync_in_container. Currently it points to lib/ralph/cmd/sync.sh (ralph template sync), but the criterion is about bd sync working in the container environment. Change judge_files to point to actual beads sync-related code — likely the entrypoint script or container mount config that enables bd sync (e.g., the container setup that mounts .beads/ directory).\n\nInvestigate what files are responsible for making bd sync available inside the container and point judge_files there.\n\nFiles to modify: tests/judges/beads.sh\nVerification: ralph spec --judge --spec beads should show the bd sync criterion as PASS","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:10Z","created_by":"wrapix","updated_at":"2026-02-08T18:20:55Z","closed_at":"2026-02-08T18:20:55Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.2","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu.3","title":"Fix linux-builder.md: update nix-darwin criterion to not-yet-implemented","description":"The linux-builder.md spec has a judge criterion for 'nix-darwin config enables permanent setup' but this feature is not implemented and is out of scope. Update the judge test in tests/judges/linux-builder.sh to reflect that this is not yet implemented. Also update the spec annotation in specs/linux-builder.md if needed.\n\nDo NOT implement the nix-darwin feature. Just update the criterion/annotation so the test either passes with a 'not yet implemented' status or is properly marked as excluded.\n\nFiles to modify: tests/judges/linux-builder.sh, possibly specs/linux-builder.md\nVerification: ralph spec --judge --spec linux-builder should not show this as a FAIL","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:10Z","created_by":"wrapix","updated_at":"2026-02-08T18:23:25Z","closed_at":"2026-02-08T18:23:25Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.3","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu.4","title":"Fix image-builder.md: Claude Code judge + HTTPS verify on Linux","description":"Two failures in image-builder.md:\n\n1. Claude Code starts correctly (judge): The judge says Claude Code binary is not in the image contents list. image.nix receives entrypointPkg which IS claude-code. Fix the judge test in tests/judges/image-builder.sh to look at the right files/mechanism (entrypointPkg parameter rather than contents list), OR fix the image if Claude Code is truly missing from contents.\n\n2. HTTPS connections succeed / CA certs present (verify): tests/darwin/network-test.sh exits 126 on Linux because the script is darwin-specific. Add platform detection at the top of the script: if on Linux, skip with a clear message (exit 0 with skip notice). Alternatively, create a cross-platform cert verification test. The exit 126 means the spec runner is executing the shell script directly outside the nix wrapper.\n\nFiles to modify: tests/judges/image-builder.sh, tests/darwin/network-test.sh\nVerification: ralph spec --spec image-builder should show both criteria as PASS","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:10Z","created_by":"wrapix","updated_at":"2026-02-08T18:27:02Z","closed_at":"2026-02-08T18:27:02Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.4","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu.5","title":"Fix sandbox.md: add Linux platform skips for 5 darwin-only tests","description":"5 sandbox.md verify tests fail on Linux with exit 126 because they point to darwin-specific test scripts. All tests are in tests/darwin/ and exit 126 because the spec runner executes them directly.\n\nFailures:\n1. Container starts on both Linux and macOS — tests/darwin/uid-test.sh exits 126\n2. Files created in /workspace have correct host ownership — same test file\n3. Claude Code can access internet for research — tests/darwin/network-test.sh exits 126\n4. Host filesystem outside /workspace is inaccessible — tests/darwin/mount-test.sh exits 126\n5. Custom mounts and environment variables work — same test file (mount-test.sh)\n\nFix: Add platform detection to each darwin test script. At the top of each script, check if running on Linux (uname -s). If Linux, print a skip message and exit 0. The scripts need #!/usr/bin/env bash and the platform check before any darwin-specific logic.\n\nNote: network-test.sh is shared with image-builder.md task — coordinate or just add the platform skip which fixes both.\n\nFiles to modify: tests/darwin/uid-test.sh, tests/darwin/network-test.sh, tests/darwin/mount-test.sh\nVerification: ralph spec --verify --spec sandbox should show all 5 as PASS (skipped on Linux)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:10Z","created_by":"wrapix","updated_at":"2026-02-08T18:29:44Z","closed_at":"2026-02-08T18:29:44Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.5","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu.6","title":"Fix pre-commit.md: fix test_default_config_has_hooks post-loop expectation","description":"2 pre-commit.md failures, both from the same root cause in tests/ralph/run-tests.sh::test_default_config_has_hooks.\n\nThe test expects post-loop to contain 'git commit' but the template config.nix has 'git diff --quiet' instead. The spec says 'land the plane' which includes committing, so the template should probably include the git commit in post-loop.\n\nOptions (pick the right one after investigation):\nA) Update lib/ralph/template/config.nix to include 'git commit' in the post-loop hook (preferred if spec intent is to commit)\nB) Update the test expectation to match actual template behavior\n\nInvestigate the spec intent in specs/pre-commit.md and the template in lib/ralph/template/config.nix before deciding.\n\nFix resolves both failures since they share the same root cause.\n\nFiles to modify: lib/ralph/template/config.nix OR tests/ralph/run-tests.sh\nVerification: ralph spec --verify --spec pre-commit should show both criteria as PASS","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:10Z","created_by":"wrapix","updated_at":"2026-02-08T18:32:19Z","closed_at":"2026-02-08T18:32:19Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.6","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu.7","title":"Fix profiles.md: Rust profile judge + composition verify test","description":"2 failures in profiles.md:\n\n1. Rust profile can compile and run Rust projects (judge): The profile uses rustup without bundled rustc/cargo. The judge criterion says the profile should enable compilation out of the box. Options:\n   A) Add rustc and cargo as direct nix packages in lib/sandbox/profiles.nix alongside rustup\n   B) Add a rustup-init step in the image build that installs a default toolchain\n   C) Update the judge criterion to reflect that rustup toolchain install is required first\n   Investigate lib/sandbox/profiles.nix to understand the Rust profile structure and choose the best fix.\n\n2. Profiles are composable / can extend extended profiles (verify): tests/tmux-mcp/e2e/test_profile_composition.sh exits 1. This test is shared with tmux-mcp.md — debug and fix the composition test or the underlying profile composition implementation. The fix here resolves the tmux-mcp.md 'MCP integration' failure too.\n\nFiles to modify: lib/sandbox/profiles.nix OR tests/judges/profiles.sh, tests/tmux-mcp/e2e/test_profile_composition.sh\nVerification: ralph spec --spec profiles should show both criteria as PASS","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:11Z","created_by":"wrapix","updated_at":"2026-02-08T18:45:36Z","closed_at":"2026-02-08T18:45:36Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.7","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-tvwu.8","title":"Fix tmux-mcp.md: fix 9 test failures (verify + judge)","description":"9 failures in tmux-mcp.md. Most are verify tests that exit 1, likely due to missing tmux-debug-mcp binary or test environment setup issues.\n\nFailures:\n1. Pane lifecycle works (verify) — tests/tmux-mcp/test_create_pane.sh exits 1\n2. I/O works (verify) — tests/tmux-mcp/test_send_keys.sh exits 1\n3. Exited pane visibility (verify) — tests/tmux-mcp/test_exited_pane.sh exits 1\n4. Context isolation (judge) — No config showing MCP tools are isolated to debug subagent. Fix tests/judges/tmux-mcp.sh to include relevant config files in judge_files\n5. Sandbox contained (verify) — tests/tmux-mcp/e2e/test_filesystem_isolation.sh exits 1\n6. Audit works (verify) — tests/tmux-mcp/test_audit_log.sh exits 1\n7. Cleanup works (verify) — tests/tmux-mcp/test_cleanup_on_exit.sh exits 1\n8. MCP integration (verify) — tests/tmux-mcp/e2e/test_profile_composition.sh exits 1 (shared with profiles.md — may already be fixed by profiles task)\n9. Tests pass: all unit/integration/e2e (verify) — tests/tmux-mcp/run-integration.sh exits 2 (meta-test, passes when individual tests pass)\n\nInvestigation steps:\n- Check if tmux-debug-mcp binary needs to be built/available\n- Check test setup scripts for missing dependencies\n- Debug each failing test individually\n- For the judge failure (#4), update judge_files to include MCP tool isolation config\n\nFiles to modify: tests/tmux-mcp/test_create_pane.sh, test_send_keys.sh, test_exited_pane.sh, test_audit_log.sh, test_cleanup_on_exit.sh, e2e/test_filesystem_isolation.sh, run-integration.sh, tests/judges/tmux-mcp.sh\nVerification: ralph spec --spec tmux-mcp should show all 9 criteria as PASS","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T18:11:11Z","created_by":"wrapix","updated_at":"2026-02-08T19:01:57Z","closed_at":"2026-02-08T19:01:57Z","labels":["profile:base","spec-spec-tests"],"dependencies":[{"issue_id":"wx-tvwu.8","depends_on_id":"wx-tvwu","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-u3b","title":"Restrict Nix store permissions in container image","description":"Finding: lib/sandbox/image.nix:104 sets /nix/store to world-writable (chmod -R a+rwX).\n\nRisk: Compromised processes could tamper with installed packages, undermining Nix immutability.\n\nRemediation options:\n1. Use a+rX instead of a+rwX if write not needed\n2. Implement per-user Nix profiles\n3. Document as accepted risk if write access is required for in-container package management\n\nSeverity: Medium","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:43:16Z","created_by":"unknown","updated_at":"2026-01-26T20:58:46Z","closed_at":"2026-01-26T20:58:46Z","labels":["rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-ufo","title":"[Info] Hardcoded GitHub SSH host keys","description":"GitHub SSH public keys are hardcoded in lib/sandbox/known-hosts.nix.\n\n**File:** lib/sandbox/known-hosts.nix:5-9\n\n**Risk:** If GitHub rotates their SSH keys, the hardcoded keys will be stale. Users would need to update wrapix to get new keys.\n\n**Mitigation:**\n- GitHub rarely rotates keys\n- Nix derivation can be updated when keys change\n- This is a conscious security tradeoff vs. TOFU (Trust On First Use)\n\n**Note:** Hardcoding known hosts is actually a security IMPROVEMENT over TOFU - it prevents MITM attacks on first connection. The keys should be verified against https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/githubs-ssh-key-fingerprints","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:29Z","created_by":"unknown","updated_at":"2026-01-26T21:45:58Z","closed_at":"2026-01-26T21:43:28Z","labels":["info","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-ukra","title":"MCP opt-in refactor","description":"Refactor MCP server integration from profile-based to opt-in at sandbox creation time. Eliminates profile proliferation and makes it easy for consumers to add MCP servers to their existing profiles.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-01T20:40:43Z","created_by":"unknown","updated_at":"2026-02-01T21:58:50Z","closed_at":"2026-02-01T21:58:49Z","labels":["spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-ukra.1","title":"Remove debug profiles from profiles.nix","description":"Remove the debug and rust-debug profile definitions from lib/sandbox/profiles.nix. Also remove the mkAuditedDebug export if present.\n\nFiles to modify:\n- lib/sandbox/profiles.nix\n\nChanges:\n- Delete the 'debug' profile definition\n- Delete the 'rust-debug' profile definition\n- Remove 'mkAuditedDebug' export\n\nThis is the first step in the refactor - profiles will no longer contain MCP server configuration. Instead, MCP servers will be opt-in at sandbox creation time.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:40:59Z","created_by":"unknown","updated_at":"2026-02-01T21:16:12Z","closed_at":"2026-02-01T21:16:10Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.1","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ukra.2","title":"Create MCP registry in lib/mcp/default.nix","description":"Create a new MCP registry module that maps server names to their definitions.\n\nFiles to create/modify:\n- lib/mcp/default.nix (create new)\n\nThe registry should:\n- Export an attrset mapping server names to their definitions\n- Each server definition exports: { name, package, mkServerConfig }\n- Initially contain only tmux-debug server\n\nExample structure:\n```nix\n{ pkgs }:\n{\n  tmux-debug = import ./tmux { inherit pkgs; };\n}\n```\n\nThis registry will be used by mkSandbox to look up enabled MCP servers and merge their packages and configs.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:40:59Z","created_by":"unknown","updated_at":"2026-02-01T21:21:37Z","closed_at":"2026-02-01T21:21:08Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.2","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ukra.3","title":"Delete lib/mcp/tmux/profile.nix","description":"Delete the profile.nix file from lib/mcp/tmux/ as it's no longer needed.\n\nFiles to delete:\n- lib/mcp/tmux/profile.nix\n\nThis file contained the profile-based MCP configuration which is being replaced by the opt-in mechanism. The package and server config functionality moves to lib/mcp/tmux/default.nix.\n\nEnsure no other files reference this deleted file before removing.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:41:11Z","created_by":"unknown","updated_at":"2026-02-01T21:27:08Z","closed_at":"2026-02-01T21:27:05Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.3","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ukra.4","title":"Remove wrapix-debug flake exports","description":"Remove the debug-related sandbox exports from flake.nix.\n\nFiles to modify:\n- flake.nix\n\nChanges:\n- Remove 'wrapix-debug' from packages\n- Remove 'wrapix-rust-debug' from packages\n- Remove any related overlays or exports\n\nThese packages are being removed because debugging will be enabled via the opt-in MCP mechanism at sandbox creation time, not via dedicated profiles.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:41:11Z","created_by":"unknown","updated_at":"2026-02-01T21:29:03Z","closed_at":"2026-02-01T21:29:01Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.4","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ukra.5","title":"Update tmux-debug server definition","description":"Refactor lib/mcp/tmux/default.nix to export a server definition for the MCP registry.\n\nFiles to modify:\n- lib/mcp/tmux/default.nix\n\nThe new export format should be:\n```nix\n{ pkgs }:\n{\n  name = \"tmux-debug\";\n  package = import ./mcp-server.nix { inherit pkgs; };\n  mkServerConfig = { audit ? null, auditFull ? null }: {\n    command = \"tmux-debug-mcp\";\n    env = lib.optionalAttrs (audit != null) {\n      TMUX_DEBUG_AUDIT = audit;\n    } // lib.optionalAttrs (auditFull != null) {\n      TMUX_DEBUG_AUDIT_FULL = auditFull;\n    };\n  };\n}\n```\n\nConfig schema:\n- audit: optional path to audit log file\n- auditFull: optional path to directory for full capture logging\n\nThe mkServerConfig function generates MCP server config with appropriate env vars based on options.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:41:11Z","created_by":"unknown","updated_at":"2026-02-01T21:32:32Z","closed_at":"2026-02-01T21:32:30Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.5","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ukra.6","title":"Extend mkSandbox to accept MCP configuration","description":"Modify lib/sandbox/default.nix to add an mcp parameter to mkSandbox.\n\nFiles to modify:\n- lib/sandbox/default.nix\n\nAdd a new 'mcp' parameter that accepts an attrset of MCP server configurations:\n```nix\nmkSandbox {\n  profile = profiles.rust;\n  mcp = {\n    tmux-debug = { };  # enable with defaults\n  };\n}\n\n# With auditing:\nmkSandbox {\n  profile = profiles.rust;\n  mcp = {\n    tmux-debug = { audit = \"/workspace/.debug-audit.log\"; };\n  };\n}\n```\n\nImplementation:\n1. Accept 'mcp' as an optional attrset parameter (default: {})\n2. Import the MCP registry from lib/mcp/default.nix\n3. For each enabled server in mcp:\n   - Look up the server definition in the registry\n   - Add server package to sandbox packages\n   - Call mkServerConfig with the user's config\n   - Merge server config into MCP configuration\n4. Merge all MCP packages and configs with the profile's packages and configs","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:41:26Z","created_by":"unknown","updated_at":"2026-02-01T21:39:39Z","closed_at":"2026-02-01T21:39:37Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.6","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ukra.7","title":"Update tests for MCP opt-in mechanism","description":"Update existing tests to use the new MCP opt-in mechanism instead of debug profiles.\n\nFiles to modify:\n- tests/tmux-mcp/e2e/test_sandbox_debug_profile.sh - Update to use mkSandbox with mcp parameter\n- tests/tmux-mcp/e2e/test_profile_composition.sh - Update to test mcp opt-in with rust profile\n- Any other tests referencing debug/rust-debug profiles\n\nChanges:\n1. Replace references to debug profile with mcp = { tmux-debug = {}; }\n2. Replace references to rust-debug profile with profile = rust; mcp = { tmux-debug = {}; }\n3. Add tests for audit configuration: mcp = { tmux-debug = { audit = \"/path\"; }; }\n4. Verify all existing test assertions still pass\n\nEnsure nix flake check passes after updates.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:41:27Z","created_by":"unknown","updated_at":"2026-02-01T21:52:38Z","closed_at":"2026-02-01T21:52:36Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.7","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ukra.8","title":"Update spec documentation for MCP opt-in","description":"Update specs/tmux-mcp.md to reflect the new MCP opt-in mechanism.\n\nFiles to modify:\n- specs/tmux-mcp.md\n\nChanges:\n1. Remove the 'Debug Profile' section showing profile definitions\n2. Update 'Client Configuration' section to show new mkSandbox pattern:\n   ```nix\n   mkSandbox {\n     profile = profiles.rust;\n     mcp = {\n       tmux-debug = { };  # enable with defaults\n     };\n   }\n\n   # With auditing:\n   mkSandbox {\n     profile = profiles.rust;\n     mcp = {\n       tmux-debug = { audit = \"/workspace/.debug-audit.log\"; };\n     };\n   }\n   ```\n3. Update 'Integration' section module locations to reflect new structure\n4. Update 'Example Flow' if it references debug profiles\n5. Update any other examples throughout to use new opt-in mechanism\n\nEnsure documentation accurately reflects the implemented behavior.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:41:27Z","created_by":"unknown","updated_at":"2026-02-01T21:58:41Z","closed_at":"2026-02-01T21:58:39Z","labels":["profile:base","spec-tmux-mcp"],"dependencies":[{"issue_id":"wx-ukra.8","depends_on_id":"wx-ukra","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-umy","title":"Create mock claude executable","description":"Create tests/ralph/mock-claude script that: receives prompts via command-line, reads MOCK_SCENARIO env var for scenario file, matches phase from prompt patterns, executes side effects (creates files, runs bd commands), outputs responses with exit signals. Phase detection from prompt content (e.g. 'spec interview' → plan phase).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:44Z","created_by":"unknown","updated_at":"2026-01-26T16:09:20Z","closed_at":"2026-01-26T15:50:03Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-usn4","title":"Update step.md template with quality gates section","description":"Update lib/ralph/template/step.md to reference hook enforcement:\n\nAdd section:\n```markdown\n## Quality Gates\nBefore outputting RALPH_COMPLETE:\n- [ ] Tests written and passing\n- [ ] Lint checks pass\n- [ ] Changes staged (\\`git add\\`)\n\nPost-step hooks verify compliance automatically.\n```\n\nThis reminds LLMs to ensure quality before completion, with hooks as backstop.\n\nAffected file: lib/ralph/template/step.md","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T18:30:55Z","created_by":"unknown","updated_at":"2026-01-30T19:43:35Z","closed_at":"2026-01-30T19:43:13Z","labels":["spec-pre-commit"],"dependencies":[{"issue_id":"wx-usn4","depends_on_id":"wx-t6rh","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-uzi","title":"Add proper error handling to Swift runner","description":"SandboxRunner.swift silently skips invalid mounts with `continue`. Should log warnings or errors for:\n- Invalid mount format (missing `:`)\n- Non-existent source paths (for non-optional mounts)\n- Permission errors\n\nLocation: lib/sandbox/darwin/swift/Sources/wrapix-runner/SandboxRunner.swift lines 145-157","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T11:51:00Z","created_by":"shaun","updated_at":"2026-01-09T14:50:27Z","closed_at":"2026-01-09T14:50:27Z","work_type":"mutex"}
{"id":"wx-v65","title":"Simplify init container image","description":"Update lib/sandbox/linux/init-image.nix: remove iptables logic (now handled by hook), make minimal container that just triggers hook and exits.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T19:59:50Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:01:15Z","work_type":"mutex"}
{"id":"wx-v68i","title":"Update E2E tests for opt-in MCP mechanism","description":"Update the E2E tests in tests/tmux-mcp/e2e/ to use the new opt-in mechanism.\n\nTests to update:\n1. test_sandbox_debug_profile.sh -\u003e test_sandbox_mcp_optin.sh\n   - Change from building wrapix-debug to building sandbox with mcp parameter\n   - Verify tmux and MCP server present\n\n2. test_profile_composition.sh -\u003e test_mcp_with_rust_profile.sh\n   - Change from rust-debug profile to rust profile + mcp opt-in\n   - Verify both rust toolchain and debug tools available\n\n3. test_mcp_in_sandbox.sh\n   - Update to use mkSandbox with mcp parameter\n   - Same test logic (create pane, send keys, capture output)\n\n4. test_filesystem_isolation.sh\n   - Update to use mkSandbox with mcp parameter\n   - Same test logic (verify /workspace access only)\n\nAdd new test:\n5. test_mcp_audit_optin.sh\n   - Build sandbox with mcp = { tmux-debug = { audit = path; }; }\n   - Verify TMUX_DEBUG_AUDIT env var is set in container\n   - Run operations and verify audit log created","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T20:39:31Z","created_by":"unknown","updated_at":"2026-02-01T20:42:10Z","closed_at":"2026-02-01T20:42:10Z","labels":["profile:base","spec-tmux-mcp"],"work_type":"mutex"}
{"id":"wx-vxpj","title":"Integrate template validation with nix flake check","description":"Add ralph-templates check to flake.nix that validates templates using ralph.lib.validateTemplates. This runs as part of 'nix flake check' to catch template errors at build time. Should verify all partials exist, variables are defined, and templates render without error.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T02:11:10Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-w8bz","title":"Consolidate configuration tests","description":"Merge 8 configuration tests into 1 data-driven test:\n- test_config_spec_hidden_true/false\n- test_config_beads_priority\n- test_config_loop_max_iterations\n- test_config_loop_pause_on_failure_true/false\n- test_config_loop_hooks\n- test_config_failure_patterns\n\nUse data-driven approach with config/expected pairs in tests/ralph/default.nix.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T02:38:09Z","created_by":"unknown","updated_at":"2026-01-30T14:24:20Z","closed_at":"2026-01-30T04:05:18Z","labels":["spec-test-partials"],"work_type":"mutex"}
{"id":"wx-wr9","title":"Remove unused customPrompt feature from profile system","description":"The customPrompt parameter is defined in the profile system but never used anywhere in the codebase.\n\n**Locations:**\n- lib/sandbox/profiles.nix:77 - Accepts customPrompt parameter\n- lib/sandbox/profiles.nix:85 - Conditionally includes it in profile\n\n**Impact:** Dead code that adds complexity without providing functionality. The system prompt is hardcoded to use /etc/wrapix-prompt (Linux) or /etc/wrapix/wrapix-prompt (Darwin).\n\n**Fix:** Remove the customPrompt parameter and related code, or implement the feature if intended.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T19:50:44Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-wvj9","title":"Implement ralph tune command for template editing","description":"Create lib/ralph/cmd/tune.sh with two modes: Interactive mode (no stdin) - AI-driven interview asking what to change, analyzing templates, making edits, running ralph check. Integration mode (stdin with diff from ralph diff) - analyzes diff, interviews about each change, asks where it should go (keep, move to partial, new partial), applies changes. Should run ralph check after edits.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T02:16:35Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-wxf","title":"Document findings and create remediation beads","description":"Consolidate findings from all review tasks and create actionable beads issues.\n\nRequirements:\n- Compile all findings with severity ratings\n- Create beads issues for each Critical/High severity finding\n- Provide remediation guidance for each finding\n- Update this spec with findings summary\n\nThis task depends on all review tasks being completed.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:33:36Z","created_by":"unknown","updated_at":"2026-01-26T21:23:50Z","closed_at":"2026-01-26T20:55:15Z","labels":["rl-security-review"],"work_type":"mutex"}
{"id":"wx-x658","title":"Create discovered-work.sh test scenario","description":"Create new test scenario tests/ralph/scenarios/discovered-work.sh to verify:\n1. bd mol bond --type sequential during step works\n2. bd mol bond --type parallel during step works\n3. Sequential bonds block current task completion\n4. Parallel bonds are independent\n\nTest flow:\n1. Setup molecule with tasks\n2. Run step that discovers sequential work\n3. Verify bond created with sequential type\n4. Run step that discovers parallel work\n5. Verify bond created with parallel type","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T23:05:38Z","created_by":"unknown","updated_at":"2026-01-27T00:01:55Z","closed_at":"2026-01-26T23:59:03Z","labels":["rl-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-xcz","title":"Investigate wrapix-builder persistence options","description":"The wrapix-builder container is currently ephemeral (destroyed on stop) due to Apple Container CLI timing issues with stop/start cycles - containers get stuck in \"shuttingDown\" state.\n\nInvestigate options to restore persistence for faster subsequent sessions:\n\n1. **Volume-based persistence** - Mount a volume for `/nix/store` instead of persisting the whole container. This would preserve builds without fighting container restart mechanics.\n\n2. **Wait for Apple CLI maturity** - The container runtime is new (macOS 26). Future updates may fix the stop/start timing issues.\n\n3. **Hybrid approach** - Keep ephemeral containers but cache the Nix store on the host via a bind mount.\n\nTradeoffs documented in commit 85a540f.","status":"closed","priority":3,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-15T01:09:31Z","created_by":"Shaun Taheri","updated_at":"2026-01-15T10:30:16Z","closed_at":"2026-01-15T09:44:51Z","work_type":"mutex"}
{"id":"wx-xfa","title":"Enable Nix builds in sandbox via fuse-overlayfs","description":"## Problem\nThe Linux sandbox has a read-only /nix/store from the container image. While Nix evaluation works via chroot store fallback, builds fail.\n\n## Solution\nUse fuse-overlayfs to create a writable overlay on /nix/store:\n1. Add --device /dev/fuse to podman run command\n2. Include fuse-overlayfs in container image\n3. Mount overlay in entrypoint: lower=/nix/store, upper=tmpfs\n\n## References\n- [fuse-overlayfs](https://github.com/containers/fuse-overlayfs)\n- [Nix experimental local-overlay-store](https://nix.dev/manual/nix/2.22/store/types/experimental-local-overlay-store)\n- [Podman rootless overlay support](https://www.redhat.com/en/blog/podman-rootless-overlay)\n\n## Constraints\n- Must work rootless (--userns=keep-id)\n- No elevated capabilities\n- Container isolation remains the security boundary","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T15:17:20Z","created_by":"shaun","updated_at":"2026-01-10T15:21:23Z","closed_at":"2026-01-10T15:21:23Z","work_type":"mutex"}
{"id":"wx-y45","title":"Clean up smoke tests","description":"Remove blocklist and squid-config tests from smoke.nix","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T20:29:03Z","created_by":"shaun","updated_at":"2026-01-07T12:57:43Z","closed_at":"2026-01-06T20:31:46Z","work_type":"mutex"}
{"id":"wx-y5xm","title":"Add integration tests for multi-spec verify/judge and short flags","description":"Add integration tests for the new multi-spec and short flag features: (1) ralph spec --verify with no --spec runs across all specs (2) ralph spec --judge with no --spec runs across all specs (3) ralph spec --all with no --spec runs both (4) --spec \u003cname\u003e filters to single spec (5) -v = --verify (6) -j = --judge (7) -a = --all (8) -s = --spec (9) -v no longer maps to --verbose (10) -vj composes to --all (11) grouped output has per-spec headers and summary (12) non-zero exit on failure (13) specs with no criteria silently skipped. Affected files: tests/ralph/run-tests.sh, possibly new test fixtures.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-08T17:24:07Z","created_by":"wrapix","updated_at":"2026-02-08T17:45:30Z","closed_at":"2026-02-08T17:45:30Z","labels":["profile:base","spec-live-specs"],"work_type":"mutex"}
{"id":"wx-yjs","title":"Extract shared shell functions to sourced library","description":"Both entrypoint scripts and sandbox launchers duplicate: expand_path() shell function, stale staging directory cleanup logic, and deploy key path generation. Create lib/sandbox/shell-lib.sh with shared functions that can be sourced by both platforms.","status":"closed","priority":2,"issue_type":"task","owner":"sandbox@wrapix.dev","created_at":"2026-01-12T18:24:09Z","created_by":"unknown","updated_at":"2026-01-12T19:12:54Z","closed_at":"2026-01-12T18:49:38Z","work_type":"mutex"}
{"id":"wx-yw1","title":"Fix JSON injection in notification client","description":"The notification client in lib/notify/client.nix uses printf with %s for JSON construction. If title/message contains quotes, backslashes, or newlines, JSON becomes malformed. Fix by using jq for safe JSON construction instead of printf.","status":"closed","priority":1,"issue_type":"bug","owner":"sandbox@wrapix.dev","created_at":"2026-01-12T18:23:39Z","created_by":"unknown","updated_at":"2026-01-12T19:12:54Z","closed_at":"2026-01-12T18:29:08Z","work_type":"mutex"}
{"id":"wx-z2v","title":"[Info] Builder SSH keys stored in Nix store are world-readable","description":"Builder SSH keys (including private keys) are stored in the Nix store with default permissions (typically 444).\n\n**File:** lib/builder/hostkey.nix:11-26, lib/builder/default.nix:351-355\n\n**Current mitigations:**\n- Private key is copied to /etc/nix/wrapix_builder_ed25519 with chmod 600 and chown root:nixbld\n- SSH port is bound to localhost only (127.0.0.1:2222)\n- The container accepts connections only from authorized keys\n\n**Risk:** Any user on the host can read the private key from the Nix store. However, this is mitigated by SSH port being localhost-only.\n\n**Note:** This is an inherent limitation of using Nix store for key distribution. The runtime copy with proper permissions is the standard workaround.","status":"closed","priority":4,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T20:49:17Z","created_by":"unknown","updated_at":"2026-01-26T21:45:58Z","closed_at":"2026-01-26T21:45:14Z","labels":["info","rl-security-review","security"],"work_type":"mutex"}
{"id":"wx-zay1","title":"Ralph Workflow Implementation","description":"Spec-driven AI orchestration for feature development. Implements plan/ready/step/loop commands with Nix-native template system and container isolation.","status":"closed","priority":2,"issue_type":"epic","owner":"gpg@taheris.net","created_at":"2026-02-01T15:44:53Z","created_by":"unknown","updated_at":"2026-02-01T17:08:00Z","closed_at":"2026-02-01T17:07:58Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-zay1.1","title":"Add wrapix container execution for plan/ready commands","description":"ralph plan and ralph ready must run Claude inside wrapix containers with base profile.\n\nCurrent state:\n- Scripts exist at lib/ralph/cmd/{plan,ready}.sh\n- mkRalph in lib/ralph/default.nix provides wrapix integration\n- Container execution logic needs to wrap claude calls\n\nImplementation:\n1. Detect if running in container vs host\n2. If host, spawn wrapix container with base profile\n3. Pass through env vars (RALPH_TEMPLATE_DIR, etc.)\n4. Execute claude command inside container\n\nSuccess criteria from spec:\n- ralph plan runs Claude in wrapix container with base profile\n- ralph ready runs Claude in wrapix container with base profile","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:45:10Z","created_by":"unknown","updated_at":"2026-02-01T15:52:43Z","closed_at":"2026-02-01T15:52:41Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.1","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.10","title":"Implement ralph tune AI-assisted template editing","description":"ralph tune provides AI-assisted template editing in two modes.\n\nFrom spec:\n\n**Interactive mode** (no stdin):\n```bash\nralph tune\n\u003e What would you like to change?\n\u003e 'Add guidance about handling blocked beads'\n\u003e\n\u003e Analyzing templates...\n\u003e This should go in step.md, section 'Instructions'\n\u003e\n\u003e [makes edit to .ralph/template/step.md]\n\u003e [runs ralph check]\n\u003e ✓ Template valid\n```\n\n**Integration mode** (stdin with diff):\n```bash\nralph diff | ralph tune\n\u003e Analyzing diff...\n\u003e\n\u003e Change 1/2: step.md lines 35-40\n\u003e + 6. **Blocked vs Waiting**: ...\n\u003e\n\u003e Where should this go?\n\u003e   1. Keep in step.md\n\u003e   2. Move to partial\n\u003e   3. Create new partial\n\u003e \u003e 1\n\u003e\n\u003e Accept this change? [Y/n] y\n\u003e ✓ Change applied\n```\n\nAI-driven interview that asks questions until user accepts or abandons.\n\nImplementation:\n1. Detect mode (stdin available or not)\n2. Interactive: prompt user for desired change, analyze templates, make edit\n3. Integration: parse diff, present changes one by one, apply accepted changes\n4. Run ralph check after each edit to validate\n\nSuccess criteria:\n- ralph tune (interactive) identifies correct template and makes edits\n- ralph tune (integration) ingests diff and interviews about changes","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:46:56Z","created_by":"unknown","updated_at":"2026-02-01T15:58:42Z","closed_at":"2026-02-01T15:58:40Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.10","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.11","title":"Implement ralph sync template synchronization","description":"ralph sync updates local templates from packaged versions.\n\nFrom spec:\n```bash\nralph sync           # Update local templates from packaged\nralph sync --dry-run # Preview changes without executing\n```\n\nBehavior:\n1. Creates .ralph/template/ with fresh packaged templates\n2. Moves existing customized templates to .ralph/backup/\n3. Copies all templates including variants and partial/ directory\n\nDirectory structure after sync:\n```\n.ralph/\n├── config.nix\n├── template/            # Fresh from packaged\n│   ├── partial/\n│   │   ├── context-pinning.md\n│   │   ├── exit-signals.md\n│   │   └── spec-header.md\n│   ├── plan.md\n│   ├── plan-new.md\n│   ├── plan-update.md\n│   ├── ready.md\n│   ├── ready-new.md\n│   ├── ready-update.md\n│   └── step.md\n└── backup/              # User customizations (if any)\n    └── ...\n```\n\nCurrent state: lib/ralph/cmd/sync.sh exists, needs review\n\nSuccess criteria:\n- ralph sync updates templates and backs up customizations\n- ralph sync --dry-run previews without executing","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:47:06Z","created_by":"unknown","updated_at":"2026-02-01T16:02:29Z","closed_at":"2026-02-01T16:02:25Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.11","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.12","title":"Implement ralph diff template comparison","description":"ralph diff shows local template changes vs packaged versions.\n\nFrom spec:\n```bash\nralph diff           # Show local template changes vs packaged\nralph diff step      # Show diff for specific template\n```\n\nPipe to ralph tune for integration:\n```bash\nralph diff | ralph tune\n```\n\nCurrent state: lib/ralph/cmd/diff.sh exists, needs review\n\nImplementation:\n1. Compare .ralph/template/ files with packaged templates\n2. Use diff format suitable for piping to ralph tune\n3. Support filtering to specific template names\n\nSuccess criteria:\n- ralph diff shows local template changes vs packaged","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:47:13Z","created_by":"unknown","updated_at":"2026-02-01T16:07:06Z","closed_at":"2026-02-01T16:07:04Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.12","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.13","title":"Implement ralph check template validation","description":"ralph check validates all templates and partials.\n\nFrom spec:\n```bash\nralph check\n```\n\nValidates all templates:\n- Partial files exist\n- Body files parse correctly\n- No syntax errors in Nix expressions\n- Dry-run render with dummy values to catch placeholder typos\n\nExit codes: 0 = valid, 1 = errors (with details)\n\nAlso runs as part of nix flake check.\n\nCurrent state: lib/ralph/cmd/check.sh exists, needs review\n\nSuccess criteria:\n- ralph check validates all templates and partials\n- Exit codes match spec (0 = valid, 1 = errors)","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:47:21Z","created_by":"unknown","updated_at":"2026-02-01T16:11:33Z","closed_at":"2026-02-01T16:11:30Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.13","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.2","title":"Implement profile detection in ralph ready","description":"ralph ready must analyze spec content and assign profile:X labels to tasks.\n\nProfile detection heuristics from spec:\n| Signal | Profile |\n|--------|---------|\n| .rs files, Cargo.toml, 'Rust', 'cargo' | rust |\n| .py files, pyproject.toml, 'Python', 'pytest' | python |\n| .nix files only | base |\n| Mixed or unclear | base |\n\nImplementation:\n1. Parse Affected Files table in spec\n2. Check file extensions and keywords\n3. Add --labels 'profile:X' to bd create commands\n4. Handle multi-profile specs (assign per-task)\n\nSuccess criteria:\n- ralph ready detects profile from spec and assigns profile:X labels to tasks","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:45:17Z","created_by":"unknown","updated_at":"2026-02-01T16:18:35Z","closed_at":"2026-02-01T16:18:33Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.2","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.3","title":"Implement profile-based container selection in ralph step","description":"ralph step must read profile:X label from bead and use appropriate wrapix profile.\n\nFrom spec:\n- ralph step reads profile:X label from bead and uses that profile\n- ralph step --profile=X overrides bead profile label\n- ralph step falls back to base profile when no label present\n\nImplementation:\n1. Get profile label: bd show \"$issue_id\" --json | jq -r '.labels[] | select(startswith(\"profile:\")) | split(\":\")[1]'\n2. Check --profile flag for override\n3. Default to 'base' if neither\n4. Spawn wrapix container with detected/selected profile\n\nSuccess criteria:\n- ralph step reads profile:X label from bead and uses that profile\n- ralph step --profile=X overrides bead profile label\n- ralph step falls back to base profile when no label present","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:45:26Z","created_by":"unknown","updated_at":"2026-02-01T16:26:24Z","closed_at":"2026-02-01T16:26:22Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.3","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.4","title":"Implement ralph loop host orchestration","description":"ralph loop runs on host and spawns containerized ralph step per issue.\n\nFrom spec:\n- Runs on host as orchestrator (not in container)\n- Queries for next ready issue from molecule\n- Spawns ralph step in fresh wrapix container (profile per-step)\n- Waits for step completion\n- Repeats until all issues complete\n- Handles discovered work via bd mol bond\n\nCurrent state:\n- lib/ralph/cmd/loop.sh exists but needs container spawning logic\n\nImplementation:\n1. Query bd ready --parent=$MOLECULE_ID for next issue\n2. Spawn wrapix with appropriate profile (from issue label)\n3. Run ralph step inside container\n4. Parse exit signal from step output\n5. Continue or pause based on signal\n6. Handle pre-commit integration (see pre-commit.md spec)\n\nSuccess criteria:\n- ralph loop runs on host, spawning containerized ralph step per issue","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:45:44Z","created_by":"unknown","updated_at":"2026-02-01T16:31:55Z","closed_at":"2026-02-01T16:31:53Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.4","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.5","title":"Update template content to match spec requirements","description":"Ensure all templates have required sections per spec.\n\nTemplate requirements from spec:\n\n### plan-new.md\nRequired sections:\n1. Role statement — 'You are conducting a specification interview'\n2. Planning-only warning — No code, only spec output\n3. {{\u003e context-pinning}}\n4. {{\u003e spec-header}}\n5. Interview guidelines — One question at a time, capture terminology\n6. Interview flow — Describe idea → clarify → write spec → RALPH_COMPLETE\n7. Spec file format — Title, problem, requirements, affected files, success criteria\n8. Implementation notes section — Optional transient context\n9. {{\u003e exit-signals}}\nExit signals: RALPH_COMPLETE, RALPH_BLOCKED, RALPH_CLARIFY\n\n### plan-update.md\nRequired sections:\n1. Role statement — 'You are refining an existing specification'\n2. Planning-only warning\n3. {{\u003e context-pinning}}, {{\u003e spec-header}}\n4. Existing spec display\n5. Update guidelines — Discuss NEW requirements only\n6. Output — Summarize new requirements\n7. {{\u003e exit-signals}}\nExit signals: RALPH_COMPLETE, RALPH_BLOCKED, RALPH_CLARIFY\n\n### ready-new.md\nRequired sections:\n1. Role statement — 'You are decomposing a specification into tasks'\n2. {{\u003e context-pinning}}, {{\u003e spec-header}}\n3. Spec content — Full spec to decompose\n4. Task breakdown guidelines\n5. Molecule creation — Create epic, child tasks, set dependencies\n6. README update — Add molecule ID to specs/README.md\n7. {{\u003e exit-signals}}\nExit signals: RALPH_COMPLETE, RALPH_BLOCKED\n\n### ready-update.md\nRequired sections:\n1. Role statement — 'You are adding tasks to an existing molecule'\n2. {{\u003e context-pinning}}, {{\u003e spec-header}}\n3. Existing molecule info — ID, current tasks, progress\n4. New requirements — From plan-update conversation\n5. Task creation — Create tasks, bond to molecule, set dependencies\n6. Spec update — Append new requirements to spec file\n7. {{\u003e exit-signals}}\nExit signals: RALPH_COMPLETE, RALPH_BLOCKED\n\n### step.md\nRequired sections:\n1. {{\u003e context-pinning}}, {{\u003e spec-header}}\n2. Issue details — ID, title, description\n3. Instructions with 6 points (including blocked vs waiting guidance)\n4. Quality gates\n5. Land the plane — Session protocol\n6. {{\u003e exit-signals}}\nExit signals: RALPH_COMPLETE, RALPH_BLOCKED, RALPH_CLARIFY\n\nReview and update all templates in lib/ralph/template/ to comply with spec.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:46:01Z","created_by":"unknown","updated_at":"2026-02-01T16:34:51Z","closed_at":"2026-02-01T16:34:49Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.5","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.6","title":"Add ralph template validation to nix flake check","description":"Template validation must run as part of nix flake check.\n\nFrom spec:\n```nix\n# flake.nix\n{\n  checks.${system} = {\n    ralph-templates = ralph.lib.validateTemplates {\n      templates = ./lib/ralph/template;\n    };\n  };\n}\n```\n\nCurrent state:\n- lib/ralph/template/default.nix has mkTemplatesCheck function\n- Need to wire this into flake.nix checks\n\nImplementation:\n1. Import ralph module in flake.nix\n2. Add ralph-templates check using mkTemplatesCheck\n3. Verify ralph check CLI matches nix flake check behavior\n\nSuccess criteria:\n- nix flake check includes template validation\n- ralph check validates all templates and partials","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:46:10Z","created_by":"unknown","updated_at":"2026-02-01T16:38:30Z","closed_at":"2026-02-01T16:38:28Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.6","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.7","title":"Implement plan command flag validation and mode handling","description":"ralph plan requires exactly one mode flag with proper validation.\n\nFrom spec:\n| Flag | Location | Mode | Template |\n|------|----------|------|----------|\n| -n/--new | specs/ | create | plan-new.md |\n| -h/--hidden | state/ | create | plan-new.md |\n| -u/--update | auto-detect | update | plan-update.md |\n| -u -h | state/ | update | plan-update.md |\n\nValidation:\n- -u/--update: Error if spec doesn't exist at expected location\n- No flag or invalid combination: Error with usage help\n\nBehavior:\n- Creates state/current.json with feature metadata\n- Launches wrapix container with base profile\n- Runs spec interview using appropriate template\n- Outputs RALPH_COMPLETE when done\n\nReview and ensure lib/ralph/cmd/plan.sh implements all validation correctly.","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:46:20Z","created_by":"unknown","updated_at":"2026-02-01T16:44:19Z","closed_at":"2026-02-01T16:44:17Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.7","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.8","title":"Add integration tests for all ralph commands","description":"Comprehensive integration tests for ralph workflow.\n\nTests directory: tests/ralph/\nExisting files:\n- default.nix (test derivation)\n- mock-claude (mock executable)\n- scenarios/ (test scenario definitions)\n- run-tests.sh (test harness)\n- templates.nix (template tests)\n\nRequired test coverage (from ralph-tests.md spec):\n\n1. Happy Path:\n   - ralph plan test-feature — creates spec, signals complete\n   - ralph ready — creates epic + tasks with dependencies\n   - ralph step — completes first unblocked task\n   - ralph loop — completes remaining tasks, closes epic\n\n2. Parallel Simulation:\n   - ralph step marks task A as in_progress\n   - Simulate second agent state check\n   - Verify task selection logic\n\n3. Config Behavior:\n   - spec.hidden = true/false\n   - beads.priority\n   - loop.max-iterations\n   - loop.pause-on-failure\n\n4. Error Scenarios:\n   - No completion signal\n   - RALPH_BLOCKED signal\n   - Malformed bd output\n   - Partial epic\n\nSuccess criteria:\n- Tests pass with mock claude (no real API calls)\n- Tests verify dependency-ordered task execution\n- Tests verify in_progress exclusion for parallel agents\n- Tests verify error handling","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:46:32Z","created_by":"unknown","updated_at":"2026-02-01T16:48:53Z","closed_at":"2026-02-01T16:48:51Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.8","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-zay1.9","title":"Implement ralph status with molecule progress display","description":"ralph status must show molecule progress visualization.\n\nFrom spec:\n```\nRalph Status: my-feature\n===============================\nMolecule: bd-xyz123\nSpec: specs/my-feature.md\n\nProgress:\n  [####------] 40% (4/10)\n\nCurrent Position:\n  [done]    Setup project structure\n  [done]    Implement core feature\n  [current] Write tests         \u003c- you are here\n  [ready]   Update documentation\n  [blocked] Final review (waiting on tests)\n```\n\nUses bd mol commands:\n- bd mol progress $MOLECULE_ID — Show completion %\n- bd mol current $MOLECULE_ID — Show position in DAG\n- bd mol stale $MOLECULE_ID — Warn about orphaned molecules\n\nImplementation:\n1. Read molecule ID from state/current.json\n2. Query bd mol progress for completion stats\n3. Query bd mol current for position\n4. Format output as shown in spec\n\nSuccess criteria:\n- ralph status shows molecule progress with visual bar\n- ralph status shows current position in task list","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-02-01T15:46:43Z","created_by":"unknown","updated_at":"2026-02-08T10:44:08Z","closed_at":"2026-02-08T10:44:08Z","labels":["profile:base","spec-ralph-workflow"],"dependencies":[{"issue_id":"wx-zay1.9","depends_on_id":"wx-zay1","type":"parent-child","created_at":"2026-02-08T21:42:33Z","created_by":"import"}],"work_type":"mutex"}
{"id":"wx-ze6","title":"Add tests for deploy key setup and scripts","description":"Several components lack test coverage:\n\n**Missing tests:**\n1. scripts/setup-deploy-key - No tests for deploy key generation\n2. scripts/setup-tailscale-routing.sh - No tests\n3. deriveProfile function - No tests for profile derivation\n4. mkDevShell function - No tests\n5. Error conditions (mount failures, network failures, etc.)\n6. Deploy key workflow integration test\n\n**Impact:** Changes to these components can break without detection.\n\n**Fix:** Add test cases for these components in lib/tests/.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-10T19:51:18Z","created_by":"Wrapix Sandbox","updated_at":"2026-01-10T22:04:31Z","closed_at":"2026-01-10T22:04:31Z","work_type":"mutex"}
{"id":"wx-ziy6","title":"Update template content to match spec requirements","description":"Update plan-new.md, plan-update.md, ready-new.md, ready-update.md, and step.md to include all required sections from the spec. Each template has specific required sections detailed in spec lines 374-459. Use partials where appropriate (context-pinning, exit-signals, spec-header).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-30T01:11:41Z","created_by":"unknown","updated_at":"2026-01-30T03:16:08Z","closed_at":"2026-01-30T02:20:41Z","labels":["spec-ralph-workflow"],"work_type":"mutex"}
{"id":"wx-zmj","title":"Create config behavior tests","description":"Create tests for: spec.hidden=true (spec in state/ not specs/, README not updated), spec.hidden=false (spec in specs/, README updated), beads.priority (issues get configured priority), loop.max-iterations (stops after N), loop.pause-on-failure (pauses vs continues), loop.pre-hook/post-hook (hooks execute), failure-patterns (custom patterns trigger actions).","status":"closed","priority":2,"issue_type":"task","owner":"gpg@taheris.net","created_at":"2026-01-26T13:29:49Z","created_by":"unknown","updated_at":"2026-01-26T16:09:20Z","closed_at":"2026-01-26T16:07:48Z","labels":["rl-ralph-tests"],"work_type":"mutex"}
{"id":"wx-zu8","title":"Fix Darwin container networking","description":"Container starts but networking doesn't work. NAT interface is configured with 10.0.0.2/24 and gateway 10.0.0.1 but Claude can't reach the network. Need to debug DNS resolution and network connectivity inside the VM.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T11:06:33Z","created_by":"shaun","updated_at":"2026-01-08T20:04:16Z","closed_at":"2026-01-08T20:04:16Z","work_type":"mutex"}
