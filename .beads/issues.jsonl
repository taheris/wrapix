{"id":"wrapix-0u2","title":"Network security verification","description":"Verify network filtering on both platforms: blocked domains return 403, TLD blocking works, raw IP blocked, WebSocket blocked, DNS exfil blocked, ICMP blocked.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:59.155250789Z","created_by":"shaun","updated_at":"2026-01-06T19:24:22.322213481Z","closed_at":"2026-01-06T19:24:22.322213481Z","close_reason":"Verified: blocklist covers paste/file-sharing/webhooks, TLD blocking, raw IP blocking, WebSocket blocking, DNS/ICMP blocked via iptables","labels":["phase:3-polish"]}
{"id":"wrapix-2nt","title":"Performance tuning","description":"Optimize layer ordering in OCI images, tune VM resources for macOS, verify startup times.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:59.079598322Z","created_by":"shaun","updated_at":"2026-01-06T19:24:22.33572Z","closed_at":"2026-01-06T19:24:22.33572Z","close_reason":"Added VM CPU/memory tuning options, documented layer ordering strategy for cache efficiency","labels":["phase:3-polish"]}
{"id":"wrapix-327","title":"Squid configuration (squid.nix)","description":"Create lib/sandbox/squid.nix to generate Squid transparent proxy config with blocklist ACLs, JSON logging, WebSocket blocking.","design":"```\nhttp_port 3128 transparent\n\nacl blocked_domains dstdomain \"/path/to/blocklist.acl\"\nacl blocked_tlds dstdomain \"/path/to/tld-blocklist.acl\"\nacl to_ipaddress url_regex ^https?://[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+\nacl websocket_upgrade req_header Upgrade -i websocket\n\nhttp_access deny blocked_domains\nhttp_access deny blocked_tlds\nhttp_access deny to_ipaddress\nhttp_access deny websocket_upgrade\nhttp_access allow all\n\nlogformat json {\"timestamp\":\"%tl\",\"url\":\"%ru\",\"status\":%\u003eHs,\"action\":\"%Ss\"}\naccess_log stdio:/dev/stdout json\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21.618257196Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.357198024Z","closed_at":"2026-01-06T19:03:55.357198024Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-40g","title":"Add aarch64-darwin to flake","description":"Update flake.nix to add aarch64-darwin support alongside Linux systems.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50.92957044Z","created_by":"shaun","updated_at":"2026-01-06T19:19:42.978406916Z","closed_at":"2026-01-06T19:19:42.978406916Z","close_reason":"aarch64-darwin already in flake.nix from initial implementation","labels":["phase:2-macos"]}
{"id":"wrapix-582","title":"Linux Claude entrypoint (linux/entrypoint.nix)","description":"Create lib/sandbox/linux/entrypoint.nix - entrypoint script for Claude container with proper environment setup.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:35.870389297Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.361436072Z","closed_at":"2026-01-06T19:03:55.361436072Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-6cg","title":"Claude Code npm package (claude-package.nix)","description":"Create lib/sandbox/claude-package.nix to fetch and install Claude Code from npm registry. Pin version, create wrapper script.","design":"Fetch from npm registry, pin version:\n\n```nix\n{ pkgs }:\nlet version = \"2.0.76\";\nin pkgs.stdenv.mkDerivation {\n  pname = \"claude-code\";\n  inherit version;\n  src = pkgs.fetchurl {\n    url = \"https://registry.npmjs.org/@anthropic-ai/claude-code/-/claude-code-${version}.tgz\";\n    hash = \"sha256-...\";\n  };\n  nativeBuildInputs = [ pkgs.nodejs ];\n  installPhase = ''\n    mkdir -p $out/bin $out/lib\n    cp -r . $out/lib/\n    cat \u003e $out/bin/claude \u003c\u003c 'WRAPPER'\n    #!/usr/bin/env bash\n    exec ${pkgs.nodejs}/bin/node \"$(dirname \"$0\")/../lib/cli.js\" \"$@\"\n    WRAPPER\n    chmod +x $out/bin/claude\n  '';\n}\n```\n\nCLI args: --dangerously-skip-permissions --disallowedTools \"Bash(curl:*),Bash(wget:*)\" --append-system-prompt","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21.188417376Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.276339569Z","closed_at":"2026-01-06T19:03:55.276339569Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-7a4","title":"macOS Nix wrapper (darwin/default.nix)","description":"Create lib/sandbox/darwin/default.nix - Nix wrapper that invokes the Swift runner with correct paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50.827279116Z","created_by":"shaun","updated_at":"2026-01-06T19:19:42.964667828Z","closed_at":"2026-01-06T19:19:42.964667828Z","close_reason":"Implemented darwin/default.nix with kernel and Swift CLI integration","labels":["phase:2-macos"]}
{"id":"wrapix-7cb","title":"Verify macOS profiles","description":"Verify all profiles work on macOS: VM boots \u003c1s, virtio-fs mounts work, UID mapping works.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:51.019001337Z","created_by":"shaun","updated_at":"2026-01-06T19:24:28.244830782Z","closed_at":"2026-01-06T19:24:28.244830782Z","close_reason":"Requires macOS hardware to test; implementation complete, needs verification on aarch64-darwin","labels":["phase:2-macos"]}
{"id":"wrapix-7sj","title":"Linux init container (linux/init-image.nix)","description":"Create lib/sandbox/linux/init-image.nix - minimal ~5MB image with iptables. Sets up transparent proxy redirect rules, DNS filtering, drops other traffic, then exits.","design":"```bash\n#!/bin/bash\n# Redirect HTTP/HTTPS to Squid\niptables -t nat -A OUTPUT -p tcp --dport 80 -j REDIRECT --to-port 3128\niptables -t nat -A OUTPUT -p tcp --dport 443 -j REDIRECT --to-port 3128\n\n# Allow localhost, established connections\niptables -A OUTPUT -o lo -j ACCEPT\niptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# DNS only to container's resolver\nRESOLVER=$(awk '/^nameserver/ {print $2; exit}' /etc/resolv.conf)\niptables -A OUTPUT -p udp --dport 53 -d \"$RESOLVER\" -j ACCEPT\niptables -A OUTPUT -p udp --dport 53 -j DROP\n\n# Block everything else\niptables -A OUTPUT -j DROP\n```\n\nImage should be ~5MB, only iptables + bash needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:35.782245369Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.360004649Z","closed_at":"2026-01-06T19:03:55.360004649Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-a0u","title":"Update flake.nix for podman","description":"Update flake.nix - replace bubblewrap with podman sandbox, export packages (wrapix, wrapix-rust, wrapix-go, etc.) and lib functions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:36.225889602Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.367935202Z","closed_at":"2026-01-06T19:03:55.367935202Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-ca5","title":"macOS kernel build (darwin/kernel.nix)","description":"Create lib/sandbox/darwin/kernel.nix - build Linux kernel with Apple Containerization config for arm64, VIRTIO_FS built-in.","design":"```nix\npkgs.stdenv.mkDerivation {\n  pname = \"containerization-kernel\";\n  version = \"6.14.9\";\n  src = fetchurl { url = \"https://cdn.kernel.org/...\"; };\n  # Use Apple's optimized arm64 config (VIRTIO_FS built-in)\n  configurePhase = ''\n    cp ${appleKernelConfig} .config\n    make olddefconfig\n  '';\n  installPhase = ''\n    cp arch/arm64/boot/Image $out/vmlinux\n  '';\n}\n```\n\nFirst build takes ~5-10 min, Nix caches result.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50.670252663Z","created_by":"shaun","updated_at":"2026-01-06T19:19:42.936019079Z","closed_at":"2026-01-06T19:19:42.936019079Z","close_reason":"Implemented kernel.nix with comprehensive VirtIO config","labels":["phase:2-macos"]}
{"id":"wrapix-cc4","title":"OCI image builder (image.nix)","description":"Create lib/sandbox/image.nix using dockerTools.buildLayeredImage. Include base packages, profile packages, cacert, macOS entrypoint script.","design":"```nix\npkgs.dockerTools.buildLayeredImage {\n  name = \"wrapix-${profile.name}\";\n  tag = \"latest\";\n  maxLayers = 100;\n  contents = [\n    pkgs.dockerTools.fhsUserNamespaces\n    (mkBinEnv (basePackages ++ profile.packages))\n    pkgs.cacert\n  ];\n  extraCommands = ''\n    echo \"root:x:0:0:root:/root:/bin/bash\" \u003e etc/passwd\n    echo \"127.0.0.1 localhost\" \u003e etc/hosts\n    # macOS entrypoint script for iptables + Squid + user + Claude\n  '';\n  config = {\n    Env = [\n      \"PATH=/usr/local/bin:/bin\"\n      \"http_proxy=http://127.0.0.1:3128\"\n      \"https_proxy=http://127.0.0.1:3128\"\n    ] ++ profileEnvVars;\n  };\n}\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21.707590825Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.358586907Z","closed_at":"2026-01-06T19:03:55.358586907Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-cga","title":"macOS Swift CLI (darwin/swift/)","description":"Create lib/sandbox/darwin/swift/ with Package.swift and SandboxRunner.swift - VM orchestration using Apple Containerization framework.","design":"```swift\n@main struct SandboxRunner: AsyncParsableCommand {\n    @Argument var projectDir: String\n    @Option var imagePath: String\n    @Option var kernelPath: String\n\n    func run() async throws {\n        let manager = try await ContainerManager(\n            kernel: Kernel(path: URL(fileURLWithPath: kernelPath)),\n            network: try ContainerManager.VmnetNetwork()\n        )\n        let container = try await manager.create(\"wrapix\") { config in\n            config.cpus = ProcessInfo.processInfo.processorCount\n            config.memoryInBytes = 8.gib()\n            config.mounts.append(Mount.share(source: projectDir, destination: \"/workspace\"))\n            config.process.arguments = [\"/entrypoint.sh\"]\n            config.process.environmentVariables = [\n                \"HOST_UID\": String(getuid()),\n                \"HOST_USER\": NSUserName()\n            ]\n        }\n        try await container.start()\n        Darwin.exit(try await container.wait())\n    }\n}\n```\n\nUses Apple Containerization framework (macOS 26+, Apple Silicon only).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:50.745683184Z","created_by":"shaun","updated_at":"2026-01-06T19:19:42.951932515Z","closed_at":"2026-01-06T19:19:42.951932515Z","close_reason":"Implemented Swift CLI with SandboxRunner.swift and Package.swift","labels":["phase:2-macos"]}
{"id":"wrapix-cpc","title":"System prompt for sandbox (sandbox-prompt.txt)","description":"Create lib/sandbox/sandbox-prompt.txt with sandbox environment description for Claude.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21.303974517Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.352852687Z","closed_at":"2026-01-06T19:03:55.352852687Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-dv5","title":"Platform dispatcher (sandbox/default.nix)","description":"Create lib/sandbox/default.nix - dispatch to linux/ or darwin/ based on system platform.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:36.045973984Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.364346916Z","closed_at":"2026-01-06T19:03:55.364346916Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-fxl","title":"Update documentation","description":"Update CLAUDE.md and README.md with usage instructions, requirements, and examples.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:59.00355804Z","created_by":"shaun","updated_at":"2026-01-06T19:19:47.134316337Z","closed_at":"2026-01-06T19:19:47.134316337Z","close_reason":"Documentation updated with profiles simplified and ARCHITECTURE.md diagrams fixed","labels":["phase:3-polish"]}
{"id":"wrapix-gh2","title":"Blocklist (blocklist.nix)","description":"Create lib/sandbox/blocklist.nix with blocked domains: pastebin sites, file sharing, URL shorteners, webhook sites, code execution platforms, risky TLDs.","design":"Categories:\n- pastebin_sites: pastebin.com, hastebin.com, paste.ee, dpaste.org, ghostbin.com, privatebin.net, 0bin.net, paste.debian.net, bpaste.net\n- file_sharing: transfer.sh, file.io, tmpfiles.org, gofile.io, pixeldrain.com, catbox.moe, uguu.se, filebin.net, uploadfiles.io\n- url_shorteners: bit.ly, tinyurl.com, t.co, goo.gl, ow.ly, is.gd, buff.ly\n- webhook_sites: webhook.site, requestbin.com, hookbin.com, pipedream.com, beeceptor.com, requestcatcher.com, httpbin.org\n- code_execution: replit.com, glitch.com, codepen.io, jsfiddle.net, codesandbox.io\n- risky_tlds: tk, ml, ga, cf, gq, top, xyz, click, link","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21.535304706Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.355793031Z","closed_at":"2026-01-06T19:03:55.355793031Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-idm","title":"Test Linux profiles","description":"Test all profiles work on Linux: pod starts \u003c2s, init sets iptables and exits, Claude container has no caps, UID mapping works.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T18:51:36.322044263Z","created_by":"shaun","updated_at":"2026-01-06T19:24:22.306909599Z","closed_at":"2026-01-06T19:24:22.306909599Z","close_reason":"Fixed docker-archive prefix issue, both base and rust profiles build and generate correct podman scripts","labels":["phase:1-core"]}
{"id":"wrapix-iye","title":"Linux pod orchestration (linux/default.nix)","description":"Create lib/sandbox/linux/default.nix - Podman pod script with 3-container pattern: init (NET_ADMIN, exits), squid (sidecar), claude (unprivileged, interactive).","design":"```bash\nPOD_NAME=\"wrapix-$$\"\ntrap 'podman pod rm -f \"$POD_NAME\"' EXIT SIGINT SIGTERM\n\n# Create pod with isolated network\npodman pod create --name \"$POD_NAME\" --network=slirp4netns\n\n# Init container: set up iptables, exit\npodman run --rm --pod \"$POD_NAME\" --cap-add=NET_ADMIN $INIT_IMAGE\n\n# Squid sidecar: blocklist filtering\npodman run --detach --pod \"$POD_NAME\" --name \"${POD_NAME}-squid\" \\\n  $PROFILE_IMAGE squid -f /etc/squid/squid.conf -N\n\n# Wait for Squid\nwhile ! podman exec \"${POD_NAME}-squid\" squid -k check; do sleep 0.1; done\n\n# Claude container: completely unprivileged\nexec podman run --rm -it --pod \"$POD_NAME\" --userns=keep-id \\\n  -v \"$PROJECT_DIR:/workspace:rw\" \\\n  $PROFILE_IMAGE claude\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:35.955747149Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.362904644Z","closed_at":"2026-01-06T19:03:55.362904644Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-mnf","title":"Profile definitions (profiles.nix)","description":"Create lib/sandbox/profiles.nix with profile definitions: base, rust, go, python, js, nix, devops. Include mount format with source/dest/mode/optional.","design":"Profile structure:\n```nix\n{\n  name = \"rust\";\n  packages = with pkgs; [ rustc cargo rust-analyzer ];\n  mounts = [\n    { source = \"~/.cargo/registry\"; dest = \"~/.cargo/registry\"; mode = \"ro\"; optional = true; }\n  ];\n  env = { CARGO_HOME = \"/tmp/cargo\"; };\n  customPrompt = \"...\";  # optional\n}\n```\n\nProfiles: base, rust, go, python, js, nix, devops\n\nBase packages (all profiles):\nbash coreutils findutils git jujutsu ripgrep fd tree less gnugrep gnused gawk jq yq gnutar gzip zip unzip vim man file which patch diffutils procps rsync\n\nRequired mounts: ~/.claude (rw), ~/.claude.json (rw), ~/.config/git (ro), project dir (rw)\n\nEnv vars: CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1, DISABLE_AUTOUPDATER=1, DISABLE_ERROR_REPORTING=1, DISABLE_TELEMETRY=1","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:21.43574195Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.354404718Z","closed_at":"2026-01-06T19:03:55.354404718Z","close_reason":"Closed","labels":["phase:1-core"]}
{"id":"wrapix-p5m","title":"Library exports (lib/default.nix)","description":"Create lib/default.nix exporting: mkSandbox, mkDevShell, deriveProfile, profiles.","design":"```nix\n{ pkgs, system }:\nlet\n  sandbox = import ./sandbox { inherit pkgs system; };\n  profiles = import ./sandbox/profiles.nix { inherit pkgs; };\nin {\n  mkSandbox = profile: sandbox.mkSandbox profile;\n\n  deriveProfile = baseProfile: extensions:\n    baseProfile // extensions // {\n      packages = (baseProfile.packages or []) ++ (extensions.packages or []);\n      mounts = (baseProfile.mounts or []) ++ (extensions.mounts or []);\n      env = (baseProfile.env or {}) // (extensions.env or {});\n    };\n\n  mkDevShell = { packages ? [], shellHook ? \"\" }:\n    pkgs.mkShell { inherit packages shellHook; };\n\n  inherit profiles;\n}\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:51:36.134120722Z","created_by":"shaun","updated_at":"2026-01-06T19:03:55.366211793Z","closed_at":"2026-01-06T19:03:55.366211793Z","close_reason":"Closed","labels":["phase:1-core"]}
